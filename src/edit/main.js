(function(){function $parcel$export(t,e,o,i){Object.defineProperty(t,e,{get:o,set:i,enumerable:!0,configurable:!0})}var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequirec19f;null==parcelRequire&&(parcelRequire=function(t){if(t in $parcel$modules)return $parcel$modules[t].exports;if(t in $parcel$inits){var e=$parcel$inits[t];delete $parcel$inits[t];var o={id:t,exports:{}};return $parcel$modules[t]=o,e.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i},parcelRequire.register=function(t,e){$parcel$inits[t]=e},$parcel$global.parcelRequirec19f=parcelRequire),parcelRequire.register("Wc23C",(function(module,exports){var $aykGt=parcelRequire("aykGt"),$gUPg4=parcelRequire("gUPg4"),$aDjZZ=parcelRequire("aDjZZ");parcelRequire("4mhKw"),window.onload=function(ev){document.addEventListener("touchmove",(function(t){1!==t.scale&&t.preventDefault()}),!1);let resizeTimer=!1;$(window).on("resize",(function(t){resizeTimer||$(window).trigger("resizestart"),clearTimeout(resizeTimer),resizeTimer=setTimeout((function(){resizeTimer=!1,$(window).trigger("resizeend")}),250)})).on("resizeend",(function(){_MAP.setAspectRatio()})),_SCENES=new(0,$gUPg4.Scenes),$("#sceneRow").keydown((t=>{["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Space"].indexOf(t.code)>-1&&t.preventDefault()})),$("#sceneRow").keyup((t=>{let e=t.code;"ArrowLeft"==e&&(t.preventDefault(),_SCENES.prev()),"ArrowRight"==e&&(t.preventDefault(),_SCENES.next()),["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Space"].indexOf(e)>-1&&t.preventDefault()})),$("#sceneRow button#add").click((t=>{_SCENES.add()})),$("#sceneRow button#recapture").click((t=>{_SCENES.capture()})),$("#sceneWarningModal button#delete").click((t=>{_SCENES.delete(),$("#sceneWarningModal").modal("hide")})),_TEXTBOXES=new(0,$aDjZZ.Textboxes),_MAP=L.map("map",{center:[49,14],zoom:window.innerWidth<575.98?3:5,zoomControl:!1,maxZoom:18,doubleClickZoom:!1,zoomAnimationThreshold:100,wheelPxPerZoomLevel:1500,keyboard:!1,tap:!1,boxZoom:!1,contextmenu:!0,contextmenuItems:[{text:"Copy coordinates",callback:t=>{navigator.clipboard.writeText(`${t.latlng.lat}, ${t.latlng.lng}`)}},{text:"Center map here",callback:t=>{_MAP.panTo(t.latlng)}},"-",{text:"Zoom in",icon:"assets/zoom-in.png",callback:t=>{_MAP.zoomIn()}},{text:"Zoom out",icon:"assets/zoom-out.png",callback:t=>{_MAP.zoomOut()}}]}),document.addEventListener("_setup",(t=>{_MAP.setup(),_TEXTBOXES.setup(),_SCENES.setup()})),document.addEventListener("_reset",(t=>{_SCENES.reset(),_TEXTBOXES.reset(),_MAP.reset()})),$("#optionsModal input#animationSpeed").change((function(t){_OPTIONS.animationspeed=1e3*$(this).val()})),$("#optionsModal input#panningSpeed").change((function(t){_OPTIONS.panningspeed=$(this).val()||null})),$("#optionsModal select#aspectRatio").change((function(ev){_MAP.setAspectRatio(eval(this.value))})),$("#optionsModal input#objectsOptIn").change((function(t){_OPTIONS.objectOptIn=this.checked})),(0,$aykGt.init_basemaps)(),$("#basemapModal input#basemapFile").change((t=>{let e=$(t.target)[0].files[0];if(!e)return;$("#loadingModal").modal("show");let o=new FormData;o.append("type","basemap"),o.append("image",e),$.ajax({type:"POST",url:"api/upload_create.php",data:o,contentType:!1,processData:!1,success:async function(t,e,o){await _MAP.setBasemap({type:"image",img:t}),_SCENES.setBasemap(),_BASEMAPS.push({name:"",tiles:{type:"image",img:t},preview:t}),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})})),$("#basemapModal button#basemapFetch").click((t=>{let e=$("#basemapModal input#basemapLink").val();if(e){if("mapbox"==e.split(/\:/gi)[0]){let t=e.split(/mapbox\:\/\/styles\//gi)[1].split(/\//gi)[0],o=e.split(/mapbox\:\/\/styles\//gi)[1].split(/\//gi)[1],i=$("#basemapModal input#basemapKey").val();if(!i)return;e=`https://api.mapbox.com/styles/v1/${t}/${o}/tiles/256/{z}/{x}/{y}?access_token=${i}`}_MAP.setBasemap({type:"tiles",url:e}),_SCENES.setBasemap()}})),$("#basemapModal button#wmsAdd").click((t=>{let e=$("#basemapModal input#wmsLink").val(),o=$("#basemapModal input#wmsLayer").val(),i=$("#basemapModal select#wmsFormat").val(),n=$("#basemapModal select#wmsVersion").val();e&&o&&(_MAP.setWMS({type:"wms",url:e,layers:o,format:i,version:n,transparent:"image/png"==i}),_SCENES.setWMS())})),$("#basemapModal button#wmsRemove").click((t=>{_MAP.setWMS(null),_SCENES.setWMS()})),$("#projectFileInput").change((t=>{let e=$(t.target)[0].files[0];if(!e)return;let o=new FileReader;o.onload=function(){(0,$aykGt.import_data)("project",JSON.parse(o.result))},o.readAsText(e)})),$("#geojsonImportModal button#import").click((t=>{$("#geojsonImportModal").modal("hide");let e=$("#geojsonImportModal input#fileInput")[0].files[0];if(!e)return;let o={lineColor:$("#geojsonImportModal #lineColor").val(),lineThickness:$("#geojsonImportModal #lineThickness").val()||3,lineTransparency:$("#geojsonImportModal #lineTransparency").val(),fillColor:$("#geojsonImportModal #fillColor").val(),fillTransparency:$("#geojsonImportModal #fillTransparency").val()||.8},i=new FileReader;i.onload=function(){(0,$aykGt.import_data)("geojson",JSON.parse(i.result),o)},i.readAsText(e)})),$("#gedcomImportModal button#import").click((t=>{$("#gedcomImportModal").modal("hide");let e=$("#gedcomImportModal input#fileInput")[0].files[0];if(!e)return;let o={},i=new FileReader;i.onload=function(){(0,$aykGt.import_data)("gedcom",i.result,o)},i.readAsText(e)})),$("button#export").click((t=>{(0,$aykGt.export_data)($(t.target).data("type")||null)})),$("a#save").click((t=>{$("#loadingModal").modal("show"),(0,$aykGt.save_data)((function(){$("#loadingModal").modal("hide")}))})),setInterval($aykGt.save_data,3e5),$("#loadingModal").modal("show"),$.ajax({type:"GET",url:"api/map_read.php",data:{id:_ID,password:""},dataType:"json",success:function(t,e,o){t.data&&(0,$aykGt.import_data)("project",JSON.parse(t.data)),$("div#sceneRow,\n\t\t\t   div#mapRow,\n\t\t\t   .navbar .navbarContent li").click((t=>{(0,$aykGt.unsaved_changes)()})),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}}),$.ajax({type:"GET",url:"api/upload_get.php",dataType:"json",success:function(t,e,o){for(let e of t)"icon"==e.type?_ICONS.unshift(e.ref):"basemap"==e.type&&_BASEMAPS.push({name:"",tiles:{type:"image",img:e.ref},preview:e.ref})},error:function(t,e,o){console.error(t.status,o)}})}})),parcelRequire.register("aykGt",(function(t,e){$parcel$export(t.exports,"uuid",(function(){return i})),$parcel$export(t.exports,"import_data",(function(){return n})),$parcel$export(t.exports,"export_data",(function(){return r})),$parcel$export(t.exports,"save_data",(function(){return l})),$parcel$export(t.exports,"unsaved_changes",(function(){return c})),$parcel$export(t.exports,"flash_map",(function(){return d})),$parcel$export(t.exports,"init_basemaps",(function(){return u})),$parcel$export(t.exports,"init_img_basemaps",(function(){return h})),$parcel$export(t.exports,"get_aspect_ratio_dimentions",(function(){return m}));var o=parcelRequire("4XDZb");function i(t){return t?(t^16*Math.random()>>t/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i)}function n(t,e,o){switch(t){case"project":!function(t){_OPTIONS=t.options,$("#optionsModal input#animationSpeed").val(_OPTIONS.animationspeed/1e3),$("#optionsModal input#panningSpeed").val(_OPTIONS.panningspeed||null),$("#optionsModal input#objectsOptIn").prop("checked",_OPTIONS.objectOptIn),t.scenes.length<=0||(_SCENES.store.length<=0&&document.dispatchEvent(new Event("_setup")),_SCENES.importData(t.scenes),_TEXTBOXES.importData(t.textboxes),_MAP.importData(t.objects),_SCENES.current())}(e);break;case"geojson":!function(t,e){for(let o of t.features){let t,n=t=>{if(Array.isArray(t[0]))for(let e of t)n(e);else t.reverse()},a=o.geometry.coordinates;if(n(a),"avatar"==o.properties.type)t={id:i(),sceneId:_SCENES.active,type:"avatar",pos:a,label:o.properties.label,icon:o.properties.icon,ratio:o.properties.ratio,rounded:o.properties.rounded,angle:o.properties.angle,borderColor:o.properties.borderColor,borderThickness:o.properties.borderThickness,blur:o.properties.overlayBlur,grayscale:o.properties.overlayGrayscale,brightness:o.properties.overlayBrightness,transparency:o.properties.overlayTransparency};else if("polyline"==o.properties.type||"LineString"==o.geometry.type||"MultiLineString"==o.geometry.type)t={id:i(),sceneId:_SCENES.active,type:"polyline",pos:a,label:o.properties.label,dashed:o.properties.dashed,color:o.properties.color||e.lineColor,thickness:o.properties.thickness||e.lineThickness,transparency:o.properties.transparency||e.lineTransparency};else if("polygon"==o.properties.type||"rectangle"==o.properties.type||"Polygon"==o.geometry.type||"MultiPolygon"==o.geometry.type)t={id:i(),sceneId:_SCENES.active,type:"polygon",pos:a,label:o.properties.label,dashed:o.properties.dashed,lineColor:o.properties.lineColor||e.lineColor,lineThickness:o.properties.lineThickness||e.lineThickness,lineTransparency:o.properties.lineTransparency||e.lineTransparency,fillColor:o.properties.fillColor||e.fillColor,fillTransparency:o.properties.fillTransparency||e.fillTransparency};else{if("circle"!=o.properties.type&&"Point"!=o.geometry.type)continue;t={id:i(),sceneId:_SCENES.active,type:"circle",pos:a,radius:o.properties.radius||4e3*(_MAP.getMaxZoom()-_MAP.getZoom()),label:o.properties.label,dashed:o.properties.dashed,lineColor:o.properties.lineColor||e.lineColor,lineThickness:o.properties.lineThickness||e.lineThickness,lineTransparency:o.properties.lineTransparency||e.lineTransparency,fillColor:o.properties.fillColor||e.fillColor,fillTransparency:o.properties.fillTransparency||e.fillTransparency}}let s=_MAP.createObject(t);_MAP.addLayer(s),_MAP.fire("_addedlayer",{layer:s}),_MAP.objects.push(_MAP.extractObject(s))}}(e,o);break;case"gedcom":break;default:console.error("data-import type invalid")}}function a(){return JSON.stringify({options:_OPTIONS,scenes:_SCENES.exportData(),textboxes:_TEXTBOXES.exportData(),objects:_MAP.exportData()})}let s=!1;function r(t){if(s)return;s=!0;let e,o=document.createElement("a"),i=t=>t<10&&t>=0?`0${t}`:`${t}`,n=new Date,r=n.getFullYear(),l=i(n.getMonth()+1),c=i(n.getDate()),d=i(n.getHours()),p=i(n.getMinutes()),u=i(n.getSeconds()),h=`${_TITLE} - ${r}.${l}.${c} - ${d}.${p}.${u}`;switch(t){case"project":h+=".geotales",e="data:application/json;charset=utf-8,"+encodeURIComponent(a());break;case"geojson":h+=".geojson",e="data:application/geo+json;charset=utf-8,"+encodeURIComponent(function(){let t=[];for(let e of _MAP.getLayers())t.push(e.__toGeoJSON());return JSON.stringify({type:"FeatureCollection",features:t})}());break;default:return}o.setAttribute("href",e),o.setAttribute("download",h),o.style.display="none",document.body.appendChild(o),$(o).ready((()=>{o.click(),document.body.removeChild(o),s=!1}))}function l(t){$.ajax({type:"POST",url:"api/map_write.php",data:{id:_ID,data:a(),preview:_MAP.getCenterBasemapTile()},dataType:"json",success:function(e,o,i){$(window).off("beforeunload"),setTimeout((function(){t&&t()}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})}function c(){$(window).off("beforeunload"),$(window).on("beforeunload",(t=>{t.preventDefault();let e="Unsaved changes could be lost. Are you sure you want to close?";return t.returnValue=e,e}))}function d(){$("div#map").addClass("snapshot"),setTimeout((function(){$("div#map").removeClass("snapshot")}),240)}function p(){$("#basemapModal #basemaps").off("click"),$("#basemapModal #basemaps").click((async function(t){let e=$(t.target).data("basemap");(e||0===e)&&(await _MAP.setBasemap(_BASEMAPS[e].tiles),_SCENES.setBasemap())})),$("#basemapModal button#uploadBasemap").click((function(t){$("#basemapModal input#basemapFile").click()}))}function u(){(0,o.generate_basemaps)(!1),p()}function h(){(0,o.generate_basemaps)(!0),p()}function m(t,e,o){let i=o*e;return i<=t?[i,e]:[t,t/o]}})),parcelRequire.register("4XDZb",(function(t,e){function o(t,e){let o=`\n\t\t<li class="list-group-item p-1 my-1" id="${t}" data-id="${t}">\n\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t<button type="button" class="btn btn-outline-light" id="reorder" title="Change ordering">\n\t\t\t\t\t<i class="fas fa-bars"></i>\n\t\t\t\t</button>\n\t\t\t\t<input type="text" class="form-control" id="title" aria-label="Title" aria-describedby="num" />\n\t\t\t\t<span class="input-group-text" id="num"></span>\n\t\t\t</div>\n\t\t</li>\n\t`;e?$(`li[data-id="${e}"]`).after(o):$("ul#scenes").append(o)}function i(t){let e="";for(let o=0;o<_BASEMAPS.length;o++){let i=_BASEMAPS[o];""!==i.name&&t||(e+=`\n\t\t\t<div class="col">\n\t\t\t\t<div class="card mt-2">\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<h6 class="card-title mb-0">${i.name}</h6>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class="card-img-bottom" id="basemaps" src="${i.preview}" alt="${i.name}" data-basemap="${o}" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}t&&(e+=`\n\t\t\t<div class="col">\n\t\t\t\t<div class="card mt-2">\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<div class="d-grid">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary" id="uploadBasemap" ${_USER_PAID?"":"disabled"}>+</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),$(t?"#basemapModal #imgBasemapChoose":"#basemapModal #basemapChoose").html(e)}function n(){return'\n\t\t<form class="container-fluid objectPopup" id="avatarPopup">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" id="label" aria-label="label" placeholder="Label" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<div class="input-group-text">\n\t\t\t\t\t\t\t<input type="checkbox" class="form-check-input mt-0" id="rounded" value="" aria-label="Rounded" title="Rounded" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type="number" min="10" max="500" step="1" class="form-control" id="size" placeholder="Size" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="accordion" id="iconAccordion">\n\t\t\t\t\t\t<div class="accordion-item">\n\t\t\t\t\t\t\t<h2 class="accordion-header" id="iconAccordionHeading">\n\t\t\t\t\t\t\t\t<button class="accordion-button collapsed py-1 px-2" type="button" data-bs-toggle="collapse" data-bs-target="#iconAccordionCollapse" aria-expanded="false" aria-controls="iconAccordionCollapse">\n\t\t\t\t\t\t\t\t\tIcon\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div id="iconAccordionCollapse" class="accordion-collapse collapse" aria-labelledby="iconAccordionHeading" data-bs-parent="#iconAccordion">\n\t\t\t\t\t\t\t\t<div class="accordion-body py-1" style="max-height: 80px; overflow-y: auto;">\n\t\t\t\t\t\t\t\t\t<div class="row row-cols-5" id="iconChoose">\n\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary" id="iconAdd" title="Add icon">+</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="color" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="0" max="10" class="form-control" id="thickness" placeholder="Thickness" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="number" min="0" max="3" step="0.1" class="form-control" id="blur" placeholder="Blur" />\n\t\t\t\t\t\t<input type="number" min="0" max="1" step="0.1" class="form-control" id="grayscale" placeholder="Grayscale" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="number" min="0" max="6" step="1" class="form-control" id="brightness" placeholder="Brightness" />\n\t\t\t\t\t\t<input type="number" min="0" max="0.9" step="0.1" class="form-control" id="transparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row mb-2">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm" id="animationSpeed" min="0.1" max="10" step="0.1" aria-label="Animation speed" placeholder="Animation speed (sec.)" title="This objects animation speed to next scene" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary py-0" id="makeGlobal" title="Save options globally">\n\t\t\t\t\t\t<i class="fas fa-save"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t'}function a(){return'\n\t\t<form class="container-fluid objectPopup" id="shapePopup">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" id="label" aria-label="label" placeholder="Label" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="lineColor" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="2" max="10" class="form-control" id="lineThickness" placeholder="Thickness" />\n\t\t\t\t\t\t<input type="number" min="0" max="0.9" step="0.1" class="form-control" id="lineTransparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-check mt-1">\n\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" id="dashed">\n\t\t\t\t\t\t<label class="form-check-label" for="dashed">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row mb-2">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm" id="animationSpeed" min="0.1" max="10" step="0.1" aria-label="Animation speed" placeholder="Animation speed (sec.)" title="This objects animation speed to next scene" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary py-0" id="makeGlobal" title="Save options globally">\n\t\t\t\t\t\t<i class="fas fa-save"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t'}function s(){return'\n\t\t<form class="container-fluid objectPopup" id="shapePopup">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="text" class="form-control form-control-sm" id="label" aria-label="label" placeholder="Label" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="lineColor" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="2" max="10" class="form-control" id="lineThickness" placeholder="Thickness" />\n\t\t\t\t\t\t<input type="number" min="0" max="0.9" step="0.1" class="form-control" id="lineTransparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-check mt-1">\n\t\t\t\t\t\t<input class="form-check-input" type="checkbox" value="" id="dashed">\n\t\t\t\t\t\t<label class="form-check-label" for="dashed">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row my-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="input-group input-group-sm">\n\t\t\t\t\t\t<input type="color" class="form-control form-control-color" id="fillColor" value="#563d7c" title="Choose color" />\n\t\t\t\t\t\t<input type="number" min="0" max="1" step="0.1" class="form-control" id="fillTransparency" placeholder="Transparency" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row mb-2">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm" id="animationSpeed" min="0.1" max="10" step="0.1" aria-label="Animation speed" placeholder="Animation speed (sec.)" title="This objects animation speed to next scene" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="row">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary py-0" id="makeGlobal" title="Save options globally">\n\t\t\t\t\t\t<i class="fas fa-save"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t'}$parcel$export(t.exports,"new_scene",(function(){return o})),$parcel$export(t.exports,"generate_basemaps",(function(){return i})),$parcel$export(t.exports,"avatar_popup",(function(){return n})),$parcel$export(t.exports,"polyline_popup",(function(){return a})),$parcel$export(t.exports,"polygon_popup",(function(){return s}))})),parcelRequire.register("gUPg4",(function(t,e){$parcel$export(t.exports,"Scenes",(function(){return n}));var o=parcelRequire("aykGt"),i=parcelRequire("4XDZb");function n(){this.store=[],this.active="",this.copiedBounds=null,this.setup=function(){$("#scenes").sortable({cursor:"move",handle:"button#reorder",items:"> li",containment:"parent",tolerance:"pointer",cancel:"",zIndex:1003,axis:"x",start:(t,e)=>{t.stopPropagation(),this.unbind()},update:(t,e)=>{t.stopPropagation(),this.reorder($("#scenes").sortable("toArray"))},stop:(t,e)=>{t.stopPropagation(),this.bind()}}),$("#sceneRow button#delete, #sceneRow button#recapture").prop("disabled",!1)},this.reset=function(){$("#scenes").sortable("destroy"),$("#sceneRow button#delete, #sceneRow button#recapture").prop("disabled",!0)},this.get=function(t){for(let e=0;e<this.store.length;e++){let o=Object.assign({},this.store[e]);if(o.id==t)return o.index=e,o}return null},this.getEl=function(t){for(let e=0;e<this.store.length;e++){let o=Object.assign({},this.store[e]);if($(`li[data-id="${o.id}"]`)[0].contains(t))return o.index=e,o}return null},this.getPrevScene=function(t){let e=this.get(t);if(e&&!(e.index<=0))return Object.assign({},this.store[e.index-1])},this.reorder=function(t){this.store.sort(((e,o)=>t.indexOf(e.id)-t.indexOf(o.id))),this.set(this.active)},this.add=function(){this.store.length<=0&&document.dispatchEvent(new Event("_setup"));let t=new a(null,this.active);t.capture(),this.active?this.store.splice(this.get(this.active).index+1,0,t):this.store.push(t),_TEXTBOXES.addScene(t.id),_MAP.addScene(t.id),this.set(t.id),this.bind(),(0,o.save_data)()},this.capture=function(){if(!this.active)return;this.store[this.get(this.active).index].capture(),(0,o.flash_map)(),(0,o.save_data)()},this.delete=function(){if(!this.active)return;let t=this.get(this.active);_TEXTBOXES.deleteScene(t.id),_MAP.deleteScene(t.id),this.prev()||this.next(),this.store.splice(t.index,1),$(`li[data-id="${t.id}"]`).remove(),this.setNumbering(),this.store.length<=0&&(this.active="",document.dispatchEvent(new Event("_reset"))),(0,o.save_data)()},this.unbind=function(){$("#scenes li button#reorder").prop("disabled",!0),$("#scenes li").off("click")},this.bind=function(){$("#scenes li button#reorder").prop("disabled",!1),$("#scenes li").off("click"),$("#scenes li").click((t=>{let e=this.getEl(t.target);e&&($(`li[data-id="${e.id}"]`).hasClass("active")||this.set(e.id))}))},this.prev=function(){let t=this.get(this.active);if(t&&!(t.index<=0))return t=this.store[t.index-1],this.set(t.id),Object.assign({},t)},this.current=function(){this.set(this.active),this.bind()},this.next=function(){let t=this.get(this.active);if(t&&!(t.index>=this.store.length-1))return t=this.store[t.index+1],this.set(t.id),Object.assign({},t)},this.set=function(t){this.active&&this.get(this.active).disable(),this.active=t;let e=this.get(t);e.enable(),$(`li[data-id="${e.id}"]`)[0].scrollIntoView({behavior:"smooth",inline:"center"}),_TEXTBOXES.set(e.id),_MAP.set(e.id),this.setNumbering()},this.setWMS=function(){this.store[this.get(this.active).index].setWMS()},this.setBasemap=function(){this.store[this.get(this.active).index].setBasemap()},this.setBookmark=function(t){if(!this.active)return;this.store[this.get(this.active).index].setBookmark(t),(0,o.save_data)()},this.setNumbering=function(){let t=1;for(let e of $("#scenes li span#num"))$(e).html(t++)},this.copyBounds=function(){this.active&&(this.copiedBounds=this.get(this.active).bounds)},this.pasteBounds=function(){if(!this.active)return;this.store[this.get(this.active).index].setBounds(this.copiedBounds)},this.importData=function(t){if(!(t.length<=0)){(this.store.length<=0||!this.active)&&(this.active=t[0].id);for(let e of t){let t=new a(e.id);t.bounds=e.bounds,t.wms=e.wms,t.basemap=e.basemap,t.setBookmark(e.bookmark),t.setTitle(e.title),t.disable(),this.store.push(t)}}},this.exportData=function(){let t=[];for(let e of this.store)t.push(e.exportData());return t}}function a(t,e){this.id=t||(0,o.uuid)(),this.bounds=null,this.wms=null,this.basemap=null,this.bookmark=!1,this.title="",(0,i.new_scene)(this.id,e),$(`li[data-id="${this.id}"]`).on("keydown keyup",(t=>{t.stopPropagation()})),$(`li[data-id="${this.id}"] input#title`).change((t=>{this.title=t.target.value})),this.enable=function(){$(`li[data-id="${this.id}"]`).addClass("active"),$(`li[data-id="${this.id}"] input, li[data-id="${this.id}"] button`).prop("disabled",!1),$(`li[data-id="${this.id}"] input, li[data-id="${this.id}"] button`).click((t=>{t.stopPropagation()}))},this.disable=function(){$(`li[data-id="${this.id}"]`).removeClass("active"),$(`li[data-id="${this.id}"] input`).prop("disabled",!0),$(`li[data-id="${this.id}"] input, li[data-id="${this.id}"] button`).off("click")},this.setBounds=function(t){this.bounds=t,_MAP.setFlyTo(this.bounds)},this.setWMS=function(){this.wms=_MAP.getWMS()},this.setBasemap=function(){this.basemap=_MAP.getBasemap()},this.setBookmark=function(t){this.bookmark=t,t?$(`li[data-id="${this.id}"]`).addClass("bookmark"):$(`li[data-id="${this.id}"]`).removeClass("bookmark")},this.setTitle=function(t){this.title=t,$(`li[data-id="${this.id}"] input#title`).val(this.title)},this.capture=function(){let t=_MAP.getBounds().getNorthWest(),e=_MAP.getBounds().getSouthEast();this.setBounds([[t.lat,t.lng],[e.lat,e.lng]]),this.setBasemap()},this.exportData=function(){return{id:this.id,bounds:this.bounds,wms:this.wms,basemap:this.basemap,bookmark:this.bookmark,title:this.title}}}})),parcelRequire.register("aDjZZ",(function(t,e){$parcel$export(t.exports,"Textboxes",(function(){return i})),parcelRequire("84MkT");var o=parcelRequire("aykGt");function i(){this.store=[],$("input#_img_textbox").change((function(t){let e=$(this)[0].files[0];if(!e)return;$("#loadingModal").modal("show");let o=new FormData;o.append("type","image"),o.append("image",e),$.ajax({type:"POST",url:"api/upload_create.php",data:o,contentType:!1,processData:!1,success:function(t,e,o){$("#textbox #content").trumbowyg("execCmd",{cmd:"insertImage",param:t,forceCss:!1,skipTrumbowyg:!0}),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.log(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})})),$("#textbox input#lock").change((t=>{this.setLock(t.target.checked)})),$("#textbox button#close").click((t=>{this.delete(_SCENES.active)})),$("#textboxOptionsModal select#bookOrientation").change((t=>{this.setOrientation(t.target.value)})),this.setup=function(){$("#textbox").resizable({containment:"#mapRow",handles:"e",minWidth:100,stop:(t,e)=>{let o=e.size.width/($("#mapRow").outerWidth()-20),i=this.get(_SCENES.active);i&&(this.store[i.index].dim=[0,o],$("#textbox").css({width:100*o+"%"}),"right"==i.pos&&$("#textbox").css({left:"auto"}))}}),$("#textbox #content").trumbowyg({autogrow:!0,semantic:!1,resetCss:!0,removeformatPasted:!0,urlProtocol:!0,defaultLinkTarget:"_blank",tagsToRemove:["script","link"],btnsDef:{format:{dropdown:["bold","italic","underline","del"],title:"Format",ico:"bold"},align:{dropdown:["justifyLeft","justifyCenter","justifyRight","justifyFull","unorderedList","orderedList"],title:"List/Align",ico:"justifyLeft"},uploadImg:{fn:t=>{$("input#_img_textbox").click()},title:"Add image",ico:"insertImage"},makeLink:{fn:t=>{$("#textbox #content").trumbowyg("saveRange");let e=$("#textbox #content").trumbowyg("getRangeText");""!=e.replace(/\s/g,"")&&(["http","https"].indexOf(e.split("://")[0])<0&&(e=`https://${e}`),$("#textbox #content").trumbowyg("execCmd",{cmd:"insertHTML",param:`<a href="${e}" target="_blank">${e}</a>`,forceCss:!1}))},title:"Create link",ico:"link"}},btns:[["formatting"],["format"],["align"],["fontfamily"],["foreColor","backColor"],["makeLink"],["uploadImg"]],plugins:{}}).on("tbwchange",(()=>{let t=this.get(_SCENES.active);t&&(this.store[t.index].content=$("#textbox #content").trumbowyg("html"))})),_MAP.setOrientation("right")},this.reset=function(){$("#textbox").resizable("destroy"),$("#textbox #content").trumbowyg("destroy"),_MAP.setOrientation("right")},this.get=function(t){for(let e=0;e<this.store.length;e++){let o=Object.assign({},this.store[e]);if(o.sceneId==t)return o.index=e,o}return null},this.add=function(){if(!_SCENES.active)return;let t=new n(null);t.sceneId=_SCENES.active,t.enable(),this.store.push(t),(0,o.save_data)()},this.addScene=function(t){let e=_SCENES.getPrevScene(t);if(e)for(let o of this.store)if(o.sceneId==e.id&&o.locked){let e=new n(null);e.sceneId=t,e.pos=o.pos,e.dim=o.dim,e.content=o.content,e.locked=!0,e.enable(),this.store.push(e);break}},this.delete=function(t){let e=this.get(t);e&&(e.disable(),this.store.splice(e.index,1),(0,o.save_data)())},this.deleteScene=function(t){for(let e of this.store)e.sceneId==t&&this.delete(e.sceneId)},this.set=function(t){for(let e of this.store){if(e.sceneId==t){e.enable();break}e.disable()}},this.setLock=function(t){let e=this.get(_SCENES.active);e&&this.store[e.index].setLock(t)},this.setOrientation=function(t){let e=this.get(_SCENES.active);e&&(this.store[e.index].pos=t,this.store[e.index].setOrientation())},this.importData=function(t){if(!(t.length<=0))for(let e of t){let t=new n(e.id);t.sceneId=e.sceneId,e.pos&&(t.pos=e.pos),e.dim&&(t.dim=e.dim),t.content=e.content,t.locked=e.locked,t.disable(),this.store.push(t)}},this.exportData=function(){let t=[];for(let e of this.store)t.push(e.exportData());return t}}function n(t){this.id=t||(0,o.uuid)(),this.sceneId="",this.locked=!1,this.pos="left",this.dim=[0,.25],this.content="",this.setOrientation=function(){switch(this.pos){case"left":$("#textbox").css({left:"10px",right:"auto"}),$("#textbox").resizable("option",{handles:"e"}),_MAP.setOrientation("right");break;case"right":$("#textbox").css({left:"auto",right:"10px"}),$("#textbox").resizable("option",{handles:"w"}),_MAP.setOrientation("left")}},this.setLock=function(t){this.locked=t,$("#textbox input#lock").prop("checked",this.locked)},this.enable=function(){this.setOrientation(),$("#textbox").css("display","block"),$("#textbox").css({width:100*this.dim[1]+"%"}),$("#textbox #content").trumbowyg("enable"),$("#textbox #content").trumbowyg("html",this.content),$("#textbox #lock").prop({disabled:!1,checked:this.locked}),_MAP.textboxButton.disable()},this.disable=function(){$("#textbox").css("display","none"),$("#textbox #content").trumbowyg("disable"),$("#textbox #lock").prop("disabled",!0),_MAP.textboxButton.enable()},this.exportData=function(){return{id:this.id,sceneId:this.sceneId,locked:this.locked,pos:this.pos,dim:this.dim,content:this.content}}}})),parcelRequire.register("84MkT",(function(t,e){
/**
 * Trumbowyg v2.26.0 - A lightweight WYSIWYG editor
 * Trumbowyg core file
 * ------------------------
 * @link http://alex-d.github.io/Trumbowyg
 * @license MIT
 * @author Alexandre Demode (Alex-D)
 *         Twitter : @AlexandreDemode
 *         Website : alex-d.fr
 */
jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",_self:"Same tab (default)",_blank:"New tab",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,svgAbsoluteUseHref:!1,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,hideButtonTexts:null,prefix:"trumbowyg-",tagClasses:{},semantic:!0,semanticKeepAttributes:!1,resetCss:!1,removeformatPasted:!1,tabToIndent:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},changeActiveDropdownIcon:!1,inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1,linkTargets:["_self","_blank"],svgPath:null},writable:!1,enumerable:!0,configurable:!1}),function(t,e,o,i){"use strict";var n="tbwconfirm",a="tbwcancel";i.fn.trumbowyg=function(t,e){var o="trumbowyg";if(t===Object(t)||!t)return this.each((function(){i(this).data(o)||i(this).data(o,new s(this,t))}));if(1===this.length)try{var n=i(this).data(o);switch(t){case"execCmd":return n.execCmd(e.cmd,e.param,e.forceCss,e.skipTrumbowyg);case"openModal":return n.openModal(e.title,e.content);case"closeModal":return n.closeModal();case"openModalInsert":return n.openModalInsert(e.title,e.fields,e.callback);case"saveRange":return n.saveRange();case"getRange":return n.range;case"getRangeText":return n.getRangeText();case"restoreRange":return n.restoreRange();case"enable":return n.setDisabled(!1);case"disable":return n.setDisabled(!0);case"toggle":return n.toggle();case"destroy":return n.destroy();case"empty":return n.empty();case"html":return n.html(e)}}catch(t){}return!1};var s=function(n,a){var s=this,r="trumbowyg-icons",l=i.trumbowyg;s.doc=n.ownerDocument||o,s.$ta=i(n),s.$c=i(n),null!=(a=a||{}).lang||null!=l.langs[a.lang]?s.lang=i.extend(!0,{},l.langs.en,l.langs[a.lang]):s.lang=l.langs.en,s.hideButtonTexts=null!=l.hideButtonTexts?l.hideButtonTexts:a.hideButtonTexts;var c=null!=l.svgPath?l.svgPath:a.svgPath;if(s.hasSvg=!1!==c,!1!==c&&(l.svgAbsoluteUseHref||0===i("#trumbowyg-icons",s.doc).length)){if(null==c)i("script[src]").each((function(t,e){var o=e.src,i=o.match("trumbowyg(.min)?.js");null!=i&&(c=o.substring(0,o.indexOf(i[0]))+"ui/icons.svg")}));if(null==c)console.warn("You must define svgPath: https://goo.gl/CfTY9U");else if(!l.svgAbsoluteUseHref){var d=s.doc.createElement("div");d.id=r,s.doc.body.insertBefore(d,s.doc.body.childNodes[0]),i.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:c,data:null,beforeSend:null,complete:null,success:function(t){d.innerHTML=(new XMLSerializer).serializeToString(t.documentElement)}})}}var p=s.doc.querySelector("base")?e.location.href.replace(e.location.hash,""):"";s.svgPath=l.svgAbsoluteUseHref?c:p;var u=s.lang.header,h=function(){return(e.chrome||e.Intl&&Intl.v8BreakIterator)&&"CSS"in e};s.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable"},undo:{isSupported:h,key:"Z"},redo:{isSupported:h,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:u+" 1"},h2:{fn:"formatBlock",title:u+" 2"},h3:{fn:"formatBlock",title:u+" 3"},h4:{fn:"formatBlock",title:u+" 4"},h5:{fn:"formatBlock",title:u+" 5"},h6:{fn:"formatBlock",title:u+" 6"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},s.o=i.extend(!0,{},l.defaultOptions,a),s.o.hasOwnProperty("imgDblClickHandler")||(s.o.imgDblClickHandler=s.getDefaultImgDblClickHandler()),s.urlPrefix=s.setupUrlPrefix(),s.disabled=s.o.disabled||"TEXTAREA"===n.nodeName&&n.disabled,a.btns?s.o.btns=a.btns:s.o.semantic||(s.o.btns[3]=["bold","italic","underline","strikethrough"]),i.each(s.o.btnsDef,(function(t,e){s.addBtnDef(t,e)})),s.eventNamespace="trumbowyg-event",s.keys=[],s.tagToButton={},s.tagHandlers=[],s.pasteHandlers=[].concat(s.o.pasteHandlers),s.isIE=-1!==t.userAgent.indexOf("MSIE")||-1!==t.appVersion.indexOf("Trident/"),s.isMac=-1!==t.platform.toUpperCase().indexOf("MAC"),s.init()};s.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var t=this;t.height=t.$ta.height(),t.initPlugins();try{t.doc.execCommand("enableObjectResizing",!1,!1),t.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(t){}t.buildEditor(),t.buildBtnPane(),t.fixedBtnPaneEvents(),t.buildOverlay(),setTimeout((function(){t.disabled&&t.setDisabled(!0),t.$c.trigger("tbwinit")}))},addBtnDef:function(t,e){this.btnsDef[t]=i.extend(e,this.btnsDef[t]||{})},setupUrlPrefix:function(){var t=this.o.urlProtocol;if(t)return"string"!=typeof t?"https://":t.replace("://","")+"://"},buildEditor:function(){var t=this,o=t.o.prefix,n="";t.$box=i("<div/>",{class:o+"box "+o+"editor-visible "+o+t.o.lang+" trumbowyg"}),t.isTextarea=t.$ta.is("textarea"),t.isTextarea?(n=t.$ta.val(),t.$ed=i("<div/>"),t.$box.insertAfter(t.$ta).append(t.$ed,t.$ta)):(t.$ed=t.$ta,n=t.$ed.html(),t.$ta=i("<textarea/>",{name:t.$ta.attr("id"),height:t.height}).val(n),t.$box.insertAfter(t.$ed).append(t.$ta,t.$ed),t.syncCode()),t.$ta.addClass(o+"textarea").attr("tabindex",-1),t.$ed.addClass(o+"editor").attr({contenteditable:!0,dir:t.lang._dir||"ltr"}).html(n),t.o.tabindex&&t.$ed.attr("tabindex",t.o.tabindex),t.$c.is("[placeholder]")&&t.$ed.attr("placeholder",t.$c.attr("placeholder")),t.$c.is("[spellcheck]")&&t.$ed.attr("spellcheck",t.$c.attr("spellcheck")),t.o.resetCss&&t.$ed.addClass(o+"reset-css"),t.o.autogrow||t.$ta.add(t.$ed).css({height:t.height}),t.semanticCode(),t.o.autogrowOnEnter&&t.$ed.addClass(o+"autogrow-on-enter");var a,s=!1,r=!1;t.$ed.on("dblclick","img",t.o.imgDblClickHandler).on("keydown",(function(e){var o=e.which;if(8!==o&&13!==o&&46!==o||t.toggleSpan(!0),!e.ctrlKey&&!e.metaKey||e.altKey){if(t.o.tabToIndent&&"Tab"===e.key)try{return e.shiftKey?t.execCmd("outdent",!0,null):t.execCmd("indent",!0,null),!1}catch(t){}}else{s=!0;var i=t.keys[String.fromCharCode(e.which).toUpperCase()];try{return t.execCmd(i.fn,i.param),!1}catch(t){}}})).on("compositionstart compositionupdate",(function(){r=!0})).on("keyup compositionend",(function(e){if("compositionend"===e.type)r=!1;else if(r)return;var o=e.which;if(!(o>=37&&o<=40)){if(8!==o&&13!==o&&46!==o||t.toggleSpan(),!e.ctrlKey&&!e.metaKey||89!==o&&90!==o)if(s||17===o)void 0===e.which&&t.semanticCode(!1,!1,!0);else{var i=!t.isIE||"compositionend"===e.type;t.semanticCode(!1,i&&13===o),t.$c.trigger("tbwchange")}else t.semanticCode(!1,!0),t.$c.trigger("tbwchange");setTimeout((function(){s=!1}),50)}})).on("mouseup keydown keyup",(function(e){(!e.ctrlKey&&!e.metaKey||e.altKey)&&setTimeout((function(){s=!1}),50),clearTimeout(a),a=setTimeout((function(){t.updateButtonPaneStatus()}),50)})).on("focus blur",(function(e){if("blur"===e.type&&t.clearButtonPaneStatus(),t.$c.trigger("tbw"+e.type),t.o.autogrowOnEnter){if(t.autogrowOnEnterDontClose)return;"focus"===e.type?(t.autogrowOnEnterWasFocused=!0,t.autogrowEditorOnEnter()):t.o.autogrow||(t.$ed.css({height:t.$ed.css("min-height")}),t.$c.trigger("tbwresize"))}})).on("keyup focus",(function(){t.$ta.val().match(/<.*>/)||t.$ed.html().match(/<.*>/)||setTimeout((function(){var e=t.isIE?"<p>":"p";t.doc.execCommand("formatBlock",!1,e),t.syncCode()}),0)})).on("cut drop",(function(){setTimeout((function(){t.semanticCode(!1,!0),t.$c.trigger("tbwchange")}),0)})).on("paste",(function(o){if(t.o.removeformatPasted){o.preventDefault(),e.getSelection&&e.getSelection().deleteFromDocument&&e.getSelection().deleteFromDocument();try{var n=e.clipboardData.getData("Text");try{t.doc.selection.createRange().pasteHTML(n)}catch(e){t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(n))}t.$c.trigger("tbwchange",o)}catch(e){t.execCmd("insertText",(o.originalEvent||o).clipboardData.getData("text/plain"))}}i.each(t.pasteHandlers,(function(t,e){e(o)})),setTimeout((function(){t.semanticCode(!1,!0),t.$c.trigger("tbwpaste",o),t.$c.trigger("tbwchange")}),0)})),t.$ta.on("keyup",(function(){t.$c.trigger("tbwchange")})).on("paste",(function(){setTimeout((function(){t.$c.trigger("tbwchange")}),0)})),i(t.doc.body).on("keydown."+t.eventNamespace,(function(e){if(27===e.which&&i("."+o+"modal-box").length>=1)return t.closeModal(),!1}))},autogrowEditorOnEnter:function(){var t=this;t.$ed.removeClass("autogrow-on-enter");var e=t.$ed[0].clientHeight;t.$ed.height("auto");var o=t.$ed[0].scrollHeight;t.$ed.addClass("autogrow-on-enter"),e!==o&&(t.$ed.height(e),setTimeout((function(){t.$ed.css({height:o}),t.$c.trigger("tbwresize")}),0))},buildBtnPane:function(){var t=this,e=t.o.prefix,o=t.$btnPane=i("<div/>",{class:e+"button-pane"});i.each(t.o.btns,(function(n,a){i.isArray(a)||(a=[a]);var s=i("<div/>",{class:e+"button-group "+(a.indexOf("fullscreen")>=0?e+"right":"")});i.each(a,(function(e,o){try{t.isSupportedBtn(o)&&s.append(t.buildBtn(o))}catch(t){}})),s.html().trim().length>0&&o.append(s)})),t.$box.prepend(o)},buildBtn:function(t){var e=this,o=e.o.prefix,n=e.btnsDef[t],a=n.dropdown,s=null==n.hasIcon||n.hasIcon,r=e.lang[t]||t,l=i("<button/>",{type:"button",class:o+t+"-button "+(n.class||"")+(s?"":" "+o+"textual-button"),html:e.hasSvg&&s?'<svg><use xlink:href="'+e.svgPath+"#"+o+(n.ico||t).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':e.hideButtonTexts?"":n.text||n.title||e.lang[t]||t,title:(n.title||n.text||r)+(n.key?" ("+(e.isMac?"Cmd":"Ctrl")+" + "+n.key+")":""),tabindex:-1,mousedown:function(){return a&&!i("."+t+"-"+o+"dropdown",e.$box).is(":hidden")||i("body",e.doc).trigger("mousedown"),!((e.$btnPane.hasClass(o+"disable")||e.$box.hasClass(o+"disabled"))&&!i(this).hasClass(o+"active")&&!i(this).hasClass(o+"not-disable"))&&(e.execCmd((!a?n.fn:"dropdown")||t,n.param||t,n.forceCss),!1)}});if(a){l.addClass(o+"open-dropdown");var c=o+"dropdown",d={class:c+"-"+t+" "+c+" "+o+"fixed-top "+(n.dropdownClass||"")};d["data-"+c]=t;var p=i("<div/>",d);i.each(a,(function(t,o){e.btnsDef[o]&&e.isSupportedBtn(o)&&p.append(e.buildSubBtn(o))})),e.$box.append(p.hide())}else n.key&&(e.keys[n.key]={fn:n.fn||t,param:n.param||t});return a||(e.tagToButton[(n.tag||t).toLowerCase()]=t),l},buildSubBtn:function(t){var e=this,o=e.o.prefix,n=e.btnsDef[t],a=null==n.hasIcon||n.hasIcon;return n.key&&(e.keys[n.key]={fn:n.fn||t,param:n.param||t}),e.tagToButton[(n.tag||t).toLowerCase()]=t,i("<button/>",{type:"button",class:o+t+"-dropdown-button "+(n.class||"")+(n.ico?" "+o+n.ico+"-button":""),html:e.hasSvg&&a?'<svg><use xlink:href="'+e.svgPath+"#"+o+(n.ico||t).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(n.text||n.title||e.lang[t]||t):n.text||n.title||e.lang[t]||t,title:n.key?"("+(e.isMac?"Cmd":"Ctrl")+" + "+n.key+")":null,style:n.style||null,mousedown:function(){return i("body",e.doc).trigger("mousedown"),e.execCmd(n.fn||t,n.param||t,n.forceCss),!1}})},isSupportedBtn:function(t){try{return this.btnsDef[t].isSupported()}catch(t){}return!0},buildOverlay:function(){var t=this;return t.$overlay=i("<div/>",{class:t.o.prefix+"overlay"}).appendTo(t.$box),t.$overlay},showOverlay:function(){var t=this;i(e).trigger("scroll"),t.$overlay.fadeIn(200),t.$box.addClass(t.o.prefix+"box-blur")},hideOverlay:function(){var t=this;t.$overlay.fadeOut(50),t.$box.removeClass(t.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var t=this,o=t.o.fixedFullWidth,n=t.$box;t.o.fixedBtnPane&&(t.isFixed=!1,i(e).on("scroll."+t.eventNamespace+" resize."+t.eventNamespace,(function(){if(n){t.syncCode();var a=i(e).scrollTop(),s=n.offset().top+1,r=t.$btnPane,l=r.outerHeight()-2;a-s>0&&a-s-t.height<0?(t.isFixed||(t.isFixed=!0,r.css({position:"fixed",top:0,left:o?0:"auto",zIndex:7}),t.$box.css({paddingTop:r.height()})),r.css({width:o?"100%":n.width()-1}),i("."+t.o.prefix+"fixed-top",n).css({position:o?"fixed":"absolute",top:o?l:l+(a-s),zIndex:15})):t.isFixed&&(t.isFixed=!1,r.removeAttr("style"),t.$box.css({paddingTop:0}),i("."+t.o.prefix+"fixed-top",n).css({position:"absolute",top:l}))}})))},setDisabled:function(t){var e=this,o=e.o.prefix;e.disabled=t,t?e.$ta.attr("disabled",!0):e.$ta.removeAttr("disabled"),e.$box.toggleClass(o+"disabled",t),e.$ed.attr("contenteditable",!t)},destroy:function(){var t=this,o=t.o.prefix;t.isTextarea?t.$box.after(t.$ta.css({height:""}).val(t.html()).removeClass(o+"textarea").show()):t.$box.after(t.$ed.css({height:""}).removeClass(o+"editor").removeAttr("contenteditable").removeAttr("dir").html(t.html()).show()),t.$ed.off("dblclick","img"),t.destroyPlugins(),t.$box.remove(),t.$c.removeData("trumbowyg"),i("body").removeClass(o+"body-fullscreen"),t.$c.trigger("tbwclose"),i(e).off("scroll."+t.eventNamespace+" resize."+t.eventNamespace),i(t.doc.body).off("keydown."+t.eventNamespace)},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var t=this,e=t.o.prefix;t.o.autogrowOnEnter&&(t.autogrowOnEnterDontClose=!t.$box.hasClass(e+"editor-hidden")),t.semanticCode(!1,!0),t.$c.trigger("tbwchange"),setTimeout((function(){t.doc.activeElement.blur(),t.$box.toggleClass(e+"editor-hidden "+e+"editor-visible"),t.$btnPane.toggleClass(e+"disable"),i("."+e+"viewHTML-button",t.$btnPane).toggleClass(e+"active"),t.$box.hasClass(e+"editor-visible")?t.$ta.attr("tabindex",-1):t.$ta.removeAttr("tabindex"),t.o.autogrowOnEnter&&!t.autogrowOnEnterDontClose&&t.autogrowEditorOnEnter()}),0)},toggleSpan:function(t){this.$ed.find("span").each((function(){!0===t?i(this).attr("data-tbw-flag",!0):i(this).attr("data-tbw-flag")?i(this).removeAttr("data-tbw-flag"):i(this).contents().unwrap()}))},dropdown:function(t){var o=this,n=i("body",o.doc),a=o.o.prefix,s=i("[data-"+a+"dropdown="+t+"]",o.$box),r=i("."+a+t+"-button",o.$btnPane),l=s.is(":hidden");if(n.trigger("mousedown"),l){var c=r.offset().left;r.addClass(a+"active"),s.css({position:"absolute",top:r.offset().top-o.$btnPane.offset().top+r.outerHeight(),left:o.o.fixedFullWidth&&o.isFixed?c:c-o.$btnPane.offset().left}).show(),i(e).trigger("scroll"),n.on("mousedown."+o.eventNamespace,(function(t){s.is(t.target)||(i("."+a+"dropdown",o.$box).hide(),i("."+a+"active",o.$btnPane).removeClass(a+"active"),n.off("mousedown."+o.eventNamespace))}))}},html:function(t){var e=this;return null!=t?(e.$ta.val(t),e.syncCode(!0),e.$c.trigger("tbwchange"),e):e.$ta.val()},syncTextarea:function(){var t=this;t.$ta.val(t.$ed.text().trim().length>0||t.$ed.find(t.o.tagsToKeep.join(",")).length>0?t.$ed.html():"")},syncCode:function(t){var e=this;if(!t&&e.$ed.is(":visible"))e.syncTextarea();else{var o=i("<div>").html(e.$ta.val()),n=i("<div>").append(o);i(e.o.tagsToRemove.join(","),n).remove(),e.$ed.html(n.contents().html())}if(e.o.autogrow&&(e.height=e.$ed.height(),e.height!==e.$ta.css("height")&&(e.$ta.css({height:e.height}),e.$c.trigger("tbwresize"))),e.o.autogrowOnEnter){e.$ed.height("auto");var a=e.autogrowOnEnterWasFocused?e.$ed[0].scrollHeight:e.$ed.css("min-height");a!==e.$ta.css("height")&&(e.$ed.css({height:a}),e.$c.trigger("tbwresize"))}},semanticCode:function(t,e,o){var n=this;n.saveRange(),n.syncCode(t);var a=!0;if(n.range&&n.range.collapsed&&(a=!1),n.o.semantic){if(n.semanticTag("b",n.o.semanticKeepAttributes),n.semanticTag("i",n.o.semanticKeepAttributes),n.semanticTag("s",n.o.semanticKeepAttributes),n.semanticTag("strike",n.o.semanticKeepAttributes),e){var s=n.o.inlineElementsSelector,r=":not("+s+")";n.$ed.contents().filter((function(){return 3===this.nodeType&&this.nodeValue.trim().length>0})).wrap("<span data-tbw/>");var l=function(t){if(0!==t.length){var e=t.nextUntil(r).addBack().wrapAll("<p/>").parent(),o=e.nextAll(s).first();e.next("br").remove(),l(o)}};l(n.$ed.children(s).first()),n.semanticTag("div",!0),i("[data-tbw]",n.$ed).contents().unwrap(),n.$ed.find("p:empty").remove()}!o&&a&&n.restoreRange(),n.syncTextarea()}},semanticTag:function(t,e,o){var n,a=this,s=t;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(t))n=this.o.semantic[t];else{if(!0!==this.o.semantic||!this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(t))return;n=this.DEFAULT_SEMANTIC_MAP[t]}o&&(t=n,n=s),i(t,this.$ed).each((function(){var t=!1,o=i(this);if(0===o.contents().length)return!1;a.range&&a.range.startContainer.parentNode===this&&(t=!0);var s=i("<"+n+"/>");s.insertBefore(o),e&&i.each(o.prop("attributes"),(function(){s.attr(this.name,this.value)})),s.html(o.html()),o.remove(),!0===t&&(a.range.selectNodeContents(s.get(0)),a.range.collapse(!1))}))},createLink:function(){for(var t,e,o,n=this,a=n.doc.getSelection(),s=a.getRangeAt(0),r=a.focusNode,l=(new XMLSerializer).serializeToString(s.cloneContents())||s+"",c=n.o.linkTargets[0];["A","DIV"].indexOf(r.nodeName)<0;)r=r.parentNode;if(r&&"A"===r.nodeName){var d=i(r);l=d.text(),t=d.attr("href"),n.o.minimalLinks||(e=d.attr("title"),o=d.attr("target")||c);var p=n.doc.createRange();p.selectNode(r),a.removeAllRanges(),a.addRange(p)}n.saveRange();var u={url:{label:n.lang.linkUrl||"URL",required:!0,value:t},text:{label:n.lang.text,value:l}};if(!n.o.minimalLinks){var h=n.o.linkTargets.reduce((function(t,e){return t[e]=n.lang[e],t}),{});i.extend(u,{title:{label:n.lang.title,value:e},target:{label:n.lang.target,value:o,options:h}})}n.openModalInsert(n.lang.createLink,u,(function(t){var e=n.prependUrlPrefix(t.url);if(!e.length)return!1;var o=i(['<a href="',e,'">',t.text||t.url,"</a>"].join(""));return t.title&&o.attr("title",t.title),(t.target||c)&&o.attr("target",t.target||c),n.range.deleteContents(),n.range.insertNode(o[0]),n.syncCode(),n.$c.trigger("tbwchange"),!0}))},prependUrlPrefix:function(t){if(!this.urlPrefix)return t;if(/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(t))return t;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?"mailto:"+t:this.urlPrefix+t},unlink:function(){var t=this,e=t.doc.getSelection(),o=e.focusNode;if(e.isCollapsed){for(;["A","DIV"].indexOf(o.nodeName)<0;)o=o.parentNode;if(o&&"A"===o.nodeName){var i=t.doc.createRange();i.selectNode(o),e.removeAllRanges(),e.addRange(i)}}t.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var t=this;t.saveRange();var e={url:{label:"URL",required:!0},alt:{label:t.lang.description,value:t.getRangeText()}};t.o.imageWidthModalEdit&&(e.width={}),t.openModalInsert(t.lang.insertImage,e,(function(e){t.execCmd("insertImage",e.url,!1,!0);var o=i('img[src="'+e.url+'"]:not([alt])',t.$box);return o.attr("alt",e.alt),t.o.imageWidthModalEdit&&o.attr({width:e.width}),t.syncCode(),t.$c.trigger("tbwchange"),!0}))},fullscreen:function(){var t,o=this,n=o.o.prefix,a=n+"fullscreen",s=a+"-placeholder",r=o.$box.outerHeight();o.$box.toggleClass(a),(t=o.$box.hasClass(a))?o.$box.before(i("<div/>",{class:s}).css({height:r})):i("."+s).remove(),i("body").toggleClass(n+"body-fullscreen",t),i(e).trigger("scroll"),o.$c.trigger("tbw"+(t?"open":"close")+"fullscreen")},execCmd:function(t,o,n,a){var s=this;a=!!a||"","dropdown"!==t&&s.$ed.focus(),"strikethrough"===t&&s.o.semantic&&s.semanticTag("strike",s.o.semanticKeepAttributes,!0);try{s.doc.execCommand("styleWithCSS",!1,n||!1)}catch(t){}try{s[t+a](o)}catch(n){try{t(o)}catch(n){"insertHorizontalRule"===t?o=void 0:"formatBlock"===t&&s.isIE&&(o="<"+o+">"),s.doc.execCommand(t,!1,o),s.syncCode(),s.semanticCode(!1,!0);try{var r=e.getSelection().focusNode;i(e.getSelection().focusNode.parentNode).hasClass("trumbowyg-editor")||(r=e.getSelection().focusNode.parentNode);var l=s.o.tagClasses[o];l&&i(r).addClass(l)}catch(t){}}"dropdown"!==t&&(s.updateButtonPaneStatus(),s.$c.trigger("tbwchange"))}},openModal:function(t,o,s){var r=this,l=r.o.prefix;if(s=!1!==s,i("."+l+"modal-box",r.$box).length>0)return!1;r.o.autogrowOnEnter&&(r.autogrowOnEnterDontClose=!0),r.saveRange(),r.showOverlay(),r.$btnPane.addClass(l+"disable");var c,d=i("<div/>",{class:l+"modal "+l+"fixed-top"}).css({top:r.$box.offset().top+r.$btnPane.height(),zIndex:99999}).appendTo(i(r.doc.body)),p=l+"dark";0!==r.$c.parents("."+p).length&&d.addClass(p),r.$overlay.one("click",(function(){return d.trigger(a),!1})),c=s?i("<form/>",{action:"",html:o}).on("submit",(function(){return d.trigger(n),!1})).on("reset",(function(){return d.trigger(a),!1})).on("submit reset",(function(){r.o.autogrowOnEnter&&(r.autogrowOnEnterDontClose=!1)})):o;var u=i("<div/>",{class:l+"modal-box",html:c}).css({top:"-"+r.$btnPane.outerHeight(),opacity:0,paddingBottom:s?null:"5%"}).appendTo(d).animate({top:0,opacity:1},100);return t&&i("<span/>",{text:t,class:l+"modal-title"}).prependTo(u),s&&(i(":input:first",u).focus(),r.buildModalBtn("submit",u),r.buildModalBtn("reset",u),d.height(u.outerHeight()+10)),i(e).trigger("scroll"),r.$c.trigger("tbwmodalopen"),d},buildModalBtn:function(t,e){var o=this.o.prefix;return i("<button/>",{class:o+"modal-button "+o+"modal-"+t,type:t,text:this.lang[t]||t}).appendTo(i("form",e))},closeModal:function(){var t=this,e=t.o.prefix;t.$btnPane.removeClass(e+"disable"),t.$overlay.off();var o=i("."+e+"modal-box",i(t.doc.body));o.animate({top:"-"+o.height()},100,(function(){o.parent().remove(),t.hideOverlay(),t.$c.trigger("tbwmodalclose")})),t.restoreRange()},openModalInsert:function(t,e,o){var s=this,r=s.o.prefix,l=s.lang,c="",d=r+"form-"+Date.now()+"-";return i.each(e,(function(t,e){var o=e.label||t,n=e.name||t,a=e.attributes||{},s=d+t,p=Object.keys(a).map((function(t){return t+'="'+a[t]+'"'})).join(" ");if("function"==typeof e.type)return e.name||(e.name=n),void(c+=e.type(e,s,r,l));c+='<div class="'+r+'input-row">',c+='<div class="'+r+'input-infos"><label for="'+s+'"><span>'+(l[o]?l[o]:o)+"</span></label></div>",c+='<div class="'+r+'input-html">',i.isPlainObject(e.options)?(c+='<select name="target">',c+=Object.keys(e.options).map((t=>'<option value="'+t+'" '+(t===e.value?"selected":"")+">"+e.options[t]+"</option>")).join(""),c+="</select>"):(c+='<input id="'+s+'" type="'+(e.type||"text")+'" name="'+n+'" '+p,c+=("checkbox"===e.type&&e.value?' checked="checked"':"")+' value="'+(e.value||"").replace(/"/g,"&quot;")+'">'),c+="</div></div>"})),s.openModal(t,c).on(n,(function(){var t=i("form",i(this)),a=!0,r={};i.each(e,(function(e,o){var n=o.name||e,l=i(':input[name="'+n+'"]',t);switch(l[0].type.toLowerCase()){case"checkbox":r[n]=l.is(":checked");break;case"radio":r[n]=l.filter(":checked").val();break;default:r[n]=i.trim(l.val())}o.required&&""===r[n]?(a=!1,s.addErrorOnModalField(l,s.lang.required)):o.pattern&&!o.pattern.test(r[n])&&(a=!1,s.addErrorOnModalField(l,o.patternError))})),a&&(s.restoreRange(),o(r,e)&&(s.syncCode(),s.$c.trigger("tbwchange"),s.closeModal(),i(this).off(n)))})).one(a,(function(){i(this).off(n),s.closeModal()}))},addErrorOnModalField:function(t,e){var o=this.o.prefix,n=o+"msg-error",a=t.closest("."+o+"input-row");t.on("change keyup",(function(){a.removeClass(o+"input-error"),setTimeout((function(){a.find("."+n).remove()}),150)})),a.addClass(o+"input-error").find("."+o+"input-infos label").append(i("<span/>",{class:n,text:e}))},getDefaultImgDblClickHandler:function(){var t=this;return function(){var e=i(this),o=e.attr("src"),n="(Base64)";0===o.indexOf("data:image")&&(o=n);var a={url:{label:"URL",value:o,required:!0},alt:{label:t.lang.description,value:e.attr("alt")}};return t.o.imageWidthModalEdit&&(a.width={value:e.attr("width")?e.attr("width"):""}),t.openModalInsert(t.lang.insertImage,a,(function(o){return o.url!==n&&e.attr({src:o.url}),e.attr({alt:o.alt}),t.o.imageWidthModalEdit&&(parseInt(o.width)>0?e.attr({width:o.width}):e.removeAttr("width")),!0})),!1}},saveRange:function(){var t=this,e=t.doc.getSelection();if(t.range=null,e&&e.rangeCount){var o,i=t.range=e.getRangeAt(0),n=t.doc.createRange();n.selectNodeContents(t.$ed[0]),n.setEnd(i.startContainer,i.startOffset),o=(n+"").length,t.metaRange={start:o,end:o+(i+"").length}}},restoreRange:function(){var t,e=this,o=e.metaRange,i=e.range,n=e.doc.getSelection();if(i){if(o&&o.start!==o.end){var a,s=0,r=[e.$ed[0]],l=!1,c=!1;for(t=e.doc.createRange();!c&&(a=r.pop());)if(3===a.nodeType){var d=s+a.length;!l&&o.start>=s&&o.start<=d&&(t.setStart(a,o.start-s),l=!0),l&&o.end>=s&&o.end<=d&&(t.setEnd(a,o.end-s),c=!0),s=d}else for(var p=a.childNodes,u=p.length;u>0;)u-=1,r.push(p[u])}try{n.removeAllRanges()}catch(t){}n.addRange(t||i)}},getRangeText:function(){return this.range+""},clearButtonPaneStatus:function(){var t=this,e=t.o.prefix,o=e+"active-button "+e+"active",n=e+"original-icon";i("."+e+"active-button",t.$btnPane).removeClass(o),i("."+n,t.$btnPane).each((function(){i(this).find("svg use").attr("xlink:href",i(this).data(n))}))},updateButtonPaneStatus:function(){var t=this,e=t.o.prefix,o=e+"active-button "+e+"active",n=e+"original-icon",a=t.getTagsRecursive(t.doc.getSelection().focusNode);t.clearButtonPaneStatus(),i.each(a,(function(a,s){var r=t.tagToButton[s.toLowerCase()],l=i("."+e+r+"-button",t.$btnPane);if(l.length>0)l.addClass(o);else try{var c=(l=i("."+e+"dropdown ."+e+r+"-dropdown-button",t.$box)).find("svg use"),d=l.parent().data(e+"dropdown"),p=i("."+e+d+"-button",t.$box),u=p.find("svg use");p.addClass(o),t.o.changeActiveDropdownIcon&&c.length>0&&(p.addClass(n).data(n,u.attr("xlink:href")),u.attr("xlink:href",c.attr("xlink:href")))}catch(t){}}))},getTagsRecursive:function(t,e){var o=this;if(e=e||(t&&t.tagName?[t.tagName]:[]),!t||!t.parentNode)return e;var n=(t=t.parentNode).tagName;return"DIV"===n?e:("P"===n&&""!==t.style.textAlign&&e.push(t.style.textAlign),i.each(o.tagHandlers,(function(i,n){e=e.concat(n(t,o))})),e.push(n),o.getTagsRecursive(t,e).filter((function(t){return null!=t})))},initPlugins:function(){var t=this;t.loadedPlugins=[],i.each(i.trumbowyg.plugins,(function(e,o){o.shouldInit&&!o.shouldInit(t)||(o.init(t),o.tagHandler&&t.tagHandlers.push(o.tagHandler),t.loadedPlugins.push(o))}))},destroyPlugins:function(){var t=this;i.each(this.loadedPlugins,(function(e,o){o.destroy&&o.destroy(t)}))}}}(navigator,window,document,jQuery)})),parcelRequire.register("4mhKw",(function(t,e){var o=parcelRequire("aykGt"),i=parcelRequire("4XDZb"),n=parcelRequire("5WMrM");L.Map.addInitHook((function(){this.setAspectRatio(),this.returnButton=L.Control.zoomHome({position:"bottomright",zoomHomeIcon:"home",zoomHomeTitle:"Return to map-extent"}),this.addControl(this.returnButton),this.basemapButton=L.easyButton({id:"changeBasemap",position:"bottomright",leafletClasses:!0,states:[{stateName:"main",onClick:function(t,e){$("#basemapModal").modal("show"),(0,o.init_img_basemaps)()},title:"Change basemap",icon:"fa-layer-group"}]}),this.addControl(this.basemapButton),this.basemapButton.disable(),this.textboxButton=L.easyButton({id:"addTextbox",position:"topleft",leafletClasses:!0,states:[{stateName:"main",onClick:function(t,e){_TEXTBOXES.add()},title:"Add book",icon:"fa-comment-alt"}]}),this.addControl(this.textboxButton),this.textboxButton.disable(),this.basemap=_BASEMAPS[10].tiles,this.addLayer(this.basemap),this.wms={},this.pm.addControls({position:"topright",drawCircleMarker:!1,drawText:!1,oneBlock:!0}),this.pm.setPathOptions({weight:3,color:"#563d7c",opacity:1,fillColor:"#563d7c",fillOpacity:.2}),this.pm.setGlobalOptions({markerStyle:{icon:L.icon({iconUrl:"assets/user-circle-solid.svg",iconSize:[30,30],popupAnchor:[0,-15],tooltipAnchor:[0,15]})}}),this.pm.setLang("customLang",{tooltips:{placeMarker:"Click to place avatar"},buttonTitles:{drawMarkerButton:"Draw avatar"}},"en"),this.disableDraw(),this.objects=[],this.fadeLayer=L.fadeLayer({pmIgnore:!0}),this.addLayer(this.fadeLayer),this.on("pm:create",(t=>{let e=t.layer;if("Marker"==t.shape){let t=this.getZoom(),o=this.project(e.getLatLng(),t),i=e.getIcon().options.iconUrl,n=e.getIcon().options.iconSize;this.removeLayer(e),e=L.imageOverlay(i,[this.unproject([o.x-n[0]/2,o.y-n[1]/2],t),this.unproject([o.x+n[0]/2,o.y+n[1]/2],t)],{interactive:!0,zIndex:200,ratio:.96875,rounded:!1,angle:0,borderColor:"#563d7c",borderThickness:0,overlayBlur:0,overlayGrayscale:0,overlayBrightness:0,overlayTransparency:0}),this.addLayer(e)}e.options.id=(0,o.uuid)(),e.options.sceneId=_SCENES.active,this.fire("_addedlayer",{layer:e}),this.objects.push(this.extractObject(e))})),this.on("_addedlayer",(async t=>{let e=t.layer,o=e.options.label;o&&(e.bindTooltip(o,{direction:"center",permanent:!0}),e instanceof L.ImageOverlay&&this.updateTooltip(e)),e.on("moveend",(t=>{this.updateTooltip(t.target)})),e.on("pm:edit",(t=>{let e=t.layer;this.updateObject(e),e.options.label&&(e.closeTooltip(),e.openTooltip())})),e.on("pm:remove",(t=>{let e=t.layer;this.deleteObject(e),e.closeTooltip(),e.unbindTooltip(),e.closePopup(),e.unbindPopup(),e.off("popupopen"),e.off("mouseover"),e.off("mouseout"),e.slideCancel()})),this.setPopup(e),e.on("pm:dragstart",(t=>{e.unbindPopup()})),e.on("pm:dragend",(t=>{this.setPopup(t.layer)})),e.on("popupopen",(t=>{(0,n.bind_setup)(e)})),e.on("mouseover",(t=>{this.highlightObject(e.options.id)})),e.on("mouseout",(t=>{this.unhighlightObject(e.options.id)}));let i=[{text:"Move to front",callback:t=>{e.bringToFront()},index:0},{text:"Move to back",callback:t=>{e.bringToBack()},index:1}];e instanceof L.ImageOverlay&&(i.push({text:"Clone avatar",callback:t=>{this.cloneAvatar(e.options.id,e.options.sceneId)},index:2}),this.setIcon(e)),e.bindContextMenu({contextmenu:!0,contextmenuItems:i})})),this.on("layeradd",(t=>{t.layer})),this.on("zoomend",(t=>{for(let t of this.getLayers())this.updateTooltip(t)})),this.on("zoom",(t=>{this._renderer&&this._renderer._reset()})),this.on("movestart",(t=>{})),this.on("moveend",(t=>{}))})),L.Map.include({setup:function(){this.setAspectRatio(),this.enableDraw(),this.basemapButton.enable(),this.textboxButton.enable(),$(".leaflet-control-attribution>span").before('<span aria-hidden="true">|</span> <a href="https://geotales.io">GeoTales</a> '),$(".leaflet-control-attribution a").prop("target","_blank")},reset:function(){this.clearLayers(),this.fadeLayer.clearLayers(),this.disableDraw(),this.basemapButton.disable(),this.textboxButton.disable()},enableDraw:function(){this.pm.Toolbar.setButtonDisabled("Marker",!1),this.pm.Toolbar.setButtonDisabled("Line",!1),this.pm.Toolbar.setButtonDisabled("Polygon",!1),this.pm.Toolbar.setButtonDisabled("Rectangle",!1),this.pm.Toolbar.setButtonDisabled("Circle",!1),this.pm.Toolbar.setButtonDisabled("Edit",!1),this.pm.Toolbar.setButtonDisabled("Drag",!1),this.pm.Toolbar.setButtonDisabled("Cut",!1),this.pm.Toolbar.setButtonDisabled("Removal",!1),this.pm.Toolbar.setButtonDisabled("Rotate",!1)},disableDraw:function(){this.pm.Toolbar.setButtonDisabled("Marker",!0),this.pm.Toolbar.setButtonDisabled("Line",!0),this.pm.Toolbar.setButtonDisabled("Polygon",!0),this.pm.Toolbar.setButtonDisabled("Rectangle",!0),this.pm.Toolbar.setButtonDisabled("Circle",!0),this.pm.Toolbar.setButtonDisabled("Edit",!0),this.pm.Toolbar.setButtonDisabled("Drag",!0),this.pm.Toolbar.setButtonDisabled("Cut",!0),this.pm.Toolbar.setButtonDisabled("Removal",!0),this.pm.Toolbar.setButtonDisabled("Rotate",!0)},setOrientation:function(t){switch(t){case"left":this.returnButton.setPosition("bottomleft"),this.basemapButton.setPosition("bottomleft"),this.pm.Toolbar.setBlockPosition("draw","topleft"),this.pm.Toolbar.setBlockPosition("edit","topleft"),this.textboxButton.setPosition("topright");break;case"right":this.returnButton.setPosition("bottomright"),this.basemapButton.setPosition("bottomright"),this.pm.Toolbar.setBlockPosition("draw","topright"),this.pm.Toolbar.setBlockPosition("edit","topright"),this.textboxButton.setPosition("topleft")}},setHomeBounds:function(t){this.returnButton&&this.returnButton.setHomeBounds(t,{maxZoom:this.getMaxZoom()})},setAspectRatio:function(t){t&&(_OPTIONS.aspectratio=t);let e=$("#mapRow").outerWidth(),i=$("#mapRow").outerHeight(),n=_OPTIONS.aspectratio,a=(0,o.get_aspect_ratio_dimentions)(e,i,n);$("#map").css({width:a[0]/e*100+"%",height:`calc(${a[1]/i*100}% - 39px - 49px)`,left:(e-a[0])/2/e*100+"%",top:`calc(${(i-a[1])/2/i*100}% + 39px + 49px)`}),this.invalidateSize(),_SCENES.active&&this.setFlyTo(_SCENES.get(_SCENES.active).bounds)},setFlyTo:function(t){this.flyToBounds(t,{maxZoom:this.getMaxZoom(),noMoveStart:!0,duration:_OPTIONS.panningspeed||null}),this.setHomeBounds(t)},clearLayers:function(){for(let t of this.getLayers())this.removeLayer(t)},getLayers:function(){return this.pm.getGeomanLayers()},addScene:function(t){let e=_SCENES.getPrevScene(t);if(!e||!_OPTIONS.objectOptIn)return;let o=e.id;for(let e of this.objects)if(e.sceneId==o){let o=Object.assign({},e);o.sceneId=t,this.objects.push(o)}_SCENES.store[_SCENES.get(t).index].setWMS()},deleteScene:function(t){this.objects=this.objects.filter((e=>e.sceneId!=t))},highlightObject:function(t){let e=this.fadeLayer.getObject(t);e&&(e instanceof L.ImageOverlay?e.setOpacity(.8):e.setStyle({opacity:.8}))},unhighlightObject:function(t){let e=this.fadeLayer.getObject(t);e&&(e instanceof L.ImageOverlay?e.setOpacity(.3):e.setStyle({opacity:.3}))},setObjects:function(t){let e=_SCENES.getPrevScene(t),o=e?e.id:null;if(this.fadeLayer.clearLayers(),o)for(let t of this.objects)t.sceneId==o&&this.fadeLayer.addLayer(this.createObject(t),t.id);let i=this.getLayers().map((t=>{let e=this.extractObject(t);return{id:e.id,pos:e.pos,radius:e.radius,animationspeed:e.animationspeed}}));this.clearLayers();for(let e=0;e<this.objects.length;e++){let o=Object.assign({},this.objects[e]);if(o.sceneId==t){let t=o.pos,e=o.radius;for(let t of i)if(o.id==t.id){o.pos=t.pos,"circle"==o.type&&(o.radius=t.radius);break}let n=this.createObject(o);this.addLayer(n),this.fire("_addedlayer",{layer:n});for(let a of i)if(o.id==a.id){n.slideTo(t,{radius:e,duration:a.animationspeed||_OPTIONS.animationspeed});break}}}},set:function(t){let e=_SCENES.get(t);this.setBasemap(e.basemap),this.setWMS(e.wms),this.setObjects(t),this.setFlyTo(e.bounds)},insertObject:function(t){for(let e of this.getLayers())if(e.options.id==t.options.id)return;let e;for(let o of this.objects)if(o.id==t.options.id&&o.sceneId==t.options.sceneId){e=Object.assign({},o);break}e.sceneId=_SCENES.active;let o=this.createObject(e);this.addLayer(o),this.fire("_addedlayer",{layer:o}),this.objects.push(e)},cloneAvatar:function(t,e){let i;for(let o of this.objects)if(o.id==t&&o.sceneId==e){i=Object.assign({},o);break}i.id=(0,o.uuid)();let n=this.getZoom(),a=this.project(i.pos[0],n),s=this.project(i.pos[1],n);a.x+=50,a.y+=50,s.x+=50,s.y+=50,a=this.unproject(a,n),s=this.unproject(s,n),i.pos=[[a.lat,a.lng],[s.lat,s.lng]];let r=this.createObject(i);this.addLayer(r),this.fire("_addedlayer",{layer:r}),this.objects.push(i)},updateObject:function(t){for(let e=0;e<this.objects.length;e++){let o=this.objects[e];if(o.id==t.options.id&&o.sceneId==t.options.sceneId){this.objects[e]=this.extractObject(t);break}}},deleteObject:function(t){for(let e=0;e<this.objects.length;e++){let o=this.objects[e];if(o.id==t.options.id&&o.sceneId==t.options.sceneId){this.objects.splice(e,1);break}}},globalObjectOptions:function(t){let e=this.extractObject(t);delete e.id,delete e.sceneId,delete e.type,delete e.pos,t instanceof L.Circle&&delete e.radius;for(let o=0;o<this.objects.length;o++){let i=this.objects[o];i.id==t.options.id&&i.sceneId!=t.options.sceneId&&(this.objects[o]=Object.assign({},i,e))}if(t=this.fadeLayer.getObject(t.options.id)){this.fadeLayer.removeLayer(t);let o=Object.assign({},this.extractObject(t),e);this.fadeLayer.addLayer(this.createObject(o),o.id)}},setIcon:function(t,e,o){if(t instanceof L.ImageOverlay){if(e){let o=this.getZoom(),i=this.project(t.getBounds().getCenter(),o);t.setBounds([this.unproject([i.x-e[0]/2,i.y-e[1]/2],o),this.unproject([i.x+e[0]/2,i.y+e[1]/2],o)])}o&&t.setUrl(o),$(t._image).css("border-radius",t.options.rounded?"50%":"0"),$(t._image).css("border",`${t.options.borderThickness}px solid ${t.options.borderColor}`),$(t._image).css("filter",`\n\t\t\tblur(${t.options.overlayBlur}px)\n\t\t\tgrayscale(${100*t.options.overlayGrayscale}%)\n\t\t\tdrop-shadow(0 0 ${t.options.overlayBrightness}px yellow)\n\t\t\topacity(${100*(1-t.options.overlayTransparency)}%)\n\t\t`),t.options.label&&this.updateTooltip(t)}},setPopup:function(t){t.unbindPopup();let e=t instanceof L.ImageOverlay?(0,i.avatar_popup)():t instanceof L.Rectangle||t instanceof L.Polygon||t instanceof L.Circle?(0,i.polygon_popup)():t instanceof L.Polyline?(0,i.polyline_popup)():"";e&&t.bindPopup(e,{keepInView:!0,closeOnEscapeKey:!1,maxWidth:350,maxHeight:450})},updateTooltip:function(t){if(t.getTooltip()){if(t.closeTooltip(),t instanceof L.ImageOverlay){let e=this.latLngToContainerPoint(t.getBounds().getNorthWest()).distanceTo(this.latLngToContainerPoint(t.getBounds().getSouthWest()));t.getTooltip().options.offset=[0,e/2-10]}t.openTooltip()}},getWMS:function(){return this.wms?{type:"wms",url:this.wms._url,layers:this.wms.options.layers,format:this.wms.options.format,version:this.wms.options.version,transparent:this.wms.options.transparent}:null},setWMS:function(t){if(!t)return void(this.wms=this.wms?this.removeLayer(this.wms):null);if(this.wms&&(t.url||t._url)==this.wms._url&&(t.layers||t.options.layers)==this.wms.options.layers&&(t.format||t.options.format)==this.wms.options.format&&(t.version||t.options.version)==this.wms.options.version)return;let e;if(t instanceof L.TileLayer.WMS)e=t;else{if("wms"!=t.type)return;e=L.tileLayer.wms(t.url,{layers:t.layers,format:t.format,transparent:t.transparent,version:t.version,minZoom:t.minZoom||0,maxZoom:t.maxZoom||22,attribution:t.attribution||""})}this.wms&&this.removeLayer(this.wms),this.wms=e,this.addLayer(this.wms),this.wms.bringToFront()},getCenterBasemapTile:function(){if(this.basemap instanceof L.ImageOverlay)return this.basemap._url;let t=this.basemap.getTileSize(),e=this.project(this.getCenter(),this.getZoom()),o="";try{o=this.basemap.getTileUrl({x:Math.floor(e.x/t.x),y:Math.floor(e.y/t.y)})}catch(t){console.error(t)}return o},getBasemap:function(){return this.basemap instanceof L.TileLayer?{type:"tiles",url:this.basemap._url,minZoom:this.basemap.options.minZoom,maxZoom:this.basemap.options.maxZoom,attribution:this.basemap.options.attribution}:this.basemap instanceof L.ImageOverlay?{type:"image",img:this.basemap._url}:null},setBasemap:async function(t){let e;if(t instanceof L.TileLayer){if(this.basemap instanceof L.TileLayer&&t._url==this.basemap._url)return;e=t}else if("tiles"==t.type){if(this.basemap instanceof L.TileLayer&&t.url==this.basemap._url)return;e=L.tileLayer(t.url,{minZoom:t.minZoom||0,maxZoom:t.maxZoom||22,attribution:t.attribution||"&copy;"})}else{if("image"!=t.type)return;{if(this.basemap instanceof L.ImageOverlay&&t.img==this.basemap._url)return;let o=new Image;o.src=t.img,await o.decode();let i=o.width/o.height,n=_SCENES.get(_SCENES.active).bounds,a=[n[0],[]],s=this.latLngToContainerPoint(n[0]),r=this.latLngToContainerPoint(n[1]),l=r.y-s.y,c=r.x-s.x;if(i>=1){let t=this.containerPointToLatLng([r.x,s.y+c/i]);a[1][0]=t.lat,a[1][1]=t.lng}else{let t=this.containerPointToLatLng([s.x+i*l,r.y]);a[1][0]=t.lat,a[1][1]=t.lng}e=L.imageOverlay(t.img,a,{pmIgnore:!0,zIndex:0,minZoom:0,maxZoom:1e3,attribution:"&copy;"})}}this.removeLayer(this.basemap),this.basemap=e,this.presetZoom(this.basemap.options.minZoom,this.basemap.options.maxZoom),this.addLayer(this.basemap),this.basemap.bringToBack(),$("div.leaflet-control-attribution a").prop("target","_blank"),(0,o.save_data)()},resetBasemap:function(){this.setBasemap(_BASEMAPS[10].tiles)},presetZoom:function(t,e){let o=this.getZoom();(o<t||o>e)&&(o<t&&this.setZoom(t),o>e&&this.setZoom(e)),this.setMinZoom(t),this.setMaxZoom(e)},createObject:function(t){let e=null;switch(t.type){case"avatar":e=L.imageOverlay(t.icon,t.pos,{interactive:!0,zIndex:200,label:t.label,ratio:t.ratio,rounded:t.rounded,angle:t.angle,borderColor:t.borderColor,borderThickness:t.borderThickness,overlayBlur:t.blur,overlayBrightness:t.brightness,overlayGrayscale:t.grayscale,overlayTransparency:t.transparency,animationspeed:t.animationspeed});break;case"polyline":e=L.polyline(t.pos,{label:t.label,dashArray:t.dashed?"5, 10":"",color:t.color,weight:t.thickness,opacity:1-t.transparency,animationspeed:t.animationspeed});break;case"polygon":e=L.polygon(t.pos,{label:t.label,dashArray:t.dashed?"5, 10":"",color:t.lineColor,weight:t.lineThickness,opacity:1-t.lineTransparency,fillColor:t.fillColor,fillOpacity:1-t.fillTransparency,animationspeed:t.animationspeed});break;case"rectangle":e=L.rectangle(t.pos,{label:t.label,dashArray:t.dashed?"5, 10":"",color:t.lineColor,weight:t.lineThickness,opacity:1-t.lineTransparency,fillColor:t.fillColor,fillOpacity:1-t.fillTransparency,animationspeed:t.animationspeed});break;case"circle":e=L.circle(t.pos,{radius:t.radius,label:t.label,dashArray:t.dashed?"5, 10":"",color:t.lineColor,weight:t.lineThickness,opacity:1-t.lineTransparency,fillColor:t.fillColor,fillOpacity:1-t.fillTransparency,animationspeed:t.animationspeed});break;default:console.error("object type invalid")}return e.options.id=t.id,e.options.sceneId=t.sceneId,e},extractObject:function(t){let e=null;if(t instanceof L.ImageOverlay){let o=t.getBounds().getNorthWest(),i=t.getBounds().getSouthEast();e={id:t.options.id,sceneId:t.options.sceneId,type:"avatar",pos:[[o.lat,o.lng],[i.lat,i.lng]],label:t.options.label,icon:t._url,ratio:t.options.ratio,rounded:t.options.rounded,angle:0,borderColor:t.options.borderColor,borderThickness:t.options.borderThickness,blur:t.options.overlayBlur,grayscale:t.options.overlayGrayscale,brightness:t.options.overlayBrightness,transparency:t.options.overlayTransparency,animationspeed:t.options.animationspeed}}else if(t instanceof L.Polygon)e={id:t.options.id,sceneId:t.options.sceneId,type:t instanceof L.Rectangle?"rectangle":"polygon",pos:t.getLatLngs(),label:t.options.label,dashed:!!t.options.dashArray,lineColor:t.options.color,lineThickness:t.options.weight,lineTransparency:1-t.options.opacity,fillColor:t.options.fillColor,fillTransparency:1-t.options.fillOpacity,animationspeed:t.options.animationspeed};else if(t instanceof L.Polyline)e={id:t.options.id,sceneId:t.options.sceneId,type:"polyline",pos:t.getLatLngs(),label:t.options.label,dashed:!!t.options.dashArray,color:t.options.color,thickness:t.options.weight,transparency:1-t.options.opacity,animationspeed:t.options.animationspeed};else if(t instanceof L.Circle){let o=t.getLatLng();e={id:t.options.id,sceneId:t.options.sceneId,type:"circle",pos:[o.lat,o.lng],radius:t.getRadius(),label:t.options.label,dashed:!!t.options.dashArray,lineColor:t.options.color,lineThickness:t.options.weight,lineTransparency:1-t.options.opacity,fillColor:t.options.fillColor,fillTransparency:1-t.options.fillOpacity,animationspeed:t.options.animationspeed}}else console.error("object type invalid");return e},importData:function(t){for(let e=0;e<t.length;e++)this.objects.push(t[e])},exportData:function(){return this.objects}})})),parcelRequire.register("5WMrM",(function(t,e){function o(t){if($(".objectPopup input#label").change((function(e){let o=$(this).val();o?(t.getTooltip()||(t.bindTooltip(L.tooltip({direction:"center",permanent:!0},t)),t instanceof L.ImageOverlay&&_MAP.updateTooltip(t)),t.setTooltipContent(o)):t.unbindTooltip(),t.options.label=o,_MAP.updateObject(t)})),$(".objectPopup input#label").val(t.options.label||""),t instanceof L.ImageOverlay){$("#avatarPopup #iconChoose #iconCol").remove();for(let t of _ICONS.slice().reverse())$("#avatarPopup #iconChoose").prepend(`\n\t\t\t\t<div class="col" id="iconCol">\n\t\t\t\t\t<img class="img-fluid rounded" id="icons" src="${t}" alt="&nbsp;" />\n\t\t\t\t</div>\n\t\t\t`);$("input#_img_icon").off("change"),$("input#_img_icon").change((function(e){let o=$(this)[0].files[0];if(!o)return;$("#loadingModal").modal("show");let i=new FileReader;i.onload=async function(){let e=new Image;e.src=i.result,await e.decode(),$("#avatarPopup input#rounded").prop("checked",!1),t.options.ratio=e.width/e.height||1,t.options.rounded=!1,t.options.angle=0;let n=new FormData;n.append("type","icon"),n.append("image",o),$.ajax({type:"POST",url:"api/upload_create.php",data:n,contentType:!1,processData:!1,success:function(e,o,i){_ICONS.unshift(e),_MAP.setIcon(t,[35,35/t.options.ratio],e),_MAP.updateObject(t),setTimeout((function(){$("#loadingModal").modal("hide")}),750)},error:function(t,e,o){console.error(t.status,o),setTimeout((function(){$("#loadingModal").modal("hide"),$("#errorModal").modal("show")}),750)}})},i.readAsDataURL(o)})),$("#avatarPopup #iconChoose #iconAdd").click((t=>{$("input#_img_icon").click()})),$("#avatarPopup #iconChoose #icons").click((async function(e){let o=$(this).prop("src"),i=new Image;i.src=o,await i.decode(),t.options.ratio=i.width/i.height||1,_MAP.setIcon(t,[35,35/t.options.ratio],o),_MAP.updateObject(t)})),$("#avatarPopup input#size").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));_MAP.setIcon(t,[o,o/t.options.ratio]),_MAP.updateObject(t)})),$("#avatarPopup input#rounded").change((function(e){t.options.rounded=this.checked,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#rounded").prop("checked",t.options.rounded),$("#avatarPopup input#color").change((function(e){let o=$(this).val();t.options.borderColor=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#color").val(t.options.borderColor||"#563d7c"),$("#avatarPopup input#thickness").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.borderThickness=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#blur").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayBlur=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#grayscale").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayGrayscale=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#brightness").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayBrightness=o,_MAP.updateObject(t),_MAP.setIcon(t)})),$("#avatarPopup input#transparency").change((function(e){let o=Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"));t.options.overlayTransparency=o,_MAP.updateObject(t),_MAP.setIcon(t)}))}else t instanceof L.Path?($("#shapePopup input#dashed").change((function(e){t.setStyle({dashArray:this.checked?"5, 10":""}),_MAP.updateObject(t)})),$("#shapePopup input#dashed").prop("checked",!!t.options.dashArray),$("#shapePopup input#lineColor").change((function(e){t.setStyle({color:$(this).val()}),_MAP.updateObject(t)})),$("#shapePopup input#lineColor").val(t.options.color||"#563d7c"),$("#shapePopup input#lineThickness").change((function(e){t.setStyle({weight:Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"))}),_MAP.updateObject(t)})),$("#shapePopup input#lineTransparency").change((function(e){t.setStyle({opacity:1-Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"))}),_MAP.updateObject(t)})),(t instanceof L.Rectangle||t instanceof L.Polygon||t instanceof L.Circle)&&($("#shapePopup input#fillColor").change((function(e){t.setStyle({fillColor:$(this).val()}),_MAP.updateObject(t)})),$("#shapePopup input#fillColor").val(t.options.fillColor||"#563d7c"),$("#shapePopup input#fillTransparency").change((function(e){t.setStyle({fillOpacity:1-Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max"))}),_MAP.updateObject(t)})))):console.error("object type invalid");$(".objectPopup input#animationSpeed").change((function(e){t.options.animationspeed=1e3*Math.min(Math.max($(this).prop("min"),$(this).val()),$(this).prop("max")),_MAP.updateObject(t)})),$(".objectPopup #makeGlobal").click((function(e){_MAP.globalObjectOptions(t)}))}$parcel$export(t.exports,"bind_setup",(function(){return o})),L.FadeLayer=L.FeatureGroup.extend({addLayer:function(t,e){L.FeatureGroup.prototype.addLayer.call(this,t),e&&!t.options.id&&(t.options.id=e),t.options.pmIgnore=!0,t instanceof L.ImageOverlay?(t.setOpacity(.3),$(t._image).css("border-radius",t.options.rounded?"50%":"0"),$(t._image).css("border",`${t.options.borderThickness}px solid ${t.options.borderColor}`),$(t._image).css("filter",`\n\t\t\t\tblur(${t.options.overlayBlur}px)\n\t\t\t\tgrayscale(${100*t.options.overlayGrayscale}%)\n\t\t\t`)):(t.setStyle({opacity:.3}),t.setStyle({fillOpacity:.2})),t.on("click",(e=>{_MAP.insertObject(t)}))},getObject:function(t){for(let e of this.getLayers())if(e.options.id==t)return e;return null},removeLayer:function(t,e){(t=t||(e?this.getObject(e):null))&&(t.off("click"),L.FeatureGroup.prototype.removeLayer.call(this,t))},initialize:function(t){L.FeatureGroup.prototype.initialize.call(this),this.options.id="0",this.options=Object.assign({},this.options,t)}}),L.fadeLayer=function(t){return new L.FadeLayer(t)},L.ImageOverlay.include({__toGeoJSON:function(){if(!this._map)return;let t=this.getBounds().getNorthWest(),e=this.getBounds().getSouthEast();return{type:"Feature",properties:{type:"avatar",label:this.options.label,icon:this._url,ratio:this.options.ratio,rounded:this.options.rounded,angle:0,borderColor:this.options.borderColor,borderThickness:this.options.borderThickness,blur:this.options.overlayBlur,grayscale:this.options.overlayGrayscale,brightness:this.options.overlayBrightness,transparency:this.options.overlayTransparency},geometry:{type:"Polygon",coordinates:[[t.lat,t.lng],[e.lat,e.lng]]}}}}),L.Polyline.include({__toGeoJSON:function(){if(!this._map)return;let t=L.Polyline.prototype.toGeoJSON.call(this);return t.properties={type:"polyline",label:this.options.label,dashed:!!this.options.dashArray,color:this.options.color,thickness:this.options.weight,transparency:1-this.options.opacity},t}}),L.Polygon.include({__toGeoJSON:function(){if(!this._map)return;let t=L.Polygon.prototype.toGeoJSON.call(this);return t.properties={type:this instanceof L.Rectangle?"rectangle":"polygon",label:this.options.label,dashed:!!this.options.dashArray,lineColor:this.options.color,lineThickness:this.options.weight,lineTransparency:1-this.options.opacity,fillColor:this.options.fillColor,fillTransparency:1-this.options.fillOpacity},t}}),L.Circle.include({__toGeoJSON:function(){if(!this._map)return;let t=L.Circle.prototype.toGeoJSON.call(this);return t.properties={type:"circle",radius:this.getRadius(),label:this.options.label,dashed:!!this.options.dashArray,lineColor:this.options.color,lineThickness:this.options.weight,lineTransparency:1-this.options.opacity,fillColor:this.options.fillColor,fillTransparency:1-this.options.fillOpacity},t}})})),parcelRequire("Wc23C")})();
//# sourceMappingURL=main.js.map
