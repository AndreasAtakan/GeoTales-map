{"mappings":"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","sources":["edit/js/main.js","edit/js/helpers.js","edit/js/generate.js","edit/js/scenes.js","edit/js/textboxes.js","node_modules/trumbowyg/dist/trumbowyg.js","edit/js/map/map.js","edit/js/map/layers.js"],"sourcesContent":["/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport {\n\timport_data,\n\texport_data,\n\tsave_data,\n\tunsaved_changes,\n\tinit_basemaps\n} from \"./helpers.js\";\n\nimport { Scenes } from \"./scenes.js\";\nimport { Textboxes } from \"./textboxes.js\";\n\nimport \"./map/map.js\";\n\n\nwindow.onload = function(ev) {\n\n\t// Disable mobile pinch-zoom\n\tdocument.addEventListener(\"touchmove\", function(ev) {\n\t\tif(ev.scale !== 1) { ev.preventDefault(); }\n\t}, false);\n\n\t// Set up window resize start/end events\n\tlet resizeTimer = false;\n\t$(window).on(\"resize\", function(ev) {\n\t\tif( !resizeTimer ) { $(window).trigger(\"resizestart\"); }\n\t\tclearTimeout(resizeTimer);\n\t\tresizeTimer = setTimeout(function() {\n\t\t\tresizeTimer = false;\n\t\t\t$(window).trigger(\"resizeend\");\n\t\t}, 250);\n\t}).on(\"resizeend\", function() { _MAP.setAspectRatio(); });\n\n\n\n\t_SCENES = new Scenes();\n\n\t$(\"#sceneRow\").keydown(ev => { if([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(ev.code) > -1) { ev.preventDefault(); } });\n\t$(\"#sceneRow\").keyup(ev => {\n\t\tlet keycode = ev.code;\n\t\tif(keycode == \"ArrowLeft\") { ev.preventDefault(); _SCENES.prev(); }\n\t\tif(keycode == \"ArrowRight\") { ev.preventDefault(); _SCENES.next(); }\n\t\tif([\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Space\"].indexOf(keycode) > -1) { ev.preventDefault(); }\n\t});\n\n\t$(\"#sceneRow button#add\").click(ev => { _SCENES.add(); });\n\t$(\"#sceneRow button#recapture\").click(ev => { _SCENES.capture(); });\n\t$(\"#sceneWarningModal button#delete\").click(ev => { _SCENES.delete(); $(\"#sceneWarningModal\").modal(\"hide\"); });\n\n\n\t_TEXTBOXES = new Textboxes();\n\n\n\t_MAP = L.map(\"map\", {\n\t\tcenter: [ 49, 14 ],\n\t\tzoom: window.innerWidth < 575.98 ? 3 : 5,\n\t\tzoomControl: false,\n\t\tmaxZoom: 18,\n\t\tdoubleClickZoom: false,\n\t\tzoomAnimationThreshold: 100,\n\t\twheelPxPerZoomLevel: 1500,\n\t\tkeyboard: false,\n\t\ttap: false,\n\t\tboxZoom: false,\n\t\t//touchZoom: false,\n\t\t//worldCopyJump: true\n\n\t\tcontextmenu: true,\n\t\tcontextmenuItems: [\n\t\t\t{ text: \"Copy coordinates\", callback: ev => { navigator.clipboard.writeText( `${ev.latlng.lat}, ${ev.latlng.lng}` ); } },\n\t\t\t{ text: \"Center map here\", callback: ev => { _MAP.panTo(ev.latlng); } },\n\t\t\t\"-\",\n\t\t\t{ text: \"Zoom in\", icon: \"assets/zoom-in.png\", callback: ev => { _MAP.zoomIn(); } },\n\t\t\t{ text: \"Zoom out\", icon: \"assets/zoom-out.png\", callback: ev => { _MAP.zoomOut(); } }\n\t\t]\n\t});\n\n\tdocument.addEventListener(\"_setup\", ev => {\n\t\t_MAP.setup(); _TEXTBOXES.setup(); _SCENES.setup();\n\t});\n\tdocument.addEventListener(\"_reset\", ev => {\n\t\t_SCENES.reset(); _TEXTBOXES.reset(); _MAP.reset();\n\t});\n\n\n\n\t$(\"#optionsModal input#animationSpeed\").change(function(ev) { _OPTIONS.animationspeed = $(this).val() * 1000; });\n\t$(\"#optionsModal input#panningSpeed\").change(function(ev) { _OPTIONS.panningspeed = $(this).val() || null; });\n\t$(\"#optionsModal select#aspectRatio\").change(function(ev) { _MAP.setAspectRatio( eval( this.value ) ); });\n\t$(\"#optionsModal input#objectsOptIn\").change(function(ev) { _OPTIONS.objectOptIn = this.checked; });\n\n\n\n\tinit_basemaps();\n\n\t$(\"#basemapModal input#basemapFile\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\tlet data = new FormData();\n\t\tdata.append(\"type\", \"basemap\");\n\t\tdata.append(\"image\", file);\n\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api/upload_create.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: async function(result, status, xhr) {\n\t\t\t\tawait _MAP.setBasemap({ type: \"image\", img: result });\n\t\t\t\t_SCENES.setBasemap();\n\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\tname: \"\",\n\t\t\t\t\ttiles: { type: \"image\", img: result },\n\t\t\t\t\tpreview: result\n\t\t\t\t});\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#basemapModal button#basemapFetch\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#basemapLink\").val();\n\t\tif(!url) { return; }\n\n\t\tlet protocol = url.split(/\\:/ig)[0];\n\t\tif(protocol == \"mapbox\") {\n\t\t\tlet username = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[0], styleID = url.split(/mapbox\\:\\/\\/styles\\//ig)[1].split(/\\//ig)[1],\n\t\t\t\tkey = $(\"#basemapModal input#basemapKey\").val();\n\t\t\tif(!key) { return; }\n\n\t\t\turl = `https://api.mapbox.com/styles/v1/${username}/${styleID}/tiles/256/{z}/{x}/{y}?access_token=${key}`;\n\t\t}\n\n\t\t_MAP.setBasemap({ type: \"tiles\", url: url });\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#wmsAdd\").click(ev => {\n\t\tlet url = $(\"#basemapModal input#wmsLink\").val(),\n\t\t\tlayers = $(\"#basemapModal input#wmsLayer\").val(),\n\t\t\tformat = $(\"#basemapModal select#wmsFormat\").val(),\n\t\t\tversion = $(\"#basemapModal select#wmsVersion\").val();\n\t\tif(!url || !layers) { return; }\n\n\t\t_MAP.setWMS({\n\t\t\ttype: \"wms\",\n\t\t\turl: url,\n\t\t\tlayers: layers,\n\t\t\tformat: format,\n\t\t\tversion: version,\n\t\t\ttransparent: format == \"image/png\"\n\t\t});\n\t\t_SCENES.setWMS();\n\t});\n\t$(\"#basemapModal button#wmsRemove\").click(ev => {\n\t\t_MAP.setWMS(null);\n\t\t_SCENES.setWMS();\n\t});\n\n\n\n\t$(\"#projectFileInput\").change(ev => {\n\t\tlet file = $(ev.target)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"project\", JSON.parse( fr.result ) ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#geojsonImportModal button#import\").click(ev => {\n\t\t$(\"#geojsonImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#geojsonImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {\n\t\t\tlineColor: $(\"#geojsonImportModal #lineColor\").val(),\n\t\t\tlineThickness: $(\"#geojsonImportModal #lineThickness\").val() || 3,\n\t\t\tlineTransparency: $(\"#geojsonImportModal #lineTransparency\").val(),\n\t\t\tfillColor: $(\"#geojsonImportModal #fillColor\").val(),\n\t\t\tfillTransparency: $(\"#geojsonImportModal #fillTransparency\").val() || 0.8\n\t\t};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"geojson\", JSON.parse( fr.result ), options ); };\n\t\tfr.readAsText(file);\n\t});\n\t$(\"#gedcomImportModal button#import\").click(ev => {\n\t\t$(\"#gedcomImportModal\").modal(\"hide\");\n\n\t\tlet file = $(\"#gedcomImportModal input#fileInput\")[0].files[0];\n\t\tif(!file) { return; }\n\n\t\tlet options = {};\n\n\t\tlet fr = new FileReader();\n\t\tfr.onload = function() { import_data( \"gedcom\", fr.result, options ); };\n\t\tfr.readAsText(file);\n\t});\n\n\n\t$(\"button#export\").click(ev => {\n\t\texport_data( $(ev.target).data(\"type\") || null );\n\t});\n\n\t$(\"a#save\").click(ev => {\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tsave_data(function() { $(\"#loadingModal\").modal(\"hide\"); });\n\t});\n\tsetInterval(save_data, 5 * 60 * 1000);\n\n\n\t$(\"#loadingModal\").modal(\"show\");\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api/map_read.php\",\n\t\tdata: { \"id\": _ID, \"password\": \"\" },\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tif(result.data) { import_data( \"project\", JSON.parse(result.data) ); }\n\t\t\t$(`div#sceneRow,\n\t\t\t   div#mapRow,\n\t\t\t   .navbar .navbarContent li`).click(ev => { unsaved_changes(); });\n\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n\n\t$.ajax({\n\t\ttype: \"GET\",\n\t\turl: \"api/upload_get.php\",\n\t\t//data: {},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tfor(let r of result) {\n\t\t\t\tif(r.type == \"icon\") { _ICONS.unshift(r.ref); }\n\t\t\t\telse\n\t\t\t\tif(r.type == \"basemap\") {\n\t\t\t\t\t_BASEMAPS.push({\n\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\ttiles: { type: \"image\", img: r.ref },\n\t\t\t\t\t\tpreview: r.ref\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t}\n\t});\n\n};\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { generate_basemaps } from \"./generate.js\";\n\n\nexport function uuid(a) {\n\treturn a ? (a^Math.random()*16>>a/4).toString(16) : ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, uuid);\n}\n\n\n\nexport function sanitize(str) {\n\tlet map = {\n\t\t\"\\&\": \"&amp;\",\n\t\t\"\\<\": \"&lt;\",\n\t\t\"\\>\": \"&gt;\",\n\t\t\"\\\"\": \"&quot;\",\n\t\t\"\\'\": \"&#x27;\",\n\t\t\"\\/\": \"&#x2F;\"\n\t};\n\tlet reg = /[&<>\"'/]/ig;\n\treturn str.replace(reg, match => (map[match]));\n}\n\n\n\nfunction import_project(data) {\n\t_OPTIONS = data.options;\n\t$(\"#optionsModal input#animationSpeed\").val(_OPTIONS.animationspeed / 1000);\n\t$(\"#optionsModal input#panningSpeed\").val(_OPTIONS.panningspeed || null);\n\t$(\"#optionsModal input#objectsOptIn\").prop(\"checked\", _OPTIONS.objectOptIn);\n\n\tif(data.scenes.length <= 0) { return; }\n\n\tif(_SCENES.store.length <= 0) { document.dispatchEvent( new Event(\"_setup\") ); }\n\n\t_SCENES.importData(data.scenes);\n\t_TEXTBOXES.importData(data.textboxes);\n\t_MAP.importData(data.objects);\n\n\t_SCENES.current();\n}\nfunction import_geojson(data, options) {\n\tfor(let f of data.features) {\n\t\tlet o;\n\t\tlet t = a => {\n\t\t\tif(Array.isArray(a[0])) { for(let v of a) { t(v); } }\n\t\t\telse{ a.reverse(); }\n\t\t};\n\t\tlet pos = f.geometry.coordinates; t(pos);\n\n\t\tif(f.properties.type == \"avatar\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\ticon:\t\t\t\tf.properties.icon,\n\t\t\t\tratio:\t\t\t\tf.properties.ratio,\n\t\t\t\trounded:\t\t\tf.properties.rounded,\n\t\t\t\tangle:\t\t\t\tf.properties.angle,\n\t\t\t\tborderColor:\t\tf.properties.borderColor,\n\t\t\t\tborderThickness:\tf.properties.borderThickness,\n\t\t\t\tblur:\t\t\t\tf.properties.overlayBlur,\n\t\t\t\tgrayscale:\t\t\tf.properties.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\tf.properties.overlayBrightness,\n\t\t\t\ttransparency:\t\tf.properties.overlayTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polyline\"\n\t\t|| f.geometry.type == \"LineString\"\n\t\t|| f.geometry.type == \"MultiLineString\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\tpos,\n\t\t\t\tlabel:\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\tf.properties.dashed,\n\t\t\t\tcolor:\t\t\tf.properties.color || options.lineColor,\n\t\t\t\tthickness:\t\tf.properties.thickness || options.lineThickness,\n\t\t\t\ttransparency:\tf.properties.transparency || options.lineTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"polygon\"\n\t\t|| f.properties.type == \"rectangle\"\n\t\t|| f.geometry.type == \"Polygon\"\n\t\t|| f.geometry.type == \"MultiPolygon\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"polygon\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}else\n\t\tif(f.properties.type == \"circle\"\n\t\t|| f.geometry.type == \"Point\") {\n\t\t\to = {\n\t\t\t\tid:\t\t\t\t\tuuid(),\n\t\t\t\tsceneId:\t\t\t_SCENES.active,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\tpos,\n\t\t\t\tradius:\t\t\t\tf.properties.radius || 4000 * (_MAP.getMaxZoom() - _MAP.getZoom()),\n\t\t\t\tlabel:\t\t\t\tf.properties.label,\n\t\t\t\tdashed:\t\t\t\tf.properties.dashed,\n\t\t\t\tlineColor:\t\t\tf.properties.lineColor || options.lineColor,\n\t\t\t\tlineThickness:\t\tf.properties.lineThickness || options.lineThickness,\n\t\t\t\tlineTransparency:\tf.properties.lineTransparency || options.lineTransparency,\n\t\t\t\tfillColor:\t\t\tf.properties.fillColor || options.fillColor,\n\t\t\t\tfillTransparency:\tf.properties.fillTransparency || options.fillTransparency\n\t\t\t};\n\t\t}\n\t\telse{ continue; }\n\n\t\tlet object = _MAP.createObject(o);\n\t\t_MAP.addLayer( object );\n\t\t_MAP.fire(\"_addedlayer\", { layer: object });\n\t\t_MAP.objects.push( _MAP.extractObject(object) );\n\t}\n}\nfunction import_gedcom(data, options) {\n\t//\n}\nexport function import_data(type, data, options) {\n\tswitch(type) {\n\t\tcase \"project\": import_project(data); break;\n\t\tcase \"geojson\": import_geojson(data, options); break;\n\t\tcase \"gedcom\": import_gedcom(data, options); break;\n\t\tdefault: console.error(\"data-import type invalid\"); break;\n\t}\n}\n\n\nfunction export_project() {\n\treturn JSON.stringify({\n\t\toptions: _OPTIONS,\n\t\tscenes: _SCENES.exportData(),\n\t\ttextboxes: _TEXTBOXES.exportData(),\n\t\tobjects: _MAP.exportData()\n\t});\n}\nfunction export_geojson() {\n\tlet r = [];\n\tfor(let o of _MAP.getLayers()) { r.push( o.__toGeoJSON() ); }\n\treturn JSON.stringify({\n\t\t\"type\": \"FeatureCollection\",\n\t\t\"features\": r\n\t});\n}\nlet running = false;\nexport function export_data(type) {\n\tif(running) { return; } running = true;\n\n\tlet el = document.createElement(\"a\");\n\n\tlet f = v => v < 10 && v >= 0 ? `0${v}` : `${v}`;\n\tlet date = new Date();\n\tlet y = date.getFullYear(), m = f(date.getMonth() + 1), d = f(date.getDate()), H = f(date.getHours()), M = f(date.getMinutes()), S = f(date.getSeconds());\n\tlet filename = `${_TITLE} - ${y}.${m}.${d} - ${H}.${M}.${S}`;\n\n\tlet data;\n\tswitch(type) {\n\t\tcase \"project\":\n\t\t\tfilename += \".geotales\";\n\t\t\tdata = \"data:application/json;charset=utf-8,\" + encodeURIComponent( export_project() );\n\t\t\tbreak;\n\n\t\tcase \"geojson\":\n\t\t\tfilename += \".geojson\";\n\t\t\tdata = \"data:application/geo+json;charset=utf-8,\" + encodeURIComponent( export_geojson() );\n\t\t\tbreak;\n\n\t\tdefault: return;\n\t}\n\n\tel.setAttribute(\"href\", data);\n\tel.setAttribute(\"download\", filename);\n\tel.style.display = \"none\";\n\n\tdocument.body.appendChild(el);\n\t$(el).ready(() => { el.click(); document.body.removeChild(el); running = false; });\n}\n\nexport function save_data(callback) {\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: \"api/map_write.php\",\n\t\tdata: {\n\t\t\t\"id\": _ID,\n\t\t\t\"data\": export_project(),\n\t\t\t\"preview\": _MAP.getCenterBasemapTile()\n\t\t},\n\t\tdataType: \"json\",\n\t\tsuccess: function(result, status, xhr) {\n\t\t\tsaved_changes();\n\t\t\tsetTimeout(function() { if(callback) { callback(); } }, 750);\n\t\t},\n\t\terror: function(xhr, status, error) {\n\t\t\tconsole.error(xhr.status, error);\n\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t}\n\t});\n}\n\n\n\nexport function unsaved_changes() {\n\t$(window).off(\"beforeunload\");\n\t$(window).on(\"beforeunload\", ev => {\n\t\tev.preventDefault();\n\n\t\tlet m = \"Unsaved changes could be lost. Are you sure you want to close?\";\n\t\tev.returnValue = m;\n\t\treturn m;\n\t});\n}\n\nexport function saved_changes() {\n\t$(window).off(\"beforeunload\");\n}\n\n\n\nexport function flash_map() {\n\t$(\"div#map\").addClass(\"snapshot\");\n\tsetTimeout(function() { $(\"div#map\").removeClass(\"snapshot\"); }, 240);\n}\n\n\n\nexport function get_basemap(url) {\n\tfor(let b of _BASEMAPS) {\n\t\tif(b.tiles._url == url) { return b; }\n\t}\n\treturn null;\n}\n\nfunction bind_basemaps() {\n\t$(\"#basemapModal #basemaps\").off(\"click\");\n\t$(\"#basemapModal #basemaps\").click(async function(ev) {\n\t\tlet index = $(ev.target).data(\"basemap\");\n\t\tif(!index && index !== 0) { return; }\n\n\t\tawait _MAP.setBasemap( _BASEMAPS[index].tiles );\n\t\t_SCENES.setBasemap();\n\t});\n\n\t$(\"#basemapModal button#uploadBasemap\").click(function(ev) {\n\t\t$(\"#basemapModal input#basemapFile\").click();\n\t});\n}\nexport function init_basemaps() {\n\tgenerate_basemaps(false); bind_basemaps();\n}\nexport function init_img_basemaps() {\n\tgenerate_basemaps(true); bind_basemaps();\n}\n\n\n\nexport function get_aspect_ratio_dimentions(w, h, r) {\n\tlet _w = r * h;\n\tif(_w <= w) {\n\t\treturn [_w, h];\n\t}else{\n\t\treturn [w, w / r];\n\t}\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nexport function new_scene(id, prevId) {\n\n\tlet cont = `\n\t\t<li class=\"list-group-item p-1 my-1\" id=\"${id}\" data-id=\"${id}\">\n\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t<button type=\"button\" class=\"btn btn-outline-light\" id=\"reorder\" title=\"Change ordering\">\n\t\t\t\t\t<i class=\"fas fa-bars\"></i>\n\t\t\t\t</button>\n\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"title\" aria-label=\"Title\" aria-describedby=\"num\" />\n\t\t\t\t<span class=\"input-group-text\" id=\"num\"></span>\n\t\t\t</div>\n\t\t</li>\n\t`;\n\n\tif(prevId) { $(`li[data-id=\"${prevId}\"]`).after(cont); }\n\telse{ $(\"ul#scenes\").append(cont); }\n\n}\n\n\n\nexport function generate_basemaps(isUpload) {\n\tlet html = ``;\n\n\tfor(let i = 0; i < _BASEMAPS.length; i++) {\n\t\tlet b = _BASEMAPS[i];\n\t\tif(b.name !== \"\" && isUpload) { continue; }\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<h6 class=\"card-title mb-0\">${b.name}</h6>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class=\"card-img-bottom\" id=\"basemaps\" src=\"${b.preview}\" alt=\"${b.name}\" data-basemap=\"${i}\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\tif(isUpload) {\n\t\thtml += `\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"card mt-2\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<div class=\"d-grid\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-outline-secondary\" id=\"uploadBasemap\" ${!_USER_PAID ? \"disabled\" : \"\"}>+</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t$(isUpload ?\n\t\t\"#basemapModal #imgBasemapChoose\" :\n\t\t\"#basemapModal #basemapChoose\").html(html);\n}\n\n\n\nexport function avatar_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"avatarPopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<div class=\"input-group-text\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"form-check-input mt-0\" id=\"rounded\" value=\"\" aria-label=\"Rounded\" title=\"Rounded\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type=\"number\" min=\"10\" max=\"500\" step=\"1\" class=\"form-control\" id=\"size\" placeholder=\"Size\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"accordion\" id=\"iconAccordion\">\n\t\t\t\t\t\t<div class=\"accordion-item\">\n\t\t\t\t\t\t\t<h2 class=\"accordion-header\" id=\"iconAccordionHeading\">\n\t\t\t\t\t\t\t\t<button class=\"accordion-button collapsed py-1 px-2\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#iconAccordionCollapse\" aria-expanded=\"false\" aria-controls=\"iconAccordionCollapse\">\n\t\t\t\t\t\t\t\t\tIcon\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div id=\"iconAccordionCollapse\" class=\"accordion-collapse collapse\" aria-labelledby=\"iconAccordionHeading\" data-bs-parent=\"#iconAccordion\">\n\t\t\t\t\t\t\t\t<div class=\"accordion-body py-1\" style=\"max-height: 80px; overflow-y: auto;\">\n\t\t\t\t\t\t\t\t\t<div class=\"row row-cols-5\" id=\"iconChoose\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"col\">\n\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"iconAdd\" title=\"Add icon\">+</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"color\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"10\" class=\"form-control\" id=\"thickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"3\" step=\"0.1\" class=\"form-control\" id=\"blur\" placeholder=\"Blur\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"grayscale\" placeholder=\"Grayscale\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"6\" step=\"1\" class=\"form-control\" id=\"brightness\" placeholder=\"Brightness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"transparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polyline_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n\nexport function polygon_popup() {\n\n\treturn `\n\t\t<form class=\"container-fluid objectPopup\" id=\"shapePopup\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control form-control-sm\" id=\"label\" aria-label=\"label\" placeholder=\"Label\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"lineColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"2\" max=\"10\" class=\"form-control\" id=\"lineThickness\" placeholder=\"Thickness\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"0.9\" step=\"0.1\" class=\"form-control\" id=\"lineTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"form-check mt-1\">\n\t\t\t\t\t\t<input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"dashed\">\n\t\t\t\t\t\t<label class=\"form-check-label\" for=\"dashed\">Dashed</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row my-3\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<div class=\"input-group input-group-sm\">\n\t\t\t\t\t\t<input type=\"color\" class=\"form-control form-control-color\" id=\"fillColor\" value=\"#563d7c\" title=\"Choose color\" />\n\t\t\t\t\t\t<input type=\"number\" min=\"0\" max=\"1\" step=\"0.1\" class=\"form-control\" id=\"fillTransparency\" placeholder=\"Transparency\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row mb-2\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<input type=\"number\" class=\"form-control form-control-sm\" id=\"animationSpeed\" min=\"0.1\" max=\"10\" step=\"0.1\" aria-label=\"Animation speed\" placeholder=\"Animation speed (sec.)\" title=\"This objects animation speed to next scene\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-secondary py-0\" id=\"makeGlobal\" title=\"Save options globally\">\n\t\t\t\t\t\t<i class=\"fas fa-save\"></i> <strong>*</strong>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, flash_map } from \"./helpers.js\";\nimport { new_scene } from \"./generate.js\";\n\n\nexport function Scenes() {\n\tthis.store = [];\n\tthis.active = \"\";\n\tthis.copiedBounds = null;\n\n\n\tthis.setup = function() {\n\t\t$(\"#scenes\").sortable({ // https://api.jqueryui.com/sortable/\n\t\t\tcursor: \"move\", handle: \"button#reorder\", items: \"> li\", containment: \"parent\", tolerance: \"pointer\", cancel: \"\", zIndex: 1003, axis: \"x\", //scroll: false,\n\t\t\tstart: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.unbind();\n\t\t\t},\n\t\t\tupdate: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\t//let id = $(ui.item[0]).data(\"id\"), order = $(\"#scenes\").sortable(\"toArray\");\n\t\t\t\tthis.reorder( $(\"#scenes\").sortable(\"toArray\") );\n\t\t\t},\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tev.stopPropagation();\n\t\t\t\tthis.bind();\n\t\t\t}\n\t\t});\n\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", false);\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#scenes\").sortable(\"destroy\");\n\t\t$(\"#sceneRow button#delete, #sceneRow button#recapture\").prop(\"disabled\", true);\n\t};\n\n\tthis.get = function(id) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif(s.id == id) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getEl = function(el) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet s = Object.assign({}, this.store[i]);\n\t\t\tif( $(`li[data-id=\"${s.id}\"]`)[0].contains(el) ) { s.index = i; return s; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.getPrevScene = function(id) {\n\t\tlet s = this.get(id);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\treturn Object.assign({}, this.store[ s.index - 1 ]);\n\t};\n\n\tthis.reorder = function(order) {\n\t\tthis.store.sort((a,b) => order.indexOf(a.id) - order.indexOf(b.id));\n\t\tthis.set(this.active);\n\t};\n\n\tthis.add = function() {\n\t\tif(this.store.length <= 0) {\n\t\t\tdocument.dispatchEvent( new Event(\"_setup\") );\n\t\t}\n\n\t\tlet s = new Scene(null, this.active);\n\t\ts.capture();\n\n\t\tif(this.active) { this.store.splice(this.get(this.active).index + 1, 0, s); }\n\t\telse{ this.store.push(s); }\n\n\t\t_TEXTBOXES.addScene(s.id);\n\t\t_MAP.addScene(s.id);\n\n\t\tthis.set(s.id);\n\t\tthis.bind();\n\n\t\tsave_data();\n\t};\n\n\tthis.capture = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.capture();\n\t\tflash_map();\n\t\tsave_data();\n\t};\n\n\tthis.delete = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.get( this.active );\n\n\t\t_TEXTBOXES.deleteScene(s.id);\n\t\t_MAP.deleteScene(s.id);\n\n\t\tif( !this.prev() ) { this.next(); }\n\n\t\tthis.store.splice(s.index, 1);\n\n\t\t$(`li[data-id=\"${s.id}\"]`).remove();\n\n\t\tthis.setNumbering();\n\n\t\tif(this.store.length <= 0) {\n\t\t\tthis.active = \"\";\n\t\t\tdocument.dispatchEvent( new Event(\"_reset\") );\n\t\t}\n\n\t\tsave_data();\n\t};\n\n\tthis.unbind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", true);\n\t\t$(\"#scenes li\").off(\"click\");\n\t};\n\tthis.bind = function() {\n\t\t$(\"#scenes li button#reorder\").prop(\"disabled\", false);\n\t\t$(\"#scenes li\").off(\"click\");\n\t\t$(\"#scenes li\").click(ev => {\n\t\t\tlet s = this.getEl(ev.target);\n\t\t\tif(!s) { return; }\n\n\t\t\tlet el = $(`li[data-id=\"${s.id}\"]`);\n\t\t\tif(el.hasClass(\"active\")) { return; }\n\n\t\t\tthis.set(s.id);\n\t\t});\n\t};\n\n\tthis.prev = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index <= 0) { return; }\n\n\t\ts = this.store[ s.index - 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.current = function() {\n\t\tthis.set(this.active);\n\t\tthis.bind();\n\t};\n\n\tthis.next = function() {\n\t\tlet s = this.get(this.active);\n\t\tif(!s || s.index >= this.store.length - 1) { return; }\n\n\t\ts = this.store[ s.index + 1 ];\n\t\tthis.set(s.id);\n\t\treturn Object.assign({}, s);\n\t};\n\n\tthis.set = function(id) {\n\t\tif(this.active) { this.get(this.active).disable(); }\n\t\tthis.active = id;\n\n\t\tlet s = this.get(id);\n\t\ts.enable();\n\n\t\t$(`li[data-id=\"${s.id}\"]`)[0].scrollIntoView({ behavior: \"smooth\", inline: \"center\" });\n\n\t\t_TEXTBOXES.set(s.id);\n\t\t_MAP.set(s.id);\n\n\t\tthis.setNumbering();\n\t};\n\n\tthis.setWMS = function() {\n\t\tthis.store[ this.get(this.active).index ].setWMS();\n\t};\n\tthis.setBasemap = function() {\n\t\tthis.store[ this.get(this.active).index ].setBasemap();\n\t};\n\n\tthis.setBookmark = function(b) {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBookmark(b);\n\t\tsave_data();\n\t};\n\n\tthis.setNumbering = function() {\n\t\tlet i = 1;\n\t\tfor(let n of $(\"#scenes li span#num\")) {\n\t\t\t$(n).html(i++);\n\t\t}\n\t};\n\n\tthis.copyBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tthis.copiedBounds = this.get(this.active).bounds;\n\t};\n\n\tthis.pasteBounds = function() {\n\t\tif(!this.active) { return; }\n\n\t\tlet s = this.store[ this.get(this.active).index ];\n\t\ts.setBounds(this.copiedBounds);\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tif(this.store.length <= 0 || !this.active) {\n\t\t\tthis.active = data[0].id;\n\t\t}\n\n\t\tfor(let o of data) {\n\t\t\tlet s = new Scene(o.id);\n\t\t\ts.bounds = o.bounds;\n\t\t\ts.wms = o.wms;\n\t\t\ts.basemap = o.basemap;\n\n\t\t\ts.setBookmark(o.bookmark);\n\t\t\ts.setTitle(o.title);\n\n\t\t\ts.disable();\n\n\t\t\tthis.store.push(s);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let s of this.store) { r.push( s.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Scene(id, prevId) {\n\tthis.id = id || uuid();\n\n\tthis.bounds = null;\n\tthis.wms = null;\n\tthis.basemap = null;\n\n\tthis.bookmark = false;\n\tthis.title = \"\";\n\n\tnew_scene(this.id, prevId);\n\n\t$(`li[data-id=\"${this.id}\"]`).on(\"keydown keyup\", ev => { ev.stopPropagation(); });\n\t$(`li[data-id=\"${this.id}\"] input#title`).change(ev => { this.title = ev.target.value; });\n\n\n\tthis.enable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).addClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).prop(\"disabled\", false);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).click(ev => { ev.stopPropagation(); });\n\t};\n\n\tthis.disable = function() {\n\t\t$(`li[data-id=\"${this.id}\"]`).removeClass(\"active\");\n\t\t$(`li[data-id=\"${this.id}\"] input`).prop(\"disabled\", true);\n\t\t$(`li[data-id=\"${this.id}\"] input, li[data-id=\"${this.id}\"] button`).off(\"click\");\n\t};\n\n\tthis.setBounds = function(bounds) {\n\t\tthis.bounds = bounds;\n\t\t_MAP.setFlyTo( this.bounds );\n\t};\n\n\tthis.setWMS = function() { this.wms = _MAP.getWMS(); };\n\tthis.setBasemap = function() { this.basemap = _MAP.getBasemap(); };\n\n\tthis.setBookmark = function(b) {\n\t\tthis.bookmark = b;\n\t\tif(b) { $(`li[data-id=\"${this.id}\"]`).addClass(\"bookmark\"); }\n\t\telse{ $(`li[data-id=\"${this.id}\"]`).removeClass(\"bookmark\"); }\n\t};\n\n\tthis.setTitle = function(t) {\n\t\tthis.title = t;\n\t\t$(`li[data-id=\"${this.id}\"] input#title`).val(this.title);\n\t};\n\n\tthis.capture = function() {\n\t\tlet nw = _MAP.getBounds().getNorthWest(),\n\t\t\tse = _MAP.getBounds().getSouthEast();\n\t\tthis.setBounds( [[nw.lat, nw.lng], [se.lat, se.lng]] );\n\t\tthis.setBasemap();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbounds: this.bounds,\n\t\t\twms: this.wms,\n\t\t\tbasemap: this.basemap,\n\t\t\tbookmark: this.bookmark,\n\t\t\ttitle: this.title\n\t\t};\n\t};\n}\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport \"trumbowyg\";\n\nimport { uuid, save_data } from \"./helpers.js\";\n\n\nexport function Textboxes() {\n\tthis.store = [];\n\n\t$(\"input#_img_textbox\").change(function(ev) {\n\t\tlet file = $(this)[0].files[0];\n\t\tif(!file) { return; }\n\n\t\t$(\"#loadingModal\").modal(\"show\");\n\t\tlet data = new FormData();\n\t\tdata.append(\"type\", \"image\");\n\t\tdata.append(\"image\", file);\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: \"api/upload_create.php\",\n\t\t\tdata: data,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false,\n\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertImage\", param: result, forceCss: false, skipTrumbowyg: true });\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.log(xhr.status, error);\n\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\"#textbox input#lock\").change(ev => {\n\t\tthis.setLock( ev.target.checked );\n\t});\n\n\t$(\"#textbox button#close\").click(ev => { this.delete(_SCENES.active); });\n\n\t$(\"#textboxOptionsModal select#bookOrientation\").change(ev => {\n\t\tthis.setOrientation( ev.target.value );\n\t});\n\n\n\tthis.setup = function() {\n\t\t$(\"#textbox\").resizable({ // https://api.jqueryui.com/resizable/\n\t\t\tcontainment: \"#mapRow\", handles: \"e\", minWidth: 100,\n\t\t\tstop: (ev, ui) => {\n\t\t\t\tlet w = ui.size.width / ($(\"#mapRow\").outerWidth() - 20),\n\t\t\t\t\tt = this.get(_SCENES.active);\n\t\t\t\tif(t) {\n\t\t\t\t\tthis.store[ t.index ].dim = [0, w];\n\t\t\t\t\t$(\"#textbox\").css({ width: `${w * 100}%` });\n\t\t\t\t\tif(t.pos == \"right\") { $(\"#textbox\").css({ left: \"auto\" }); }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"#textbox #content\").trumbowyg({\n\t\t\tautogrow: true, semantic: false, resetCss: true, removeformatPasted: true, urlProtocol: true,\n\t\t\tdefaultLinkTarget: \"_blank\",\n\t\t\ttagsToRemove: [\"script\", \"link\"],\n\t\t\tbtnsDef: {\n\t\t\t\tformat: { dropdown: [\"bold\", \"italic\", \"underline\", \"del\"], title: \"Format\", ico: \"bold\" },\n\t\t\t\talign: {\n\t\t\t\t\tdropdown: [\"justifyLeft\", \"justifyCenter\", \"justifyRight\", \"justifyFull\", \"unorderedList\", \"orderedList\"],\n\t\t\t\t\ttitle: \"List/Align\",\n\t\t\t\t\tico: \"justifyLeft\"\n\t\t\t\t},\n\t\t\t\tuploadImg: {\n\t\t\t\t\tfn: ev => { $(\"input#_img_textbox\").click(); },\n\t\t\t\t\ttitle: \"Add image\", ico: \"insertImage\"\n\t\t\t\t},\n\t\t\t\tmakeLink: {\n\t\t\t\t\tfn: ev => {\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"saveRange\");\n\t\t\t\t\t\tlet text = $(\"#textbox #content\").trumbowyg(\"getRangeText\");\n\t\t\t\t\t\tif(text.replace(/\\s/g, \"\") == \"\") { return; }\n\n\t\t\t\t\t\tif([\"http\", \"https\"].indexOf(text.split(\"://\")[0]) < 0) { text = `https://${text}`; }\n\t\t\t\t\t\t$(\"#textbox #content\").trumbowyg(\"execCmd\", { cmd: \"insertHTML\", param: `<a href=\"${text}\" target=\"_blank\">${text}</a>`, forceCss: false });\n\t\t\t\t\t},\n\t\t\t\t\ttitle: \"Create link\", ico: \"link\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtns: [\n\t\t\t\t[\"formatting\"], [\"format\"], [\"align\"], [\"fontfamily\"], [\"foreColor\", \"backColor\"], [\"makeLink\"], [\"uploadImg\"]\n\t\t\t],\n\t\t\tplugins: {}\n\t\t}).on(\"tbwchange\", () => {\n\t\t\tlet t = this.get(_SCENES.active);\n\t\t\tif(t) { this.store[ t.index ].content = $(\"#textbox #content\").trumbowyg(\"html\"); }\n\t\t});\n\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.reset = function() {\n\t\t$(\"#textbox\").resizable(\"destroy\");\n\t\t$(\"#textbox #content\").trumbowyg(\"destroy\");\n\t\t_MAP.setOrientation(\"right\");\n\t};\n\n\tthis.get = function(sceneId) {\n\t\tfor(let i = 0; i < this.store.length; i++) {\n\t\t\tlet t = Object.assign({}, this.store[i]);\n\t\t\tif(t.sceneId == sceneId) { t.index = i; return t; }\n\t\t}\n\t\treturn null;\n\t};\n\n\tthis.add = function() {\n\t\tif(!_SCENES.active) { return; }\n\n\t\tlet t = new Textbox(null);\n\t\tt.sceneId = _SCENES.active;\n\t\tt.enable();\n\t\tthis.store.push(t);\n\t\tsave_data();\n\t};\n\n\tthis.addScene = function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(prev) {\n\t\t\tfor(let t of this.store) {\n\t\t\t\tif(t.sceneId == prev.id && t.locked) {\n\t\t\t\t\tlet tt = new Textbox(null);\n\t\t\t\t\ttt.sceneId = sceneId;\n\t\t\t\t\ttt.pos = t.pos; tt.dim = t.dim;\n\t\t\t\t\ttt.content = t.content;\n\t\t\t\t\ttt.locked = true;\n\t\t\t\t\ttt.enable();\n\t\t\t\t\tthis.store.push(tt);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.delete = function(sceneId) {\n\t\tlet t = this.get(sceneId);\n\t\tif(!t) { return; }\n\n\t\tt.disable();\n\t\tthis.store.splice(t.index, 1);\n\t\tsave_data();\n\t};\n\n\tthis.deleteScene = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { this.delete(t.sceneId); }\n\t\t}\n\t};\n\n\tthis.set = function(sceneId) {\n\t\tfor(let t of this.store) {\n\t\t\tif(t.sceneId == sceneId) { t.enable(); break; }\n\t\t\telse{ t.disable(); }\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].setLock(l);\n\t};\n\n\tthis.setOrientation = function(pos) {\n\t\tlet t = this.get(_SCENES.active);\n\t\tif(!t) { return; }\n\n\t\tthis.store[ t.index ].pos = pos;\n\t\tthis.store[ t.index ].setOrientation();\n\t};\n\n\tthis.importData = function(data) {\n\t\tif(data.length <= 0) { return; }\n\n\t\tfor(let o of data) {\n\t\t\tlet t = new Textbox(o.id);\n\t\t\tt.sceneId = o.sceneId;\n\t\t\tif(o.pos) { t.pos = o.pos; }\n\t\t\tif(o.dim) { t.dim = o.dim; }\n\t\t\tt.content = o.content;\n\t\t\tt.locked = o.locked;\n\n\t\t\tt.disable();\n\n\t\t\tthis.store.push(t);\n\t\t}\n\t};\n\n\tthis.exportData = function() {\n\t\tlet r = [];\n\t\tfor(let t of this.store) { r.push( t.exportData() ); }\n\t\treturn r;\n\t};\n}\n\n\n\nfunction Textbox(id) {\n\tthis.id = id || uuid();\n\n\tthis.sceneId = \"\";\n\tthis.locked = false;\n\n\tthis.pos = \"left\";\n\tthis.dim = [0, 0.25];\n\tthis.content = \"\";\n\n\n\tthis.setOrientation = function() {\n\t\tswitch(this.pos) {\n\t\t\tcase \"left\":\n\t\t\t\t$(\"#textbox\").css({ left: \"10px\", right: \"auto\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"e\" });\n\t\t\t\t_MAP.setOrientation(\"right\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\t$(\"#textbox\").css({ left: \"auto\", right: \"10px\" });\n\t\t\t\t$(\"#textbox\").resizable(\"option\", { handles: \"w\" });\n\t\t\t\t_MAP.setOrientation(\"left\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t};\n\n\tthis.setLock = function(l) {\n\t\tthis.locked = l;\n\t\t$(\"#textbox input#lock\").prop(\"checked\", this.locked);\n\t};\n\n\tthis.enable = function() {\n\t\tthis.setOrientation();\n\n\t\t$(\"#textbox\").css(\"display\", \"block\");\n\t\t$(\"#textbox\").css({ width: `${this.dim[1] * 100}%` });\n\n\t\t$(\"#textbox #content\").trumbowyg(\"enable\");\n\t\t$(\"#textbox #content\").trumbowyg(\"html\", this.content);\n\n\t\t$(\"#textbox #lock\").prop({ disabled: false, checked: this.locked });\n\n\t\t_MAP.textboxButton.disable();\n\t};\n\n\tthis.disable = function() {\n\t\t$(\"#textbox\").css(\"display\", \"none\");\n\t\t$(\"#textbox #content\").trumbowyg(\"disable\");\n\t\t$(\"#textbox #lock\").prop(\"disabled\", true);\n\t\t_MAP.textboxButton.enable();\n\t};\n\n\tthis.exportData = function() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tsceneId: this.sceneId,\n\t\t\tlocked: this.locked,\n\t\t\tpos: this.pos,\n\t\t\tdim: this.dim,\n\t\t\tcontent: this.content\n\t\t};\n\t};\n}\n","/**\n * Trumbowyg v2.26.0 - A lightweight WYSIWYG editor\n * Trumbowyg core file\n * ------------------------\n * @link http://alex-d.github.io/Trumbowyg\n * @license MIT\n * @author Alexandre Demode (Alex-D)\n *         Twitter : @AlexandreDemode\n *         Website : alex-d.fr\n */\n\njQuery.trumbowyg = {\n    langs: {\n        en: {\n            viewHTML: 'View HTML',\n\n            undo: 'Undo',\n            redo: 'Redo',\n\n            formatting: 'Formatting',\n            p: 'Paragraph',\n            blockquote: 'Quote',\n            code: 'Code',\n            header: 'Header',\n\n            bold: 'Bold',\n            italic: 'Italic',\n            strikethrough: 'Strikethrough',\n            underline: 'Underline',\n\n            strong: 'Strong',\n            em: 'Emphasis',\n            del: 'Deleted',\n\n            superscript: 'Superscript',\n            subscript: 'Subscript',\n\n            unorderedList: 'Unordered list',\n            orderedList: 'Ordered list',\n\n            insertImage: 'Insert Image',\n            link: 'Link',\n            createLink: 'Insert link',\n            unlink: 'Remove link',\n\n            _self: 'Same tab (default)',\n            _blank: 'New tab',\n\n            justifyLeft: 'Align Left',\n            justifyCenter: 'Align Center',\n            justifyRight: 'Align Right',\n            justifyFull: 'Align Justify',\n\n            horizontalRule: 'Insert horizontal rule',\n            removeformat: 'Remove format',\n\n            fullscreen: 'Fullscreen',\n\n            close: 'Close',\n\n            submit: 'Confirm',\n            reset: 'Cancel',\n\n            required: 'Required',\n            description: 'Description',\n            title: 'Title',\n            text: 'Text',\n            target: 'Target',\n            width: 'Width'\n        }\n    },\n\n    // Plugins\n    plugins: {},\n\n    // SVG Path globally\n    svgPath: null,\n    svgAbsoluteUseHref: false,\n\n    hideButtonTexts: null\n};\n\n// Makes default options read-only\nObject.defineProperty(jQuery.trumbowyg, 'defaultOptions', {\n    value: {\n        lang: 'en',\n\n        fixedBtnPane: false,\n        fixedFullWidth: false,\n        autogrow: false,\n        autogrowOnEnter: false,\n        imageWidthModalEdit: false,\n        hideButtonTexts: null,\n\n        prefix: 'trumbowyg-',\n        tagClasses: {},\n        semantic: true,\n        semanticKeepAttributes: false,\n        resetCss: false,\n        removeformatPasted: false,\n        tabToIndent: false,\n        tagsToRemove: [],\n        tagsToKeep: ['hr', 'img', 'embed', 'iframe', 'input'],\n        btns: [\n            ['viewHTML'],\n            ['undo', 'redo'], // Only supported in Blink browsers\n            ['formatting'],\n            ['strong', 'em', 'del'],\n            ['superscript', 'subscript'],\n            ['link'],\n            ['insertImage'],\n            ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],\n            ['unorderedList', 'orderedList'],\n            ['horizontalRule'],\n            ['removeformat'],\n            ['fullscreen']\n        ],\n        // For custom button definitions\n        btnsDef: {},\n        changeActiveDropdownIcon: false,\n\n        inlineElementsSelector: 'a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u',\n\n        pasteHandlers: [],\n\n        // imgDblClickHandler: default is defined in constructor\n\n        plugins: {},\n\n        urlProtocol: false,\n        minimalLinks: false,\n        linkTargets: ['_self', '_blank'],\n\n        svgPath: null\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false\n});\n\n(function (navigator, window, document, $) {\n    'use strict';\n\n    var CONFIRM_EVENT = 'tbwconfirm',\n        CANCEL_EVENT = 'tbwcancel';\n\n    $.fn.trumbowyg = function (options, params) {\n        var trumbowygDataName = 'trumbowyg';\n        if (options === Object(options) || !options) {\n            return this.each(function () {\n                if (!$(this).data(trumbowygDataName)) {\n                    $(this).data(trumbowygDataName, new Trumbowyg(this, options));\n                }\n            });\n        }\n        if (this.length === 1) {\n            try {\n                var t = $(this).data(trumbowygDataName);\n                switch (options) {\n                    // Exec command\n                    case 'execCmd':\n                        return t.execCmd(params.cmd, params.param, params.forceCss, params.skipTrumbowyg);\n\n                    // Modal box\n                    case 'openModal':\n                        return t.openModal(params.title, params.content);\n                    case 'closeModal':\n                        return t.closeModal();\n                    case 'openModalInsert':\n                        return t.openModalInsert(params.title, params.fields, params.callback);\n\n                    // Range\n                    case 'saveRange':\n                        return t.saveRange();\n                    case 'getRange':\n                        return t.range;\n                    case 'getRangeText':\n                        return t.getRangeText();\n                    case 'restoreRange':\n                        return t.restoreRange();\n\n                    // Enable/disable\n                    case 'enable':\n                        return t.setDisabled(false);\n                    case 'disable':\n                        return t.setDisabled(true);\n\n                    // Toggle\n                    case 'toggle':\n                        return t.toggle();\n\n                    // Destroy\n                    case 'destroy':\n                        return t.destroy();\n\n                    // Empty\n                    case 'empty':\n                        return t.empty();\n\n                    // HTML\n                    case 'html':\n                        return t.html(params);\n                }\n            } catch (c) {\n            }\n        }\n\n        return false;\n    };\n\n    // @param: editorElem is the DOM element\n    var Trumbowyg = function (editorElem, options) {\n        var t = this,\n            trumbowygIconsId = 'trumbowyg-icons',\n            $trumbowyg = $.trumbowyg;\n\n        // Get the document of the element. It use to makes the plugin\n        // compatible on iframes.\n        t.doc = editorElem.ownerDocument || document;\n\n        // jQuery object of the editor\n        t.$ta = $(editorElem); // $ta : Textarea\n        t.$c = $(editorElem); // $c : creator\n\n        options = options || {};\n\n        // Localization management\n        if (options.lang != null || $trumbowyg.langs[options.lang] != null) {\n            t.lang = $.extend(true, {}, $trumbowyg.langs.en, $trumbowyg.langs[options.lang]);\n        } else {\n            t.lang = $trumbowyg.langs.en;\n        }\n\n        t.hideButtonTexts = $trumbowyg.hideButtonTexts != null ? $trumbowyg.hideButtonTexts : options.hideButtonTexts;\n\n        // SVG path\n        var svgPathOption = $trumbowyg.svgPath != null ? $trumbowyg.svgPath : options.svgPath;\n        t.hasSvg = svgPathOption !== false;\n\n        if (svgPathOption !== false && ($trumbowyg.svgAbsoluteUseHref || $('#' + trumbowygIconsId, t.doc).length === 0)) {\n            if (svgPathOption == null) {\n                // Hack to get svgPathOption based on trumbowyg.js path\n                var $scriptElements = $('script[src]');\n                $scriptElements.each(function (i, scriptElement) {\n                    var source = scriptElement.src;\n                    var matches = source.match('trumbowyg(\\.min)?\\.js');\n                    if (matches != null) {\n                        svgPathOption = source.substring(0, source.indexOf(matches[0])) + 'ui/icons.svg';\n                    }\n                });\n            }\n\n            // Do not merge with previous if block: svgPathOption can be redefined in it.\n            // Here we are checking that we find a match\n            if (svgPathOption == null) {\n                console.warn('You must define svgPath: https://goo.gl/CfTY9U'); // jshint ignore:line\n            } else if (!$trumbowyg.svgAbsoluteUseHref) {\n                var div = t.doc.createElement('div');\n                div.id = trumbowygIconsId;\n                t.doc.body.insertBefore(div, t.doc.body.childNodes[0]);\n                $.ajax({\n                    async: true,\n                    type: 'GET',\n                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n                    dataType: 'xml',\n                    crossDomain: true,\n                    url: svgPathOption,\n                    data: null,\n                    beforeSend: null,\n                    complete: null,\n                    success: function (data) {\n                        div.innerHTML = new XMLSerializer().serializeToString(data.documentElement);\n                    }\n                });\n            }\n        }\n\n        var baseHref = !!t.doc.querySelector('base') ? window.location.href.replace(window.location.hash, '') : '';\n        t.svgPath = $trumbowyg.svgAbsoluteUseHref ? svgPathOption : baseHref;\n\n\n        /**\n         * When the button is associated to a empty object\n         * fn and title attributes are defined from the button key value\n         *\n         * For example\n         *      foo: {}\n         * is equivalent to :\n         *      foo: {\n         *          fn: 'foo',\n         *          title: this.lang.foo\n         *      }\n         */\n        var h = t.lang.header, // Header translation\n            isBlinkFunction = function () {\n                return (window.chrome || (window.Intl && Intl.v8BreakIterator)) && 'CSS' in window;\n            };\n        t.btnsDef = {\n            viewHTML: {\n                fn: 'toggle',\n                class: 'trumbowyg-not-disable',\n            },\n\n            undo: {\n                isSupported: isBlinkFunction,\n                key: 'Z'\n            },\n            redo: {\n                isSupported: isBlinkFunction,\n                key: 'Y'\n            },\n\n            p: {\n                fn: 'formatBlock'\n            },\n            blockquote: {\n                fn: 'formatBlock'\n            },\n            h1: {\n                fn: 'formatBlock',\n                title: h + ' 1'\n            },\n            h2: {\n                fn: 'formatBlock',\n                title: h + ' 2'\n            },\n            h3: {\n                fn: 'formatBlock',\n                title: h + ' 3'\n            },\n            h4: {\n                fn: 'formatBlock',\n                title: h + ' 4'\n            },\n            h5: {\n                fn: 'formatBlock',\n                title: h + ' 5'\n            },\n            h6: {\n                fn: 'formatBlock',\n                title: h + ' 6'\n            },\n            subscript: {\n                tag: 'sub'\n            },\n            superscript: {\n                tag: 'sup'\n            },\n\n            bold: {\n                key: 'B',\n                tag: 'b'\n            },\n            italic: {\n                key: 'I',\n                tag: 'i'\n            },\n            underline: {\n                tag: 'u'\n            },\n            strikethrough: {\n                tag: 'strike'\n            },\n\n            strong: {\n                fn: 'bold',\n                key: 'B'\n            },\n            em: {\n                fn: 'italic',\n                key: 'I'\n            },\n            del: {\n                fn: 'strikethrough'\n            },\n\n            createLink: {\n                key: 'K',\n                tag: 'a'\n            },\n            unlink: {},\n\n            insertImage: {},\n\n            justifyLeft: {\n                tag: 'left',\n                forceCss: true\n            },\n            justifyCenter: {\n                tag: 'center',\n                forceCss: true\n            },\n            justifyRight: {\n                tag: 'right',\n                forceCss: true\n            },\n            justifyFull: {\n                tag: 'justify',\n                forceCss: true\n            },\n\n            unorderedList: {\n                fn: 'insertUnorderedList',\n                tag: 'ul'\n            },\n            orderedList: {\n                fn: 'insertOrderedList',\n                tag: 'ol'\n            },\n\n            horizontalRule: {\n                fn: 'insertHorizontalRule'\n            },\n\n            removeformat: {},\n\n            fullscreen: {\n                class: 'trumbowyg-not-disable'\n            },\n            close: {\n                fn: 'destroy',\n                class: 'trumbowyg-not-disable'\n            },\n\n            // Dropdowns\n            formatting: {\n                dropdown: ['p', 'blockquote', 'h1', 'h2', 'h3', 'h4'],\n                ico: 'p'\n            },\n            link: {\n                dropdown: ['createLink', 'unlink']\n            }\n        };\n\n        // Default Options\n        t.o = $.extend(true, {}, $trumbowyg.defaultOptions, options);\n        if (!t.o.hasOwnProperty('imgDblClickHandler')) {\n            t.o.imgDblClickHandler = t.getDefaultImgDblClickHandler();\n        }\n\n        t.urlPrefix = t.setupUrlPrefix();\n\n        t.disabled = t.o.disabled || (editorElem.nodeName === 'TEXTAREA' && editorElem.disabled);\n\n        if (options.btns) {\n            t.o.btns = options.btns;\n        } else if (!t.o.semantic) {\n            t.o.btns[3] = ['bold', 'italic', 'underline', 'strikethrough'];\n        }\n\n        $.each(t.o.btnsDef, function (btnName, btnDef) {\n            t.addBtnDef(btnName, btnDef);\n        });\n\n        // put this here in the event it would be merged in with options\n        t.eventNamespace = 'trumbowyg-event';\n\n        // Keyboard shortcuts are load in this array\n        t.keys = [];\n\n        // Tag to button dynamically hydrated\n        t.tagToButton = {};\n        t.tagHandlers = [];\n\n        // Admit multiple paste handlers\n        t.pasteHandlers = [].concat(t.o.pasteHandlers);\n\n        // Check if browser is IE\n        t.isIE = navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') !== -1;\n\n        // Check if we are on macOs\n        t.isMac = navigator.platform.toUpperCase().indexOf('MAC') !== -1;\n\n        t.init();\n    };\n\n    Trumbowyg.prototype = {\n        DEFAULT_SEMANTIC_MAP: {\n            'b': 'strong',\n            'i': 'em',\n            's': 'del',\n            'strike': 'del',\n            'div': 'p'\n        },\n\n        init: function () {\n            var t = this;\n            t.height = t.$ta.height();\n\n            t.initPlugins();\n\n            try {\n                // Disable image resize, try-catch for old IE\n                t.doc.execCommand('enableObjectResizing', false, false);\n                t.doc.execCommand('defaultParagraphSeparator', false, 'p');\n            } catch (e) {\n            }\n\n            t.buildEditor();\n            t.buildBtnPane();\n\n            t.fixedBtnPaneEvents();\n\n            t.buildOverlay();\n\n            setTimeout(function () {\n                if (t.disabled) {\n                    t.setDisabled(true);\n                }\n                t.$c.trigger('tbwinit');\n            });\n        },\n\n        addBtnDef: function (btnName, btnDef) {\n            this.btnsDef[btnName] = $.extend(btnDef, this.btnsDef[btnName] || {});\n        },\n\n        setupUrlPrefix: function () {\n            var protocol = this.o.urlProtocol;\n            if (!protocol) {\n                return;\n            }\n\n            if (typeof (protocol) !== 'string') {\n                return 'https://';\n            }\n            return protocol.replace('://', '') + '://';\n        },\n\n        buildEditor: function () {\n            var t = this,\n                prefix = t.o.prefix,\n                html = '';\n\n            t.$box = $('<div/>', {\n                class: prefix + 'box ' + prefix + 'editor-visible ' + prefix + t.o.lang + ' trumbowyg'\n            });\n\n            // $ta = Textarea\n            // $ed = Editor\n            t.isTextarea = t.$ta.is('textarea');\n            if (t.isTextarea) {\n                html = t.$ta.val();\n                t.$ed = $('<div/>');\n                t.$box\n                    .insertAfter(t.$ta)\n                    .append(t.$ed, t.$ta);\n            } else {\n                t.$ed = t.$ta;\n                html = t.$ed.html();\n\n                t.$ta = $('<textarea/>', {\n                    name: t.$ta.attr('id'),\n                    height: t.height\n                }).val(html);\n\n                t.$box\n                    .insertAfter(t.$ed)\n                    .append(t.$ta, t.$ed);\n                t.syncCode();\n            }\n\n            t.$ta\n                .addClass(prefix + 'textarea')\n                .attr('tabindex', -1)\n            ;\n\n            t.$ed\n                .addClass(prefix + 'editor')\n                .attr({\n                    contenteditable: true,\n                    dir: t.lang._dir || 'ltr'\n                })\n                .html(html)\n            ;\n\n            if (t.o.tabindex) {\n                t.$ed.attr('tabindex', t.o.tabindex);\n            }\n\n            if (t.$c.is('[placeholder]')) {\n                t.$ed.attr('placeholder', t.$c.attr('placeholder'));\n            }\n\n            if (t.$c.is('[spellcheck]')) {\n                t.$ed.attr('spellcheck', t.$c.attr('spellcheck'));\n            }\n\n            if (t.o.resetCss) {\n                t.$ed.addClass(prefix + 'reset-css');\n            }\n\n            if (!t.o.autogrow) {\n                t.$ta.add(t.$ed).css({\n                    height: t.height\n                });\n            }\n\n            t.semanticCode();\n\n            if (t.o.autogrowOnEnter) {\n                t.$ed.addClass(prefix + 'autogrow-on-enter');\n            }\n\n            var ctrl = false,\n                composition = false,\n                debounceButtonPaneStatus;\n\n            t.$ed\n                .on('dblclick', 'img', t.o.imgDblClickHandler)\n                .on('keydown', function (e) {\n                    // append flags to differentiate Chrome spans\n                    var keyCode = e.which;\n                    if (keyCode === 8 || keyCode === 13 || keyCode === 46) {\n                        t.toggleSpan(true);\n                    }\n                    if ((e.ctrlKey || e.metaKey) && !e.altKey) {\n                        ctrl = true;\n                        var key = t.keys[String.fromCharCode(e.which).toUpperCase()];\n\n                        try {\n                            t.execCmd(key.fn, key.param);\n                            return false;\n                        } catch (c) {\n                        }\n                    } else {\n                        if (t.o.tabToIndent && e.key === 'Tab') {\n                            try {\n                                if (e.shiftKey) {\n                                    t.execCmd('outdent', true, null);\n                                } else {\n                                    t.execCmd('indent', true, null);\n                                }\n                                return false;\n                            } catch (c) {\n                            }\n                        }\n                    }\n                })\n                .on('compositionstart compositionupdate', function () {\n                    composition = true;\n                })\n                .on('keyup compositionend', function (e) {\n                    if (e.type === 'compositionend') {\n                        composition = false;\n                    } else if (composition) {\n                        return;\n                    }\n\n                    var keyCode = e.which;\n\n                    if (keyCode >= 37 && keyCode <= 40) {\n                        return;\n                    }\n\n                    // remove Chrome generated span tags\n                    if (keyCode === 8 || keyCode === 13 || keyCode === 46) {\n                        t.toggleSpan();\n                    }\n\n                    if ((e.ctrlKey || e.metaKey) && (keyCode === 89 || keyCode === 90)) {\n                        t.semanticCode(false, true);\n                        t.$c.trigger('tbwchange');\n                    } else if (!ctrl && keyCode !== 17) {\n                        var compositionEndIE = t.isIE ? e.type === 'compositionend' : true;\n                        t.semanticCode(false, compositionEndIE && keyCode === 13);\n                        t.$c.trigger('tbwchange');\n                    } else if (typeof e.which === 'undefined') {\n                        t.semanticCode(false, false, true);\n                    }\n\n                    setTimeout(function () {\n                        ctrl = false;\n                    }, 50);\n                })\n                .on('mouseup keydown keyup', function (e) {\n                    if ((!e.ctrlKey && !e.metaKey) || e.altKey) {\n                        setTimeout(function () { // \"hold on\" to the ctrl key for 50ms\n                            ctrl = false;\n                        }, 50);\n                    }\n                    clearTimeout(debounceButtonPaneStatus);\n                    debounceButtonPaneStatus = setTimeout(function () {\n                        t.updateButtonPaneStatus();\n                    }, 50);\n                })\n                .on('focus blur', function (e) {\n                    if (e.type === 'blur') {\n                        t.clearButtonPaneStatus();\n                    }\n                    t.$c.trigger('tbw' + e.type);\n                    if (t.o.autogrowOnEnter) {\n                        if (t.autogrowOnEnterDontClose) {\n                            return;\n                        }\n                        if (e.type === 'focus') {\n                            t.autogrowOnEnterWasFocused = true;\n                            t.autogrowEditorOnEnter();\n                        } else if (!t.o.autogrow) {\n                            t.$ed.css({height: t.$ed.css('min-height')});\n                            t.$c.trigger('tbwresize');\n                        }\n                    }\n                })\n                .on('keyup focus', function () {\n                  if (!t.$ta.val().match(/<.*>/) && !t.$ed.html().match(/<.*>/)) {\n                        setTimeout(function () {\n                            var block = t.isIE ? '<p>' : 'p';\n                            t.doc.execCommand('formatBlock', false, block);\n                            t.syncCode();\n                        }, 0);\n                    }\n                })\n                .on('cut drop', function () {\n                    setTimeout(function () {\n                        t.semanticCode(false, true);\n                        t.$c.trigger('tbwchange');\n                    }, 0);\n                })\n                .on('paste', function (e) {\n                    if (t.o.removeformatPasted) {\n                        e.preventDefault();\n\n                        if (window.getSelection && window.getSelection().deleteFromDocument) {\n                            window.getSelection().deleteFromDocument();\n                        }\n\n                        try {\n                            // IE\n                            var text = window.clipboardData.getData('Text');\n\n                            try {\n                                // <= IE10\n                                t.doc.selection.createRange().pasteHTML(text);\n                            } catch (c) {\n                                // IE 11\n                                t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(text));\n                            }\n                            t.$c.trigger('tbwchange', e);\n                        } catch (d) {\n                            // Not IE\n                            t.execCmd('insertText', (e.originalEvent || e).clipboardData.getData('text/plain'));\n                        }\n                    }\n\n                    // Call pasteHandlers\n                    $.each(t.pasteHandlers, function (i, pasteHandler) {\n                        pasteHandler(e);\n                    });\n\n                    setTimeout(function () {\n                        t.semanticCode(false, true);\n                        t.$c.trigger('tbwpaste', e);\n                        t.$c.trigger('tbwchange');\n                    }, 0);\n                });\n\n            t.$ta\n                .on('keyup', function () {\n                    t.$c.trigger('tbwchange');\n                })\n                .on('paste', function () {\n                    setTimeout(function () {\n                        t.$c.trigger('tbwchange');\n                    }, 0);\n                });\n\n            $(t.doc.body).on('keydown.' + t.eventNamespace, function (e) {\n                if (e.which === 27 && $('.' + prefix + 'modal-box').length >= 1) {\n                    t.closeModal();\n                    return false;\n                }\n            });\n        },\n\n        //autogrow when entering logic\n        autogrowEditorOnEnter: function () {\n            var t = this;\n            t.$ed.removeClass('autogrow-on-enter');\n            var oldHeight = t.$ed[0].clientHeight;\n            t.$ed.height('auto');\n            var totalHeight = t.$ed[0].scrollHeight;\n            t.$ed.addClass('autogrow-on-enter');\n            if (oldHeight !== totalHeight) {\n                t.$ed.height(oldHeight);\n                setTimeout(function () {\n                    t.$ed.css({height: totalHeight});\n                    t.$c.trigger('tbwresize');\n                }, 0);\n            }\n        },\n\n\n        // Build button pane, use o.btns option\n        buildBtnPane: function () {\n            var t = this,\n                prefix = t.o.prefix;\n\n            var $btnPane = t.$btnPane = $('<div/>', {\n                class: prefix + 'button-pane'\n            });\n\n            $.each(t.o.btns, function (i, btnGrp) {\n                if (!$.isArray(btnGrp)) {\n                    btnGrp = [btnGrp];\n                }\n\n                var $btnGroup = $('<div/>', {\n                    class: prefix + 'button-group ' + ((btnGrp.indexOf('fullscreen') >= 0) ? prefix + 'right' : '')\n                });\n                $.each(btnGrp, function (i, btn) {\n                    try { // Prevent buildBtn error\n                        if (t.isSupportedBtn(btn)) { // It's a supported button\n                            $btnGroup.append(t.buildBtn(btn));\n                        }\n                    } catch (c) {\n                    }\n                });\n\n                if ($btnGroup.html().trim().length > 0) {\n                    $btnPane.append($btnGroup);\n                }\n            });\n\n            t.$box.prepend($btnPane);\n        },\n\n\n        // Build a button and his action\n        buildBtn: function (btnName) { // btnName is name of the button\n            var t = this,\n                prefix = t.o.prefix,\n                btn = t.btnsDef[btnName],\n                isDropdown = btn.dropdown,\n                hasIcon = btn.hasIcon != null ? btn.hasIcon : true,\n                textDef = t.lang[btnName] || btnName,\n\n                $btn = $('<button/>', {\n                    type: 'button',\n                    class: prefix + btnName + '-button ' + (btn.class || '') + (!hasIcon ? ' ' + prefix + 'textual-button' : ''),\n                    html: t.hasSvg && hasIcon ?\n                        '<svg><use xlink:href=\"' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '\"/></svg>' :\n                        t.hideButtonTexts ? '' : (btn.text || btn.title || t.lang[btnName] || btnName),\n                    title: (btn.title || btn.text || textDef) + (btn.key ? ' (' + (t.isMac ? 'Cmd' : 'Ctrl') + ' + ' + btn.key + ')' : ''),\n                    tabindex: -1,\n                    mousedown: function () {\n                        if (!isDropdown || $('.' + btnName + '-' + prefix + 'dropdown', t.$box).is(':hidden')) {\n                            $('body', t.doc).trigger('mousedown');\n                        }\n\n                        if ((t.$btnPane.hasClass(prefix + 'disable') || t.$box.hasClass(prefix + 'disabled')) &&\n                            !$(this).hasClass(prefix + 'active') &&\n                            !$(this).hasClass(prefix + 'not-disable')) {\n                            return false;\n                        }\n\n                        t.execCmd((isDropdown ? 'dropdown' : false) || btn.fn || btnName, btn.param || btnName, btn.forceCss);\n\n                        return false;\n                    }\n                });\n\n            if (isDropdown) {\n                $btn.addClass(prefix + 'open-dropdown');\n                var dropdownPrefix = prefix + 'dropdown',\n                    dropdownOptions = { // the dropdown\n                        class: dropdownPrefix + '-' + btnName + ' ' + dropdownPrefix + ' ' + prefix + 'fixed-top ' + (btn.dropdownClass || '')\n                    };\n                dropdownOptions['data-' + dropdownPrefix] = btnName;\n                var $dropdown = $('<div/>', dropdownOptions);\n                $.each(isDropdown, function (i, def) {\n                    if (t.btnsDef[def] && t.isSupportedBtn(def)) {\n                        $dropdown.append(t.buildSubBtn(def));\n                    }\n                });\n                t.$box.append($dropdown.hide());\n            } else if (btn.key) {\n                t.keys[btn.key] = {\n                    fn: btn.fn || btnName,\n                    param: btn.param || btnName\n                };\n            }\n\n            if (!isDropdown) {\n                t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;\n            }\n\n            return $btn;\n        },\n        // Build a button for dropdown menu\n        // @param n : name of the subbutton\n        buildSubBtn: function (btnName) {\n            var t = this,\n                prefix = t.o.prefix,\n                btn = t.btnsDef[btnName],\n                hasIcon = btn.hasIcon != null ? btn.hasIcon : true;\n\n            if (btn.key) {\n                t.keys[btn.key] = {\n                    fn: btn.fn || btnName,\n                    param: btn.param || btnName\n                };\n            }\n\n            t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;\n\n            return $('<button/>', {\n                type: 'button',\n                class: prefix + btnName + '-dropdown-button ' + (btn.class || '') + (btn.ico ? ' ' + prefix + btn.ico + '-button' : ''),\n                html: t.hasSvg && hasIcon ?\n                    '<svg><use xlink:href=\"' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '\"/></svg>' + (btn.text || btn.title || t.lang[btnName] || btnName) :\n                    (btn.text || btn.title || t.lang[btnName] || btnName),\n                title: (btn.key ? '(' + (t.isMac ? 'Cmd' : 'Ctrl') + ' + ' + btn.key + ')' : null),\n                style: btn.style || null,\n                mousedown: function () {\n                    $('body', t.doc).trigger('mousedown');\n\n                    t.execCmd(btn.fn || btnName, btn.param || btnName, btn.forceCss);\n\n                    return false;\n                }\n            });\n        },\n        // Check if button is supported\n        isSupportedBtn: function (btnName) {\n            try {\n                return this.btnsDef[btnName].isSupported();\n            } catch (e) {\n            }\n            return true;\n        },\n\n        // Build overlay for modal box\n        buildOverlay: function () {\n            var t = this;\n            t.$overlay = $('<div/>', {\n                class: t.o.prefix + 'overlay'\n            }).appendTo(t.$box);\n            return t.$overlay;\n        },\n        showOverlay: function () {\n            var t = this;\n            $(window).trigger('scroll');\n            t.$overlay.fadeIn(200);\n            t.$box.addClass(t.o.prefix + 'box-blur');\n        },\n        hideOverlay: function () {\n            var t = this;\n            t.$overlay.fadeOut(50);\n            t.$box.removeClass(t.o.prefix + 'box-blur');\n        },\n\n        // Management of fixed button pane\n        fixedBtnPaneEvents: function () {\n            var t = this,\n                fixedFullWidth = t.o.fixedFullWidth,\n                $box = t.$box;\n\n            if (!t.o.fixedBtnPane) {\n                return;\n            }\n\n            t.isFixed = false;\n\n            $(window)\n                .on('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace, function () {\n                    if (!$box) {\n                        return;\n                    }\n\n                    t.syncCode();\n\n                    var scrollTop = $(window).scrollTop(),\n                        offset = $box.offset().top + 1,\n                        $buttonPane = t.$btnPane,\n                        buttonPaneOuterHeight = $buttonPane.outerHeight() - 2;\n\n                    if ((scrollTop - offset > 0) && ((scrollTop - offset - t.height) < 0)) {\n                        if (!t.isFixed) {\n                            t.isFixed = true;\n                            $buttonPane.css({\n                                position: 'fixed',\n                                top: 0,\n                                left: fixedFullWidth ? 0 : 'auto',\n                                zIndex: 7\n                            });\n                            t.$box.css({paddingTop: $buttonPane.height()});\n                        }\n                        $buttonPane.css({\n                            width: fixedFullWidth ? '100%' : (($box.width() - 1))\n                        });\n\n                        $('.' + t.o.prefix + 'fixed-top', $box).css({\n                            position: fixedFullWidth ? 'fixed' : 'absolute',\n                            top: fixedFullWidth ? buttonPaneOuterHeight : buttonPaneOuterHeight + (scrollTop - offset),\n                            zIndex: 15\n                        });\n                    } else if (t.isFixed) {\n                        t.isFixed = false;\n                        $buttonPane.removeAttr('style');\n                        t.$box.css({paddingTop: 0});\n                        $('.' + t.o.prefix + 'fixed-top', $box).css({\n                            position: 'absolute',\n                            top: buttonPaneOuterHeight\n                        });\n                    }\n                });\n        },\n\n        // Disable editor\n        setDisabled: function (disable) {\n            var t = this,\n                prefix = t.o.prefix;\n\n            t.disabled = disable;\n\n            if (disable) {\n                t.$ta.attr('disabled', true);\n            } else {\n                t.$ta.removeAttr('disabled');\n            }\n            t.$box.toggleClass(prefix + 'disabled', disable);\n            t.$ed.attr('contenteditable', !disable);\n        },\n\n        // Destroy the editor\n        destroy: function () {\n            var t = this,\n                prefix = t.o.prefix;\n\n            if (t.isTextarea) {\n                t.$box.after(\n                    t.$ta\n                        .css({height: ''})\n                        .val(t.html())\n                        .removeClass(prefix + 'textarea')\n                        .show()\n                );\n            } else {\n                t.$box.after(\n                    t.$ed\n                        .css({height: ''})\n                        .removeClass(prefix + 'editor')\n                        .removeAttr('contenteditable')\n                        .removeAttr('dir')\n                        .html(t.html())\n                        .show()\n                );\n            }\n\n            t.$ed.off('dblclick', 'img');\n\n            t.destroyPlugins();\n\n            t.$box.remove();\n            t.$c.removeData('trumbowyg');\n            $('body').removeClass(prefix + 'body-fullscreen');\n            t.$c.trigger('tbwclose');\n            $(window).off('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace);\n            $(t.doc.body).off('keydown.' + t.eventNamespace);\n        },\n\n\n        // Empty the editor\n        empty: function () {\n            this.$ta.val('');\n            this.syncCode(true);\n        },\n\n\n        // Function call when click on viewHTML button\n        toggle: function () {\n            var t = this,\n                prefix = t.o.prefix;\n\n            if (t.o.autogrowOnEnter) {\n                t.autogrowOnEnterDontClose = !t.$box.hasClass(prefix + 'editor-hidden');\n            }\n\n            t.semanticCode(false, true);\n            t.$c.trigger('tbwchange');\n\n            setTimeout(function () {\n                t.doc.activeElement.blur();\n                t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');\n                t.$btnPane.toggleClass(prefix + 'disable');\n                $('.' + prefix + 'viewHTML-button', t.$btnPane).toggleClass(prefix + 'active');\n                if (t.$box.hasClass(prefix + 'editor-visible')) {\n                    t.$ta.attr('tabindex', -1);\n                } else {\n                    t.$ta.removeAttr('tabindex');\n                }\n\n                if (t.o.autogrowOnEnter && !t.autogrowOnEnterDontClose) {\n                    t.autogrowEditorOnEnter();\n                }\n            }, 0);\n        },\n\n        // Remove or add flags to span tags to remove Chrome generated spans\n        toggleSpan: function (addFlag) {\n            var t = this;\n            t.$ed.find('span').each(function () {\n                if (addFlag === true) {\n                    $(this).attr('data-tbw-flag', true);\n                } else {\n                    if ($(this).attr('data-tbw-flag')) {\n                        $(this).removeAttr('data-tbw-flag');\n                    } else {\n                        $(this).contents().unwrap();\n                    }\n                }\n            });\n        },\n\n        // Open dropdown when click on a button which open that\n        dropdown: function (name) {\n            var t = this,\n                $body = $('body', t.doc),\n                prefix = t.o.prefix,\n                $dropdown = $('[data-' + prefix + 'dropdown=' + name + ']', t.$box),\n                $btn = $('.' + prefix + name + '-button', t.$btnPane),\n                show = $dropdown.is(':hidden');\n\n            $body.trigger('mousedown');\n\n            if (show) {\n                var btnOffsetLeft = $btn.offset().left;\n                $btn.addClass(prefix + 'active');\n\n                $dropdown.css({\n                    position: 'absolute',\n                    top: $btn.offset().top - t.$btnPane.offset().top + $btn.outerHeight(),\n                    left: (t.o.fixedFullWidth && t.isFixed) ? btnOffsetLeft : (btnOffsetLeft - t.$btnPane.offset().left)\n                }).show();\n\n                $(window).trigger('scroll');\n\n                $body.on('mousedown.' + t.eventNamespace, function (e) {\n                    if (!$dropdown.is(e.target)) {\n                        $('.' + prefix + 'dropdown', t.$box).hide();\n                        $('.' + prefix + 'active', t.$btnPane).removeClass(prefix + 'active');\n                        $body.off('mousedown.' + t.eventNamespace);\n                    }\n                });\n            }\n        },\n\n\n        // HTML Code management\n        html: function (html) {\n            var t = this;\n\n            if (html != null) {\n                t.$ta.val(html);\n                t.syncCode(true);\n                t.$c.trigger('tbwchange');\n                return t;\n            }\n\n            return t.$ta.val();\n        },\n        syncTextarea: function () {\n            var t = this;\n            t.$ta.val(t.$ed.text().trim().length > 0 || t.$ed.find(t.o.tagsToKeep.join(',')).length > 0 ? t.$ed.html() : '');\n        },\n        syncCode: function (force) {\n            var t = this;\n            if (!force && t.$ed.is(':visible')) {\n                t.syncTextarea();\n            } else {\n                // wrap the content in a div it's easier to get the inner html\n                var html = $('<div>').html(t.$ta.val());\n                // scrub the html before loading into the doc\n                var safe = $('<div>').append(html);\n                $(t.o.tagsToRemove.join(','), safe).remove();\n                t.$ed.html(safe.contents().html());\n            }\n\n            if (t.o.autogrow) {\n                t.height = t.$ed.height();\n                if (t.height !== t.$ta.css('height')) {\n                    t.$ta.css({height: t.height});\n                    t.$c.trigger('tbwresize');\n                }\n            }\n            if (t.o.autogrowOnEnter) {\n                t.$ed.height('auto');\n                var totalHeight = t.autogrowOnEnterWasFocused ? t.$ed[0].scrollHeight : t.$ed.css('min-height');\n                if (totalHeight !== t.$ta.css('height')) {\n                    t.$ed.css({height: totalHeight});\n                    t.$c.trigger('tbwresize');\n                }\n            }\n        },\n\n        // Analyse and update to semantic code\n        // @param force : force to sync code from textarea\n        // @param full  : wrap text nodes in <p>\n        // @param keepRange  : leave selection range as it is\n        semanticCode: function (force, full, keepRange) {\n            var t = this;\n            t.saveRange();\n            t.syncCode(force);\n\n            var restoreRange = true;\n            if (t.range && t.range.collapsed) {\n                restoreRange = false;\n            }\n\n            if (t.o.semantic) {\n                t.semanticTag('b', t.o.semanticKeepAttributes);\n                t.semanticTag('i', t.o.semanticKeepAttributes);\n                t.semanticTag('s', t.o.semanticKeepAttributes);\n                t.semanticTag('strike', t.o.semanticKeepAttributes);\n\n                if (full) {\n                    var inlineElementsSelector = t.o.inlineElementsSelector,\n                        blockElementsSelector = ':not(' + inlineElementsSelector + ')';\n\n                    // Wrap text nodes in span for easier processing\n                    t.$ed.contents().filter(function () {\n                        return this.nodeType === 3 && this.nodeValue.trim().length > 0;\n                    }).wrap('<span data-tbw/>');\n\n                    // Wrap groups of inline elements in paragraphs (recursive)\n                    var wrapInlinesInParagraphsFrom = function ($from) {\n                        if ($from.length !== 0) {\n                            var $finalParagraph = $from.nextUntil(blockElementsSelector).addBack().wrapAll('<p/>').parent(),\n                                $nextElement = $finalParagraph.nextAll(inlineElementsSelector).first();\n                            $finalParagraph.next('br').remove();\n                            wrapInlinesInParagraphsFrom($nextElement);\n                        }\n                    };\n                    wrapInlinesInParagraphsFrom(t.$ed.children(inlineElementsSelector).first());\n\n                    t.semanticTag('div', true);\n\n                    // Get rid of temporary span's\n                    $('[data-tbw]', t.$ed).contents().unwrap();\n\n                    // Remove empty <p>\n                    t.$ed.find('p:empty').remove();\n                }\n\n                if (!keepRange && restoreRange) {\n                    t.restoreRange();\n                }\n\n                t.syncTextarea();\n            }\n        },\n\n        semanticTag: function (oldTag, copyAttributes, revert) {\n            var newTag, t = this;\n            var tmpTag = oldTag;\n\n            if (this.o.semantic != null && typeof this.o.semantic === 'object' && this.o.semantic.hasOwnProperty(oldTag)) {\n                newTag = this.o.semantic[oldTag];\n            } else if (this.o.semantic === true && this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(oldTag)) {\n                newTag = this.DEFAULT_SEMANTIC_MAP[oldTag];\n            } else {\n                return;\n            }\n\n            if(revert) {\n                oldTag = newTag;\n                newTag = tmpTag;\n            }\n\n            $(oldTag, this.$ed).each(function () {\n                var resetRange = false;\n                var $oldTag = $(this);\n                if ($oldTag.contents().length === 0) {\n                    return false;\n                }\n\n                if (t.range && t.range.startContainer.parentNode === this) {\n                    resetRange = true;\n                }\n                var $newTag = $('<' + newTag + '/>');\n                $newTag.insertBefore($oldTag);\n                if (copyAttributes) {\n                    $.each($oldTag.prop('attributes'), function () {\n                        $newTag.attr(this.name, this.value);\n                    });\n                }\n                $newTag.html($oldTag.html());\n                $oldTag.remove();\n                if(resetRange === true) {\n                    t.range.selectNodeContents($newTag.get(0));\n                    t.range.collapse(false);\n                }\n            });\n        },\n\n        // Function call when user click on \"Insert Link\"\n        createLink: function () {\n            var t = this,\n                documentSelection = t.doc.getSelection(),\n                selectedRange = documentSelection.getRangeAt(0),\n                node = documentSelection.focusNode,\n                text = new XMLSerializer().serializeToString(selectedRange.cloneContents()) || selectedRange + '',\n                url,\n                title,\n                target,\n                linkDefaultTarget = t.o.linkTargets[0];\n\n            while (['A', 'DIV'].indexOf(node.nodeName) < 0) {\n                node = node.parentNode;\n            }\n\n            if (node && node.nodeName === 'A') {\n                var $a = $(node);\n                text = $a.text();\n                url = $a.attr('href');\n                if (!t.o.minimalLinks) {\n                    title = $a.attr('title');\n                    target = $a.attr('target') || linkDefaultTarget;\n                }\n                var range = t.doc.createRange();\n                range.selectNode(node);\n                documentSelection.removeAllRanges();\n                documentSelection.addRange(range);\n            }\n\n            t.saveRange();\n\n            var options = {\n                url: {\n                    label: t.lang.linkUrl || 'URL',\n                    required: true,\n                    value: url\n                },\n                text: {\n                    label: t.lang.text,\n                    value: text\n                }\n            };\n            if (!t.o.minimalLinks) {\n                var targetOptions = t.o.linkTargets.reduce(function (options, optionValue) {\n                    options[optionValue] = t.lang[optionValue];\n\n                    return options;\n                }, {});\n\n                $.extend(options, {\n                    title: {\n                        label: t.lang.title,\n                        value: title\n                    },\n                    target: {\n                        label: t.lang.target,\n                        value: target,\n                        options: targetOptions\n                    }\n                });\n            }\n\n            t.openModalInsert(t.lang.createLink, options, function (v) { // v is value\n                var url = t.prependUrlPrefix(v.url);\n                if (!url.length) {\n                    return false;\n                }\n\n                var link = $(['<a href=\"', url, '\">', v.text || v.url, '</a>'].join(''));\n\n                if (v.title) {\n                    link.attr('title', v.title);\n                }\n                if (v.target || linkDefaultTarget) {\n                    link.attr('target', v.target || linkDefaultTarget);\n                }\n                t.range.deleteContents();\n                t.range.insertNode(link[0]);\n                t.syncCode();\n                t.$c.trigger('tbwchange');\n                return true;\n            });\n        },\n        prependUrlPrefix: function (url) {\n            var t = this;\n            if (!t.urlPrefix) {\n                return url;\n            }\n\n            var VALID_LINK_PREFIX = /^([a-z][-+.a-z0-9]*:|\\/|#)/i;\n            if (VALID_LINK_PREFIX.test(url)) {\n                return url;\n            }\n\n            var SIMPLE_EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            if (SIMPLE_EMAIL_REGEX.test(url)) {\n                return 'mailto:' + url;\n            }\n\n            return t.urlPrefix + url;\n        },\n        unlink: function () {\n            var t = this,\n                documentSelection = t.doc.getSelection(),\n                node = documentSelection.focusNode;\n\n            if (documentSelection.isCollapsed) {\n                while (['A', 'DIV'].indexOf(node.nodeName) < 0) {\n                    node = node.parentNode;\n                }\n\n                if (node && node.nodeName === 'A') {\n                    var range = t.doc.createRange();\n                    range.selectNode(node);\n                    documentSelection.removeAllRanges();\n                    documentSelection.addRange(range);\n                }\n            }\n            t.execCmd('unlink', undefined, undefined, true);\n        },\n        insertImage: function () {\n            var t = this;\n            t.saveRange();\n\n            var options = {\n                url: {\n                    label: 'URL',\n                    required: true\n                },\n                alt: {\n                    label: t.lang.description,\n                    value: t.getRangeText()\n                }\n            };\n\n            if (t.o.imageWidthModalEdit) {\n                options.width = {};\n            }\n\n            t.openModalInsert(t.lang.insertImage, options, function (v) { // v are values\n                t.execCmd('insertImage', v.url, false, true);\n                var $img = $('img[src=\"' + v.url + '\"]:not([alt])', t.$box);\n                $img.attr('alt', v.alt);\n\n                if (t.o.imageWidthModalEdit) {\n                    $img.attr({\n                        width: v.width\n                    });\n                }\n\n                t.syncCode();\n                t.$c.trigger('tbwchange');\n\n                return true;\n            });\n        },\n        fullscreen: function () {\n            var t = this,\n                prefix = t.o.prefix,\n                fullscreenCssClass = prefix + 'fullscreen',\n                fullscreenPlaceholderClass = fullscreenCssClass + '-placeholder',\n                isFullscreen,\n                editorHeight = t.$box.outerHeight();\n\n            t.$box.toggleClass(fullscreenCssClass);\n            isFullscreen = t.$box.hasClass(fullscreenCssClass);\n\n            if (isFullscreen) {\n                t.$box.before(\n                    $('<div/>', {\n                        class: fullscreenPlaceholderClass\n                    }).css({\n                        height: editorHeight\n                    })\n                );\n            } else {\n                $('.' + fullscreenPlaceholderClass).remove();\n            }\n\n            $('body').toggleClass(prefix + 'body-fullscreen', isFullscreen);\n            $(window).trigger('scroll');\n            t.$c.trigger('tbw' + (isFullscreen ? 'open' : 'close') + 'fullscreen');\n        },\n\n\n        /*\n         * Call method of trumbowyg if exist\n         * else try to call anonymous function\n         * and finally native execCommand\n         */\n        execCmd: function (cmd, param, forceCss, skipTrumbowyg) {\n            var t = this;\n            skipTrumbowyg = !!skipTrumbowyg || '';\n\n            if (cmd !== 'dropdown') {\n                t.$ed.focus();\n            }\n\n            if(cmd === 'strikethrough' && t.o.semantic) {\n                t.semanticTag('strike', t.o.semanticKeepAttributes, true); // browsers cannot undo e.g. <del> as they expect <strike>\n            }\n\n            try {\n                t.doc.execCommand('styleWithCSS', false, forceCss || false);\n            } catch (c) {\n            }\n\n            try {\n                t[cmd + skipTrumbowyg](param);\n            } catch (c) {\n                try {\n                    cmd(param);\n                } catch (e2) {\n                    if (cmd === 'insertHorizontalRule') {\n                        param = undefined;\n                    } else if (cmd === 'formatBlock' && t.isIE) {\n                        param = '<' + param + '>';\n                    }\n\n                    t.doc.execCommand(cmd, false, param);\n\n                    t.syncCode();\n                    t.semanticCode(false, true);\n                    try {\n                        var listId = window.getSelection().focusNode;\n                        if(!$(window.getSelection().focusNode.parentNode).hasClass('trumbowyg-editor')){\n                            listId = window.getSelection().focusNode.parentNode;\n                        }\n                        var classes = t.o.tagClasses[param];\n                        if (classes) {\n                            $(listId).addClass(classes);\n                        }\n                    } catch (e) {\n\n                    }\n\n                }\n\n                if (cmd !== 'dropdown') {\n                    t.updateButtonPaneStatus();\n                    t.$c.trigger('tbwchange');\n                }\n            }\n        },\n\n\n        // Open a modal box\n        openModal: function (title, content, buildForm) {\n            var t = this,\n                prefix = t.o.prefix;\n\n            buildForm = buildForm !== false;\n\n            // No open a modal box when exist other modal box\n            if ($('.' + prefix + 'modal-box', t.$box).length > 0) {\n                return false;\n            }\n            if (t.o.autogrowOnEnter) {\n                t.autogrowOnEnterDontClose = true;\n            }\n\n            t.saveRange();\n            t.showOverlay();\n\n            // Disable all btnPane btns\n            t.$btnPane.addClass(prefix + 'disable');\n\n            // Build out of ModalBox, it's the mask for animations\n            var $modal = $('<div/>', {\n                class: prefix + 'modal ' + prefix + 'fixed-top'\n            }).css({\n                top: t.$box.offset().top + t.$btnPane.height(),\n                zIndex: 99999\n            }).appendTo($(t.doc.body));\n\n            var darkClass = prefix + 'dark';\n            if (t.$c.parents('.' + darkClass).length !== 0) {\n                $modal.addClass(darkClass);\n            }\n\n            // Click on overlay close modal by cancelling them\n            t.$overlay.one('click', function () {\n                $modal.trigger(CANCEL_EVENT);\n                return false;\n            });\n\n            // Build the form\n            var formOrContent;\n            if (buildForm) {\n                formOrContent = $('<form/>', {\n                    action: '',\n                    html: content\n                })\n                    .on('submit', function () {\n                        $modal.trigger(CONFIRM_EVENT);\n                        return false;\n                    })\n                    .on('reset', function () {\n                        $modal.trigger(CANCEL_EVENT);\n                        return false;\n                    })\n                    .on('submit reset', function () {\n                        if (t.o.autogrowOnEnter) {\n                            t.autogrowOnEnterDontClose = false;\n                        }\n                    });\n            } else {\n                formOrContent = content;\n            }\n\n\n            // Build ModalBox and animate to show them\n            var $box = $('<div/>', {\n                class: prefix + 'modal-box',\n                html: formOrContent\n            })\n                .css({\n                    top: '-' + t.$btnPane.outerHeight(),\n                    opacity: 0,\n                    paddingBottom: buildForm ? null : '5%',\n                })\n                .appendTo($modal)\n                .animate({\n                    top: 0,\n                    opacity: 1\n                }, 100);\n\n\n            // Append title\n            if (title) {\n                $('<span/>', {\n                    text: title,\n                    class: prefix + 'modal-title'\n                }).prependTo($box);\n            }\n\n            if (buildForm) {\n                // Focus in modal box\n                $(':input:first', $box).focus();\n\n                // Append Confirm and Cancel buttons\n                t.buildModalBtn('submit', $box);\n                t.buildModalBtn('reset', $box);\n\n                $modal.height($box.outerHeight() + 10);\n            }\n\n            $(window).trigger('scroll');\n            t.$c.trigger('tbwmodalopen');\n\n            return $modal;\n        },\n        // @param n is name of modal\n        buildModalBtn: function (n, $modal) {\n            var t = this,\n                prefix = t.o.prefix;\n\n            return $('<button/>', {\n                class: prefix + 'modal-button ' + prefix + 'modal-' + n,\n                type: n,\n                text: t.lang[n] || n\n            }).appendTo($('form', $modal));\n        },\n        // close current modal box\n        closeModal: function () {\n            var t = this,\n                prefix = t.o.prefix;\n\n            t.$btnPane.removeClass(prefix + 'disable');\n            t.$overlay.off();\n\n            // Find the modal box\n            var $modalBox = $('.' + prefix + 'modal-box', $(t.doc.body));\n\n            $modalBox.animate({\n                top: '-' + $modalBox.height()\n            }, 100, function () {\n                $modalBox.parent().remove();\n                t.hideOverlay();\n                t.$c.trigger('tbwmodalclose');\n            });\n\n            t.restoreRange();\n        },\n        // Pre-formatted build and management modal\n        openModalInsert: function (title, fields, cmd) {\n            var t = this,\n                prefix = t.o.prefix,\n                lg = t.lang,\n                html = '',\n                idPrefix = prefix + 'form-' + Date.now() + '-';\n\n            $.each(fields, function (fieldName, field) {\n                var l = field.label || fieldName,\n                    n = field.name || fieldName,\n                    a = field.attributes || {},\n                    fieldId = idPrefix + fieldName;\n\n                var attr = Object.keys(a).map(function (prop) {\n                    return prop + '=\"' + a[prop] + '\"';\n                }).join(' ');\n\n                if (typeof field.type === 'function') {\n                  if (!field.name) {\n                    field.name = n;\n                  }\n\n                  html += field.type(field, fieldId, prefix, lg);\n\n                  return;\n                }\n\n                html += '<div class=\"' + prefix + 'input-row\">';\n                html += '<div class=\"' + prefix + 'input-infos\"><label for=\"' + fieldId + '\"><span>' + (lg[l] ? lg[l] : l) + '</span></label></div>';\n                html += '<div class=\"' + prefix + 'input-html\">';\n\n                if ($.isPlainObject(field.options)) {\n                    html += '<select name=\"target\">';\n                    html += Object.keys(field.options).map((optionValue) => {\n                        return '<option value=\"' + optionValue + '\" ' + (optionValue === field.value ? 'selected' : '') + '>' + field.options[optionValue] + '</option>';\n                    }).join('');\n                    html += '</select>';\n                } else {\n                    html += '<input id=\"' + fieldId + '\" type=\"' + (field.type || 'text') + '\" name=\"' + n + '\" ' + attr;\n                    html += (field.type === 'checkbox' && field.value ? ' checked=\"checked\"' : '') + ' value=\"' + (field.value || '').replace(/\"/g, '&quot;') + '\">';\n                }\n\n                html += '</div></div>';\n            });\n\n            return t.openModal(title, html)\n                .on(CONFIRM_EVENT, function () {\n                    var $form = $('form', $(this)),\n                        valid = true,\n                        values = {};\n\n                    $.each(fields, function (fieldName, field) {\n                        var n = field.name || fieldName;\n\n                        var $field = $(':input[name=\"' + n + '\"]', $form),\n                            inputType = $field[0].type;\n\n                        switch (inputType.toLowerCase()) {\n                            case 'checkbox':\n                                values[n] = $field.is(':checked');\n                                break;\n                            case 'radio':\n                                values[n] = $field.filter(':checked').val();\n                                break;\n                            default:\n                                values[n] = $.trim($field.val());\n                                break;\n                        }\n                        // Validate value\n                        if (field.required && values[n] === '') {\n                            valid = false;\n                            t.addErrorOnModalField($field, t.lang.required);\n                        } else if (field.pattern && !field.pattern.test(values[n])) {\n                            valid = false;\n                            t.addErrorOnModalField($field, field.patternError);\n                        }\n                    });\n\n                    if (valid) {\n                        t.restoreRange();\n\n                        if (cmd(values, fields)) {\n                            t.syncCode();\n                            t.$c.trigger('tbwchange');\n                            t.closeModal();\n                            $(this).off(CONFIRM_EVENT);\n                        }\n                    }\n                })\n                .one(CANCEL_EVENT, function () {\n                    $(this).off(CONFIRM_EVENT);\n                    t.closeModal();\n                });\n        },\n        addErrorOnModalField: function ($field, err) {\n            var prefix = this.o.prefix,\n                spanErrorClass = prefix + 'msg-error',\n                $row = $field.closest('.' + prefix + 'input-row');\n\n            $field\n                .on('change keyup', function () {\n                    $row.removeClass(prefix + 'input-error');\n                    setTimeout(function () {\n                        $row.find('.' + spanErrorClass).remove();\n                    }, 150);\n                });\n\n            $row\n                .addClass(prefix + 'input-error')\n                .find('.' + prefix + 'input-infos label')\n                .append(\n                    $('<span/>', {\n                        class: spanErrorClass,\n                        text: err\n                    })\n                );\n        },\n\n        getDefaultImgDblClickHandler: function () {\n            var t = this;\n\n            return function () {\n                var $img = $(this),\n                    src = $img.attr('src'),\n                    base64 = '(Base64)';\n\n                if (src.indexOf('data:image') === 0) {\n                    src = base64;\n                }\n\n                var options = {\n                    url: {\n                        label: 'URL',\n                        value: src,\n                        required: true\n                    },\n                    alt: {\n                        label: t.lang.description,\n                        value: $img.attr('alt')\n                    }\n                };\n\n                if (t.o.imageWidthModalEdit) {\n                    options.width = {\n                        value: $img.attr('width') ? $img.attr('width') : ''\n                    };\n                }\n\n                t.openModalInsert(t.lang.insertImage, options, function (v) {\n                    if (v.url !== base64) {\n                        $img.attr({\n                            src: v.url\n                        });\n                    }\n                    $img.attr({\n                        alt: v.alt\n                    });\n\n                    if (t.o.imageWidthModalEdit) {\n                        if (parseInt(v.width) > 0) {\n                            $img.attr({\n                                width: v.width\n                            });\n                        } else {\n                            $img.removeAttr('width');\n                        }\n                    }\n\n                    return true;\n                });\n                return false;\n            };\n        },\n\n        // Range management\n        saveRange: function () {\n            var t = this,\n                documentSelection = t.doc.getSelection();\n\n            t.range = null;\n\n            if (!documentSelection || !documentSelection.rangeCount) {\n                return;\n            }\n\n            var savedRange = t.range = documentSelection.getRangeAt(0),\n                range = t.doc.createRange(),\n                rangeStart;\n            range.selectNodeContents(t.$ed[0]);\n            range.setEnd(savedRange.startContainer, savedRange.startOffset);\n            rangeStart = (range + '').length;\n            t.metaRange = {\n                start: rangeStart,\n                end: rangeStart + (savedRange + '').length\n            };\n        },\n        restoreRange: function () {\n            var t = this,\n                metaRange = t.metaRange,\n                savedRange = t.range,\n                documentSelection = t.doc.getSelection(),\n                range;\n\n            if (!savedRange) {\n                return;\n            }\n\n            if (metaRange && metaRange.start !== metaRange.end) { // Algorithm from http://jsfiddle.net/WeWy7/3/\n                var charIndex = 0,\n                    nodeStack = [t.$ed[0]],\n                    node,\n                    foundStart = false,\n                    stop = false;\n\n                range = t.doc.createRange();\n\n                while (!stop && (node = nodeStack.pop())) {\n                    if (node.nodeType === 3) {\n                        var nextCharIndex = charIndex + node.length;\n                        if (!foundStart && metaRange.start >= charIndex && metaRange.start <= nextCharIndex) {\n                            range.setStart(node, metaRange.start - charIndex);\n                            foundStart = true;\n                        }\n                        if (foundStart && metaRange.end >= charIndex && metaRange.end <= nextCharIndex) {\n                            range.setEnd(node, metaRange.end - charIndex);\n                            stop = true;\n                        }\n                        charIndex = nextCharIndex;\n                    } else {\n                        var cn = node.childNodes,\n                            i = cn.length;\n\n                        while (i > 0) {\n                            i -= 1;\n                            nodeStack.push(cn[i]);\n                        }\n                    }\n                }\n            }\n\n            // Fix IE11 Error 'Could not complete the operation due to error 800a025e'.\n            // https://stackoverflow.com/questions/16160996/could-not-complete-the-operation-due-to-error-800a025e\n            try {\n                documentSelection.removeAllRanges();\n            } catch (e) {\n            }\n\n            documentSelection.addRange(range || savedRange);\n        },\n        getRangeText: function () {\n            return this.range + '';\n        },\n\n        clearButtonPaneStatus: function () {\n            var t = this,\n                prefix = t.o.prefix,\n                activeClasses = prefix + 'active-button ' + prefix + 'active',\n                originalIconClass = prefix + 'original-icon';\n\n            // Reset all buttons and dropdown state\n            $('.' + prefix + 'active-button', t.$btnPane).removeClass(activeClasses);\n            $('.' + originalIconClass, t.$btnPane).each(function () {\n                $(this).find('svg use').attr('xlink:href', $(this).data(originalIconClass));\n            });\n        },\n        updateButtonPaneStatus: function () {\n            var t = this,\n                prefix = t.o.prefix,\n                activeClasses = prefix + 'active-button ' + prefix + 'active',\n                originalIconClass = prefix + 'original-icon',\n                tags = t.getTagsRecursive(t.doc.getSelection().focusNode);\n\n            t.clearButtonPaneStatus();\n\n            $.each(tags, function (i, tag) {\n                var btnName = t.tagToButton[tag.toLowerCase()],\n                    $btn = $('.' + prefix + btnName + '-button', t.$btnPane);\n\n                if ($btn.length > 0) {\n                    $btn.addClass(activeClasses);\n                } else {\n                    try {\n                        $btn = $('.' + prefix + 'dropdown .' + prefix + btnName + '-dropdown-button', t.$box);\n                        var $btnSvgUse = $btn.find('svg use'),\n                            dropdownBtnName = $btn.parent().data(prefix + 'dropdown'),\n                            $dropdownBtn = $('.' + prefix + dropdownBtnName + '-button', t.$box),\n                            $dropdownBtnSvgUse = $dropdownBtn.find('svg use');\n\n                        // Highlight the dropdown button\n                        $dropdownBtn.addClass(activeClasses);\n\n                        // Switch dropdown icon to the active sub-icon one\n                        if (t.o.changeActiveDropdownIcon && $btnSvgUse.length > 0) {\n                            // Save original icon\n                            $dropdownBtn\n                                .addClass(originalIconClass)\n                                .data(originalIconClass, $dropdownBtnSvgUse.attr('xlink:href'));\n\n                            // Put the active sub-button's icon\n                            $dropdownBtnSvgUse\n                                .attr('xlink:href', $btnSvgUse.attr('xlink:href'));\n                        }\n                    } catch (e) {\n                    }\n                }\n            });\n        },\n        getTagsRecursive: function (element, tags) {\n            var t = this;\n            tags = tags || (element && element.tagName ? [element.tagName] : []);\n\n            if (element && element.parentNode) {\n                element = element.parentNode;\n            } else {\n                return tags;\n            }\n\n            var tag = element.tagName;\n            if (tag === 'DIV') {\n                return tags;\n            }\n            if (tag === 'P' && element.style.textAlign !== '') {\n                tags.push(element.style.textAlign);\n            }\n\n            $.each(t.tagHandlers, function (i, tagHandler) {\n                tags = tags.concat(tagHandler(element, t));\n            });\n\n            tags.push(tag);\n\n            return t.getTagsRecursive(element, tags).filter(function (tag) {\n                return tag != null;\n            });\n        },\n\n        // Plugins\n        initPlugins: function () {\n            var t = this;\n            t.loadedPlugins = [];\n            $.each($.trumbowyg.plugins, function (name, plugin) {\n                if (!plugin.shouldInit || plugin.shouldInit(t)) {\n                    plugin.init(t);\n                    if (plugin.tagHandler) {\n                        t.tagHandlers.push(plugin.tagHandler);\n                    }\n                    t.loadedPlugins.push(plugin);\n                }\n            });\n        },\n        destroyPlugins: function () {\n            var t = this;\n            $.each(this.loadedPlugins, function (i, plugin) {\n                if (plugin.destroy) {\n                    plugin.destroy(t);\n                }\n            });\n        }\n    };\n})(navigator, window, document, jQuery);\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\nimport { uuid, save_data, get_aspect_ratio_dimentions, init_img_basemaps } from \"../helpers.js\";\nimport { avatar_popup, polyline_popup, polygon_popup } from \"../generate.js\";\nimport { bind_setup } from \"./layers.js\";\n\n\nL.Map.addInitHook(function() {\n\n\t// Init map aspect ratio\n\n\tthis.setAspectRatio();\n\n\n\n\t// Plugins\n\n\t/*this.addControl( new L.Control.Fullscreen({ position: \"topright\" }) );*/\n\n\t/*this.addControl( L.control.zoom({ position: \"bottomright\" }) );*/\n\n\tthis.returnButton = L.Control.zoomHome({\n\t\tposition: \"bottomright\",\n\t\tzoomHomeIcon: \"home\",\n\t\tzoomHomeTitle: \"Return to map-extent\"\n\t});\n\tthis.addControl( this.returnButton );\n\n\tthis.basemapButton = L.easyButton({\n\t\tid: \"changeBasemap\",\n\t\tposition: \"bottomright\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { $(\"#basemapModal\").modal(\"show\"); init_img_basemaps(); },\n\t\t\t\ttitle: \"Change basemap\",\n\t\t\t\ticon: \"fa-layer-group\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.basemapButton );\n\tthis.basemapButton.disable();\n\n\tthis.textboxButton = L.easyButton({\n\t\tid: \"addTextbox\",\n\t\tposition: \"topleft\",\n\t\tleafletClasses: true,\n\t\tstates: [\n\t\t\t{\n\t\t\t\tstateName: \"main\",\n\t\t\t\tonClick: function(button, map) { _TEXTBOXES.add(); },\n\t\t\t\ttitle: \"Add book\",\n\t\t\t\ticon: \"fa-comment-alt\"\n\t\t\t}\n\t\t]\n\t});\n\tthis.addControl( this.textboxButton );\n\tthis.textboxButton.disable();\n\n\t/*this.addControl( L.control.locate({ position: \"topright\" }) );*/\n\n\n\n\n\n\t// Basemap\n\n\tthis.basemap = _BASEMAPS[10].tiles;\n\tthis.addLayer( this.basemap );\n\n\t// WMS\n\n\tthis.wms = {};\n\n\n\n\n\n\t// Draw and edit control\n\n\t//L.PM.setOptIn(true);\n\tthis.pm.addControls({\n\t\tposition: \"topright\",\n\t\tdrawCircleMarker: false,\n\t\tdrawText: false,\n\t\toneBlock: true\n\t});\n\tthis.pm.setPathOptions({\n\t\tweight: 3,\n\t\tcolor: \"#563d7c\",\n\t\topacity: 1,\n\t\tfillColor: \"#563d7c\",\n\t\tfillOpacity: 0.2\n\t});\n\tthis.pm.setGlobalOptions({\n\t\tmarkerStyle: {\n\t\t\ticon: L.icon({ iconUrl: \"assets/user-circle-solid.svg\", iconSize: [30, 30], popupAnchor: [0, -15], tooltipAnchor: [0, 15] })\n\t\t}\n\t});\n\tthis.pm.setLang(\"customLang\", {\n\t\ttooltips: { placeMarker: \"Click to place avatar\" },\n\t\tbuttonTitles: { drawMarkerButton: \"Draw avatar\" }\n\t}, \"en\");\n\tthis.disableDraw();\n\n\n\n\n\n\t// Object layers\n\n\tthis.objects = [];\n\tthis.fadeLayer = L.fadeLayer({ pmIgnore: true });\n\tthis.addLayer( this.fadeLayer );\n\n\tthis.on(\"pm:create\", ev => {\n\t\tlet o = ev.layer, type = ev.shape;\n\n\t\tif(type == \"Marker\") {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet p = this.project(o.getLatLng(), zoom),\n\t\t\t\turl = o.getIcon().options.iconUrl,\n\t\t\t\tsize = o.getIcon().options.iconSize;\n\t\t\tthis.removeLayer(o);\n\t\t\to = L.imageOverlay(url, [\n\t\t\t\tthis.unproject([ p.x - size[0] / 2, p.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ p.x + size[0] / 2, p.y + size[1] / 2 ], zoom)\n\t\t\t], {\n\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\tratio:\t\t\t\t\t496 / 512, // NOTE: this is hard-coded from the pixel-width of 'user-circle-solid.svg'\n\t\t\t\trounded:\t\t\t\tfalse,\n\t\t\t\tangle:\t\t\t\t\t0,\n\t\t\t\tborderColor:\t\t\t\"#563d7c\",\n\t\t\t\tborderThickness:\t\t0,\n\t\t\t\toverlayBlur:\t\t\t0,\n\t\t\t\toverlayGrayscale:\t\t0,\n\t\t\t\toverlayBrightness:\t\t0,\n\t\t\t\toverlayTransparency:\t0\n\t\t\t});\n\t\t\tthis.addLayer(o);\n\t\t}\n\n\t\to.options.id = uuid();\n\t\to.options.sceneId = _SCENES.active;\n\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\n\t\tthis.objects.push( this.extractObject(o) );\n\t});\n\n\tthis.on(\"_addedlayer\", async ev => {\n\t\tlet o = ev.layer;\n\n\t\tlet label = o.options.label;\n\t\tif(label) {\n\t\t\to.bindTooltip(label, { direction: \"center\", permanent: true });\n\t\t\tif(o instanceof L.ImageOverlay) { this.updateTooltip(o); }\n\t\t}\n\n\t\to.on(\"moveend\", ev => { this.updateTooltip(ev.target); });\n\t\to.on(\"pm:edit\", ev => {\n\t\t\tlet o = ev.layer;\n\t\t\tthis.updateObject(o);\n\t\t\tif(o.options.label) { o.closeTooltip(); o.openTooltip(); }\n\t\t});\n\n\t\to.on(\"pm:remove\", ev => {\n\t\t\tlet o = ev.layer;\n\n\t\t\tthis.deleteObject(o);\n\n\t\t\to.closeTooltip(); o.unbindTooltip();\n\t\t\to.closePopup(); o.unbindPopup();\n\t\t\to.off(\"popupopen\"); o.off(\"mouseover\"); o.off(\"mouseout\");\n\n\t\t\to.slideCancel();\n\t\t});\n\n\t\tthis.setPopup(o);\n\n\t\to.on(\"pm:dragstart\", ev => { o.unbindPopup(); });\n\t\to.on(\"pm:dragend\", ev => { this.setPopup( ev.layer ); });\n\n\t\to.on(\"popupopen\", ev => { bind_setup(o); });\n\t\to.on(\"mouseover\", ev => { this.highlightObject(o.options.id); });\n\t\to.on(\"mouseout\", ev => { this.unhighlightObject(o.options.id); });\n\n\t\tlet contextmenu = [\n\t\t\t{ text: \"Move to front\", callback: ev => { o.bringToFront(); }, index: 0 },\n\t\t\t{ text: \"Move to back\", callback: ev => { o.bringToBack(); }, index: 1 }\n\t\t];\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tcontextmenu.push( { text: \"Clone avatar\", callback: ev => { this.cloneAvatar(o.options.id, o.options.sceneId); }, index: 2 } );\n\t\t\tthis.setIcon(o);\n\t\t}\n\n\t\to.bindContextMenu({ contextmenu: true, contextmenuItems: contextmenu });\n\t});\n\n\tthis.on(\"layeradd\", ev => {\n\t\tlet o = ev.layer;\n\t\t//let opacity = o.options.opacity;\n\n\t\t/* TODO: fade in layer when added\n\t\t\tAlternatively this can be implemented in each prototypes\n\t\t\tonAdd method (in layers.js), instead of here.\n\t\t*/\n\t});\n\n\tthis.on(\"zoomend\", ev => {\n\t\tfor(let o of this.getLayers()) { this.updateTooltip(o); }\n\t});\n\tthis.on(\"zoom\", ev => { if(this._renderer) { this._renderer._reset(); } });\n\n\n\tthis.on(\"movestart\", ev => { /**/ });\n\tthis.on(\"moveend\", ev => { /**/ });\n\n});\n\n\n\n\n\nL.Map.include({\n\n\tsetup: function() {\n\t\tthis.setAspectRatio();\n\n\t\tthis.enableDraw();\n\t\tthis.basemapButton.enable();\n\t\tthis.textboxButton.enable();\n\n\t\t$(\".leaflet-control-attribution>span\").before(\"<span aria-hidden=\\\"true\\\">|</span> <a href=\\\"https://geotales.io\\\">GeoTales</a> \");\n\t\t$(\".leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t},\n\treset: function() {\n\t\tthis.clearLayers();\n\t\tthis.fadeLayer.clearLayers();\n\n\t\tthis.disableDraw();\n\t\tthis.basemapButton.disable();\n\t\tthis.textboxButton.disable();\n\t},\n\n\tenableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", false);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", false);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", false);\n\t},\n\tdisableDraw: function() {\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Marker\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Line\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Polygon\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rectangle\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Circle\", true);\n\t\t//this.pm.Toolbar.setButtonDisabled(\"Text\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Edit\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Drag\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Cut\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Removal\", true);\n\t\tthis.pm.Toolbar.setButtonDisabled(\"Rotate\", true);\n\t},\n\n\tsetOrientation: function(pos) {\n\t\tswitch(pos) {\n\t\t\tcase \"left\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topleft\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topleft\");\n\t\t\t\tthis.textboxButton.setPosition(\"topright\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"right\":\n\t\t\t\tthis.returnButton.setPosition(\"bottomright\");\n\t\t\t\tthis.basemapButton.setPosition(\"bottomright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"draw\", \"topright\");\n\t\t\t\tthis.pm.Toolbar.setBlockPosition(\"edit\", \"topright\");\n\t\t\t\tthis.textboxButton.setPosition(\"topleft\");\n\t\t\t\tbreak;\n\n\t\t\tdefault: break;\n\t\t}\n\t},\n\n\tsetHomeBounds: function(bounds) {\n\t\tif(this.returnButton) {\n\t\t\tthis.returnButton.setHomeBounds(bounds, { maxZoom: this.getMaxZoom() });\n\t\t}\n\t},\n\n\tsetAspectRatio: function(ratio) {\n\t\tif(ratio) { _OPTIONS.aspectratio = ratio; }\n\t\tlet w = $(\"#mapRow\").outerWidth(),\n\t\t\th = $(\"#mapRow\").outerHeight(),\n\t\t\tr = _OPTIONS.aspectratio;\n\n\t\tlet dim = get_aspect_ratio_dimentions(w, h, r);\n\t\t$(\"#map\").css({\n\t\t\twidth: `${(dim[0]/w) * 100}%`,\n\t\t\theight: `calc(${(dim[1]/h) * 100}% - 39px - 49px)`,\n\t\t\tleft: `${(((w - dim[0]) / 2) / w) * 100}%`,\n\t\t\ttop: `calc(${(((h - dim[1]) / 2)/ h) * 100}% + 39px + 49px)`\n\t\t});\n\n\t\tthis.invalidateSize();\n\t\tif(_SCENES.active) { this.setFlyTo( _SCENES.get( _SCENES.active ).bounds ); }\n\t},\n\n\tsetFlyTo: function(bounds) {\n\t\tthis.flyToBounds(bounds, { maxZoom: this.getMaxZoom(), noMoveStart: true, duration: _OPTIONS.panningspeed || null });\n\t\tthis.setHomeBounds(bounds);\n\t},\n\n\n\n\tclearLayers: function() {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tthis.removeLayer(o);\n\t\t}\n\t},\n\n\tgetLayers: function() {\n\t\treturn this.pm.getGeomanLayers();\n\t},\n\n\taddScene: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tif(!prev || !_OPTIONS.objectOptIn) { return; }\n\t\tlet prevId = prev.id;\n\n\t\tfor(let object of this.objects) {\n\t\t\tif(object.sceneId == prevId) {\n\t\t\t\tlet o = Object.assign({}, object);\n\t\t\t\to.sceneId = sceneId;\n\t\t\t\tthis.objects.push(o);\n\t\t\t}\n\t\t}\n\n\t\t_SCENES.store[ _SCENES.get(sceneId).index ].setWMS();\n\t},\n\tdeleteScene: function(sceneId) {\n\t\tthis.objects = this.objects.filter(o => o.sceneId != sceneId);\n\t},\n\n\thighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.8 ); }\n\t\telse{ o.setStyle({ opacity: 0.8 }); }\n\t},\n\tunhighlightObject: function(id) {\n\t\tlet o = this.fadeLayer.getObject(id);\n\t\tif(!o) { return; }\n\n\t\tif(o instanceof L.ImageOverlay) { o.setOpacity( 0.3 ); }\n\t\telse{ o.setStyle({ opacity: 0.3 }); }\n\t},\n\n\tsetObjects: function(sceneId) {\n\t\tlet prev = _SCENES.getPrevScene(sceneId);\n\t\tlet prevId = prev ? prev.id : null;\n\n\t\tthis.fadeLayer.clearLayers();\n\t\tif(prevId) {\n\t\t\tfor(let o of this.objects) {\n\t\t\t\tif(o.sceneId == prevId) { this.fadeLayer.addLayer(this.createObject(o), o.id); }\n\t\t\t}\n\t\t}\n\n\t\tlet os = this.getLayers().map(o => {\n\t\t\tlet r = this.extractObject(o); return { id: r.id, pos: r.pos, radius: r.radius, animationspeed: r.animationspeed };\n\t\t});\n\t\tthis.clearLayers();\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet o = Object.assign({}, this.objects[i]);\n\t\t\tif(o.sceneId == sceneId) {\n\t\t\t\tlet pos = o.pos, rad = o.radius;\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\to.pos = oo.pos;\n\t\t\t\t\t\tif(o.type == \"circle\") { o.radius = oo.radius; }\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet object = this.createObject(o);\n\t\t\t\tthis.addLayer( object );\n\t\t\t\tthis.fire(\"_addedlayer\", { layer: object });\n\n\t\t\t\tfor(let oo of os) {\n\t\t\t\t\tif(o.id == oo.id) {\n\t\t\t\t\t\tobject.slideTo( pos , { radius: rad, duration: oo.animationspeed || _OPTIONS.animationspeed });\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tset: function(sceneId) {\n\t\tlet s = _SCENES.get(sceneId);\n\t\tthis.setBasemap(s.basemap);\n\t\tthis.setWMS(s.wms);\n\t\tthis.setObjects(sceneId);\n\t\tthis.setFlyTo(s.bounds);\n\t},\n\n\tinsertObject: function(o) {\n\t\tfor(let oo of this.getLayers()) {\n\t\t\tif(oo.options.id == o.options.id) { return; }\n\t\t}\n\n\t\tlet object;\n\t\tfor(let oo of this.objects) {\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tobject = Object.assign({}, oo);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tobject.sceneId = _SCENES.active;\n\n\t\tlet oo = this.createObject(object);\n\t\tthis.addLayer( oo );\n\t\tthis.fire(\"_addedlayer\", { layer: oo });\n\t\tthis.objects.push(object);\n\t},\n\tcloneAvatar: function(id, sceneId) {\n\t\tlet object;\n\t\tfor(let o of this.objects) {\n\t\t\tif(o.id == id && o.sceneId == sceneId) {\n\t\t\t\tobject = Object.assign({}, o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tobject.id = uuid();\n\n\t\tlet zoom = this.getZoom();\n\t\tlet nw = this.project(object.pos[0], zoom),\n\t\t\tse = this.project(object.pos[1], zoom);\n\t\tnw.x += 50; nw.y += 50;\n\t\tse.x += 50; se.y += 50;\n\t\tnw = this.unproject(nw, zoom);\n\t\tse = this.unproject(se, zoom);\n\n\t\tobject.pos = [[nw.lat, nw.lng], [se.lat, se.lng]];\n\n\t\tlet o = this.createObject(object);\n\t\tthis.addLayer(o);\n\t\tthis.fire(\"_addedlayer\", { layer: o });\n\t\tthis.objects.push(object);\n\t},\n\n\tupdateObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects[i] = this.extractObject(o);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tdeleteObject: function(o) {\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == o.options.id\n\t\t\t&& oo.sceneId == o.options.sceneId) {\n\t\t\t\tthis.objects.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\tglobalObjectOptions: function(object) {\n\t\tlet o = this.extractObject(object);\n\t\tdelete o.id; delete o.sceneId; delete o.type; delete o.pos;\n\t\tif(object instanceof L.Circle) { delete o.radius; }\n\n\t\tfor(let i = 0; i < this.objects.length; i++) {\n\t\t\tlet oo = this.objects[i];\n\t\t\tif(oo.id == object.options.id && oo.sceneId != object.options.sceneId) {\n\t\t\t\tthis.objects[i] = Object.assign({}, oo, o);\n\t\t\t}\n\t\t}\n\n\t\tvar object = this.fadeLayer.getObject(object.options.id);\n\t\tif(object) {\n\t\t\tthis.fadeLayer.removeLayer(object);\n\n\t\t\tlet oo = Object.assign({}, this.extractObject(object), o);\n\t\t\tthis.fadeLayer.addLayer(this.createObject(oo), oo.id);\n\t\t}\n\t},\n\n\tsetIcon: function(o, size, icon) {\n\t\tif(!(o instanceof L.ImageOverlay)) { return; }\n\n\t\tif(size) {\n\t\t\tlet zoom = this.getZoom();\n\t\t\tlet c = this.project(o.getBounds().getCenter(), zoom);\n\t\t\to.setBounds([\n\t\t\t\tthis.unproject([ c.x - size[0] / 2, c.y - size[1] / 2 ], zoom),\n\t\t\t\tthis.unproject([ c.x + size[0] / 2, c.y + size[1] / 2 ], zoom)\n\t\t\t]);\n\t\t}\n\t\tif(icon) { o.setUrl(icon); }\n\n\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t$(o._image).css(\"filter\", `\n\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\tgrayscale(${o.options.overlayGrayscale*100}%)\n\t\t\tdrop-shadow(0 0 ${o.options.overlayBrightness}px yellow)\n\t\t\topacity(${(1 - o.options.overlayTransparency)*100}%)\n\t\t`);\n\n\t\tif(o.options.label) { this.updateTooltip(o); }\n\t},\n\n\tsetPopup: function(o) {\n\t\to.unbindPopup();\n\t\tlet popup =\n\t\t\to instanceof L.ImageOverlay ? avatar_popup() :\n\t\t\to instanceof L.Rectangle\n\t\t || o instanceof L.Polygon\n\t\t || o instanceof L.Circle ? polygon_popup() :\n\t\t\to instanceof L.Polyline ? polyline_popup() : \"\";\n\t\tif(!popup) { return; }\n\t\to.bindPopup(popup, { keepInView: true, closeOnEscapeKey: false, maxWidth: 350, maxHeight: 450 });\n\t},\n\n\tupdateTooltip: function(o) {\n\t\tif(o.getTooltip()) {\n\t\t\to.closeTooltip();\n\t\t\tif(o instanceof L.ImageOverlay) {\n\t\t\t\tlet d = this.latLngToContainerPoint( o.getBounds().getNorthWest() ).distanceTo( this.latLngToContainerPoint( o.getBounds().getSouthWest() ) );\n\t\t\t\to.getTooltip().options.offset = [0, d / 2 - 10];\n\t\t\t}\n\t\t\to.openTooltip();\n\t\t}\n\t},\n\n\n\n\tgetWMS: function() {\n\t\treturn this.wms ? {\n\t\t\ttype: \"wms\",\n\t\t\turl: this.wms._url,\n\t\t\tlayers: this.wms.options.layers,\n\t\t\tformat: this.wms.options.format,\n\t\t\tversion: this.wms.options.version,\n\t\t\ttransparent: this.wms.options.transparent\n\t\t} : null;\n\t},\n\n\tsetWMS: function(source) {\n\t\tif(!source) {\n\t\t\tthis.wms = this.wms ? this.removeLayer( this.wms ) : null;\n\t\t\treturn;\n\t\t}\n\t\tif(this.wms\n\t\t&& (source.url || source._url) == this.wms._url\n\t\t&& (source.layers || source.options.layers) == this.wms.options.layers\n\t\t&& (source.format || source.options.format) == this.wms.options.format\n\t\t&& (source.version || source.options.version) == this.wms.options.version) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet layer;\n\n\t\tif(source instanceof L.TileLayer.WMS) {\n\t\t\tlayer = source;\n\t\t}else\n\t\tif(source.type == \"wms\") {\n\t\t\tlayer = L.tileLayer.wms(source.url, {\n\t\t\t\tlayers: source.layers,\n\t\t\t\tformat: source.format,\n\t\t\t\ttransparent: source.transparent,\n\t\t\t\tversion: source.version,\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || \"\"\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tif(this.wms) { this.removeLayer( this.wms ); }\n\n\t\tthis.wms = layer;\n\n\t\tthis.addLayer( this.wms );\n\t\tthis.wms.bringToFront();\n\t},\n\n\tgetCenterBasemapTile: function() {\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn this.basemap._url;\n\t\t}\n\n\t\tlet s = this.basemap.getTileSize(),\n\t\t\tc = this.project( this.getCenter(), this.getZoom() ),\n\t\t\tr = \"\";\n\n\t\ttry { r = this.basemap.getTileUrl({ x: Math.floor(c.x / s.x), y: Math.floor(c.y / s.y) }); }\n\t\tcatch(e) { console.error(e); }\n\n\t\treturn r;\n\t},\n\n\tgetBasemap: function() {\n\t\tif(this.basemap instanceof L.TileLayer) {\n\t\t\treturn {\n\t\t\t\ttype: \"tiles\",\n\t\t\t\turl: this.basemap._url,\n\t\t\t\tminZoom: this.basemap.options.minZoom,\n\t\t\t\tmaxZoom: this.basemap.options.maxZoom,\n\t\t\t\tattribution: this.basemap.options.attribution\n\t\t\t};\n\t\t}else\n\t\tif(this.basemap instanceof L.ImageOverlay) {\n\t\t\treturn {\n\t\t\t\ttype: \"image\",\n\t\t\t\timg: this.basemap._url\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t},\n\n\tsetBasemap: async function(source) {\n\t\tlet basemap;\n\n\t\tif(source instanceof L.TileLayer) {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source._url == this.basemap._url) { return; }\n\n\t\t\tbasemap = source;\n\t\t}else\n\t\tif(source.type == \"tiles\") {\n\t\t\tif(this.basemap instanceof L.TileLayer\n\t\t\t&& source.url == this.basemap._url) { return; }\n\n\t\t\tbasemap = L.tileLayer(source.url, {\n\t\t\t\tminZoom: source.minZoom || 0,\n\t\t\t\tmaxZoom: source.maxZoom || 22,\n\t\t\t\tattribution: source.attribution || \"&copy;\"\n\t\t\t});\n\t\t}else\n\t\tif(source.type == \"image\") {\n\t\t\tif(this.basemap instanceof L.ImageOverlay\n\t\t\t&& source.img == this.basemap._url) { return; }\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = source.img;\n\t\t\tawait img.decode();\n\n\t\t\tlet r = img.width / img.height;\n\t\t\tlet b = _SCENES.get( _SCENES.active ).bounds;\n\t\t\tlet bounds = [b[0], []];\n\t\t\tlet tlp = this.latLngToContainerPoint(b[0]),\n\t\t\t\tbrp = this.latLngToContainerPoint(b[1]);\n\t\t\tlet h = brp.y - tlp.y,\n\t\t\t\tw = brp.x - tlp.x;\n\n\t\t\tif(r >= 1) { // width >= height\n\t\t\t\tlet p = this.containerPointToLatLng([brp.x, tlp.y + w / r]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}else{ // height > width\n\t\t\t\tlet p = this.containerPointToLatLng([tlp.x + r * h, brp.y]);\n\t\t\t\tbounds[1][0] = p.lat;\n\t\t\t\tbounds[1][1] = p.lng;\n\t\t\t}\n\n\t\t\tbasemap = L.imageOverlay(source.img, bounds, {\n\t\t\t\tpmIgnore: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tminZoom: 0, maxZoom: 1000,\n\t\t\t\tattribution: \"&copy;\"\n\t\t\t});\n\t\t}\n\t\telse{ return; }\n\n\t\tthis.removeLayer( this.basemap );\n\n\t\tthis.basemap = basemap;\n\n\t\tthis.presetZoom(this.basemap.options.minZoom, this.basemap.options.maxZoom);\n\n\t\tthis.addLayer( this.basemap );\n\t\tthis.basemap.bringToBack();\n\n\t\t$(\"div.leaflet-control-attribution a\").prop(\"target\", \"_blank\");\n\t\tsave_data();\n\t},\n\n\tresetBasemap: function() { this.setBasemap( _BASEMAPS[10].tiles ); },\n\n\tpresetZoom: function(min, max) {\n\t\tlet zoom = this.getZoom();\n\t\tif(zoom < min || zoom > max) {\n\t\t\tif(zoom < min) { this.setZoom(min); }\n\t\t\tif(zoom > max) { this.setZoom(max); }\n\t\t}\n\t\tthis.setMinZoom(min);\n\t\tthis.setMaxZoom(max);\n\t},\n\n\n\n\tcreateObject: function(o) {\n\t\tlet oo = null;\n\n\t\tswitch(o.type) {\n\t\t\tcase \"avatar\":\n\t\t\t\too = L.imageOverlay(o.icon, o.pos, {\n\t\t\t\t\tinteractive:\t\t\ttrue,\n\t\t\t\t\tzIndex:\t\t\t\t\t200,\n\t\t\t\t\tlabel:\t\t\t\t\to.label,\n\t\t\t\t\tratio:\t\t\t\t\to.ratio,\n\t\t\t\t\trounded:\t\t\t\to.rounded,\n\t\t\t\t\tangle:\t\t\t\t\to.angle,\n\t\t\t\t\tborderColor:\t\t\to.borderColor,\n\t\t\t\t\tborderThickness:\t\to.borderThickness,\n\t\t\t\t\toverlayBlur:\t\t\to.blur,\n\t\t\t\t\toverlayBrightness:\t\to.brightness,\n\t\t\t\t\toverlayGrayscale:\t\to.grayscale,\n\t\t\t\t\toverlayTransparency:\to.transparency,\n\t\t\t\t\tanimationspeed:\t\t\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polyline\":\n\t\t\t\too = L.polyline(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.color,\n\t\t\t\t\tweight:\t\t\to.thickness,\n\t\t\t\t\topacity:\t\t1 - o.transparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"polygon\":\n\t\t\t\too = L.polygon(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"rectangle\":\n\t\t\t\too = L.rectangle(o.pos, {\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"circle\":\n\t\t\t\too = L.circle(o.pos, {\n\t\t\t\t\tradius:\t\t\to.radius,\n\t\t\t\t\tlabel:\t\t\to.label,\n\t\t\t\t\tdashArray:\t\to.dashed ? \"5, 10\" : \"\",\n\t\t\t\t\tcolor:\t\t\to.lineColor,\n\t\t\t\t\tweight:\t\t\to.lineThickness,\n\t\t\t\t\topacity:\t\t1 - o.lineTransparency,\n\t\t\t\t\tfillColor:\t\to.fillColor,\n\t\t\t\t\tfillOpacity:\t1 - o.fillTransparency,\n\t\t\t\t\tanimationspeed:\to.animationspeed\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error(\"object type invalid\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\too.options.id = o.id;\n\t\too.options.sceneId = o.sceneId;\n\n\t\treturn oo;\n\t},\n\n\textractObject: function(o) {\n\t\tlet oo = null;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\tlet nw = o.getBounds().getNorthWest(), se = o.getBounds().getSouthEast();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"avatar\",\n\t\t\t\tpos:\t\t\t\t[[nw.lat, nw.lng], [se.lat, se.lng]],\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\ticon:\t\t\t\to._url,\n\t\t\t\tratio:\t\t\t\to.options.ratio,\n\t\t\t\trounded:\t\t\to.options.rounded,\n\t\t\t\tangle:\t\t\t\t0,\n\t\t\t\tborderColor:\t\to.options.borderColor,\n\t\t\t\tborderThickness:\to.options.borderThickness,\n\t\t\t\tblur:\t\t\t\to.options.overlayBlur,\n\t\t\t\tgrayscale:\t\t\to.options.overlayGrayscale,\n\t\t\t\tbrightness:\t\t\to.options.overlayBrightness,\n\t\t\t\ttransparency:\t\to.options.overlayTransparency,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polygon) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\to instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\t\tpos:\t\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Polyline) {\n\t\t\too = {\n\t\t\t\tid:\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\"polyline\",\n\t\t\t\tpos:\t\t\to.getLatLngs(),\n\t\t\t\tlabel:\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t!!o.options.dashArray,\n\t\t\t\tcolor:\t\t\to.options.color,\n\t\t\t\tthickness:\t\to.options.weight,\n\t\t\t\ttransparency:\t1 - o.options.opacity,\n\t\t\t\tanimationspeed:\to.options.animationspeed\n\t\t\t};\n\t\t}else\n\t\tif(o instanceof L.Circle) {\n\t\t\tlet p = o.getLatLng();\n\t\t\too = {\n\t\t\t\tid:\t\t\t\t\to.options.id,\n\t\t\t\tsceneId:\t\t\to.options.sceneId,\n\t\t\t\ttype:\t\t\t\t\"circle\",\n\t\t\t\tpos:\t\t\t\t[ p.lat, p.lng ],\n\t\t\t\tradius:\t\t\t\to.getRadius(),\n\t\t\t\tlabel:\t\t\t\to.options.label,\n\t\t\t\tdashed:\t\t\t\t!!o.options.dashArray,\n\t\t\t\tlineColor:\t\t\to.options.color,\n\t\t\t\tlineThickness:\t\to.options.weight,\n\t\t\t\tlineTransparency:\t1 - o.options.opacity,\n\t\t\t\tfillColor:\t\t\to.options.fillColor,\n\t\t\t\tfillTransparency:\t1 - o.options.fillOpacity,\n\t\t\t\tanimationspeed:\t\to.options.animationspeed\n\t\t\t};\n\t\t}else{ console.error(\"object type invalid\"); }\n\n\t\treturn oo;\n\t},\n\n\timportData: function(data) {\n\t\tfor(let i = 0; i < data.length; i++) {\n\t\t\tthis.objects.push( data[i] );\n\t\t}\n\t},\n\n\texportData: function() { return this.objects; }\n\n});\n","/*******************************************************************************\n* Copyright (C) Nordfjord EDB AS - All Rights Reserved                         *\n*                                                                              *\n* Unauthorized copying of this file, via any medium is strictly prohibited     *\n* Proprietary and confidential                                                 *\n* Written by Andreas Atakan <aca@geotales.io>, January 2022                  *\n*******************************************************************************/\n\n\"use strict\";\n\n\nL.FadeLayer = L.FeatureGroup.extend({\n\taddLayer: function(o, id) {\n\t\tL.FeatureGroup.prototype.addLayer.call(this, o);\n\t\tif(id && !o.options.id) { o.options.id = id; }\n\t\to.options.pmIgnore = true;\n\n\t\tif(o instanceof L.ImageOverlay) {\n\t\t\to.setOpacity( 0.3 );\n\t\t\t$(o._image).css(\"border-radius\", o.options.rounded ? \"50%\" : \"0\");\n\t\t\t//$(o._image).css(\"transform\", `rotate(${o.options.angle}deg)`);\n\t\t\t$(o._image).css(\"border\", `${o.options.borderThickness}px solid ${o.options.borderColor}`);\n\t\t\t$(o._image).css(\"filter\", `\n\t\t\t\tblur(${o.options.overlayBlur}px)\n\t\t\t\tgrayscale(${o.options.overlayGrayscale * 100}%)\n\t\t\t`);\n\t\t}else{\n\t\t\to.setStyle({ opacity: 0.3 });\n\t\t\to.setStyle({ fillOpacity: 0.2 });\n\t\t}\n\t\to.on(\"click\", ev => { _MAP.insertObject(o); });\n\t},\n\n\tgetObject: function(id) {\n\t\tfor(let o of this.getLayers()) {\n\t\t\tif(o.options.id == id) { return o; }\n\t\t}\n\t\treturn null;\n\t},\n\n\tremoveLayer: function(o, id) {\n\t\tvar o = o || (id ? this.getObject(id) : null);\n\t\tif(!o) { return; }\n\t\to.off(\"click\");\n\t\tL.FeatureGroup.prototype.removeLayer.call(this, o);\n\t},\n\n\tinitialize: function(options) {\n\t\tL.FeatureGroup.prototype.initialize.call(this);\n\t\tthis.options.id = \"0\";\n\t\tthis.options = Object.assign({}, this.options, options);\n\t}\n});\nL.fadeLayer = function(options) { return new L.FadeLayer(options); };\n\n\nL.ImageOverlay.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet nw = this.getBounds().getNorthWest(),\n\t\t\tse = this.getBounds().getSouthEast();\n\t\tlet r = {\n\t\t\t\"type\": \"Feature\",\n\t\t\t\"properties\": {\n\t\t\t\t\"type\":\t\t\t\t\"avatar\",\n\t\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\t\"icon\":\t\t\t\tthis._url,\n\t\t\t\t\"ratio\":\t\t\tthis.options.ratio,\n\t\t\t\t\"rounded\":\t\t\tthis.options.rounded,\n\t\t\t\t\"angle\":\t\t\t0,\n\t\t\t\t\"borderColor\":\t\tthis.options.borderColor,\n\t\t\t\t\"borderThickness\":\tthis.options.borderThickness,\n\t\t\t\t\"blur\":\t\t\t\tthis.options.overlayBlur,\n\t\t\t\t\"grayscale\":\t\tthis.options.overlayGrayscale,\n\t\t\t\t\"brightness\":\t\tthis.options.overlayBrightness,\n\t\t\t\t\"transparency\":\t\tthis.options.overlayTransparency\n\t\t\t},\n\t\t\t\"geometry\": {\n\t\t\t\t\"type\": \"Polygon\",\n\t\t\t\t\"coordinates\": [ [nw.lat, nw.lng], [se.lat, se.lng] ]\n\t\t\t}\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polyline.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polyline.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\"polyline\",\n\t\t\t\"label\":\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t!!this.options.dashArray,\n\t\t\t\"color\":\t\tthis.options.color,\n\t\t\t\"thickness\":\tthis.options.weight,\n\t\t\t\"transparency\":\t1 - this.options.opacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Polygon.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Polygon.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\ttype:\t\t\t\tthis instanceof L.Rectangle ? \"rectangle\" : \"polygon\",\n\t\t\tlabel:\t\t\t\tthis.options.label,\n\t\t\tdashed:\t\t\t\t!!this.options.dashArray,\n\t\t\tlineColor:\t\t\tthis.options.color,\n\t\t\tlineThickness:\t\tthis.options.weight,\n\t\t\tlineTransparency:\t1 - this.options.opacity,\n\t\t\tfillColor:\t\t\tthis.options.fillColor,\n\t\t\tfillTransparency:\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\nL.Circle.include({\n\t__toGeoJSON: function() {\n\t\tif(!this._map) { return; }\n\n\t\tlet r = L.Circle.prototype.toGeoJSON.call(this);\n\t\tr.properties = {\n\t\t\t\"type\":\t\t\t\t\"circle\",\n\t\t\t\"radius\":\t\t\tthis.getRadius(),\n\t\t\t\"label\":\t\t\tthis.options.label,\n\t\t\t\"dashed\":\t\t\t!!this.options.dashArray,\n\t\t\t\"lineColor\":\t\tthis.options.color,\n\t\t\t\"lineThickness\":\tthis.options.weight,\n\t\t\t\"lineTransparency\":\t1 - this.options.opacity,\n\t\t\t\"fillColor\":\t\tthis.options.fillColor,\n\t\t\t\"fillTransparency\":\t1 - this.options.fillOpacity\n\t\t};\n\t\treturn r;\n\t}\n});\n\n\n\n\n\n\n\n\nexport function bind_setup(o) {\n\n\t$(\".objectPopup input#label\").change(function(ev) {\n\t\tlet val = $(this).val();\n\n\t\tif(val) {\n\t\t\tif(!o.getTooltip()) {\n\t\t\t\to.bindTooltip( L.tooltip({ direction: \"center\", permanent: true }, o) );\n\t\t\t\tif(o instanceof L.ImageOverlay) { _MAP.updateTooltip(o); }\n\t\t\t}\n\t\t\to.setTooltipContent(val);\n\t\t}\n\t\telse{ o.unbindTooltip(); }\n\n\t\to.options.label = val;\n\t\t_MAP.updateObject(o);\n\t});\n\t$(\".objectPopup input#label\").val(o.options.label || \"\");\n\n\tif(o instanceof L.ImageOverlay) {\n\t\t$(\"#avatarPopup #iconChoose #iconCol\").remove();\n\t\tfor(let i of _ICONS.slice().reverse()) {\n\t\t\t$(\"#avatarPopup #iconChoose\").prepend(`\n\t\t\t\t<div class=\"col\" id=\"iconCol\">\n\t\t\t\t\t<img class=\"img-fluid rounded\" id=\"icons\" src=\"${i}\" alt=\"&nbsp;\" />\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\n\t\t$(\"input#_img_icon\").off(\"change\");\n\t\t$(\"input#_img_icon\").change(function(ev) {\n\t\t\tlet file = $(this)[0].files[0];\n\t\t\tif(!file) { return; }\n\n\t\t\t$(\"#loadingModal\").modal(\"show\");\n\n\t\t\tlet fr = new FileReader();\n\t\t\tfr.onload = async function() {\n\t\t\t\tlet img = new Image();\n\t\t\t\timg.src = fr.result;\n\t\t\t\tawait img.decode();\n\n\t\t\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", false);\n\t\t\t\t// TODO: Also set rotation-angle input to 0\n\n\t\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t\to.options.rounded = false;\n\t\t\t\to.options.angle = 0;\n\n\t\t\t\tlet data = new FormData();\n\t\t\t\tdata.append(\"type\", \"icon\");\n\t\t\t\tdata.append(\"image\", file);\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\turl: \"api/upload_create.php\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tsuccess: function(result, status, xhr) {\n\t\t\t\t\t\t_ICONS.unshift(result);\n\t\t\t\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], result);\n\t\t\t\t\t\t_MAP.updateObject(o);\n\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); }, 750);\n\t\t\t\t\t},\n\t\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\t\tconsole.error(xhr.status, error);\n\t\t\t\t\t\tsetTimeout(function() { $(\"#loadingModal\").modal(\"hide\"); $(\"#errorModal\").modal(\"show\"); }, 750);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tfr.readAsDataURL(file);\n\t\t});\n\t\t$(\"#avatarPopup #iconChoose #iconAdd\").click(ev => { $(\"input#_img_icon\").click(); });\n\n\t\t$(\"#avatarPopup #iconChoose #icons\").click(async function(ev) {\n\t\t\tlet val = $(this).prop(\"src\");\n\n\t\t\tlet img = new Image();\n\t\t\timg.src = val;\n\t\t\tawait img.decode();\n\n\t\t\to.options.ratio = img.width / img.height || 1;\n\t\t\t_MAP.setIcon(o, [ 35, 35 / o.options.ratio ], val);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#size\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\t_MAP.setIcon(o, [ val, val / o.options.ratio ]);\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#rounded\").change(function(ev) {\n\t\t\to.options.rounded = this.checked;\n\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#rounded\").prop(\"checked\", o.options.rounded);\n\n\t\t$(\"#avatarPopup input#color\").change(function(ev) {\n\t\t\tlet val = $(this).val();\n\n\t\t\to.options.borderColor = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t\t$(\"#avatarPopup input#color\").val(o.options.borderColor || \"#563d7c\");\n\n\t\t$(\"#avatarPopup input#thickness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.borderThickness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#blur\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBlur = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#grayscale\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayGrayscale = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#brightness\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayBrightness = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\n\t\t$(\"#avatarPopup input#transparency\").change(function(ev) {\n\t\t\tlet val = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") );\n\n\t\t\to.options.overlayTransparency = val;\n\t\t\t_MAP.updateObject(o);\n\t\t\t_MAP.setIcon(o);\n\t\t});\n\t}else\n\tif(o instanceof L.Path) {\n\t\t$(\"#shapePopup input#dashed\").change(function(ev) {\n\t\t\to.setStyle({ dashArray: this.checked ? \"5, 10\" : \"\" });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#dashed\").prop(\"checked\", !!o.options.dashArray);\n\n\t\t$(\"#shapePopup input#lineColor\").change(function(ev) {\n\t\t\to.setStyle({ color: $(this).val() });\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\t\t$(\"#shapePopup input#lineColor\").val(o.options.color || \"#563d7c\");\n\n\t\t$(\"#shapePopup input#lineThickness\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\tweight: Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\t$(\"#shapePopup input#lineTransparency\").change(function(ev) {\n\t\t\to.setStyle({\n\t\t\t\topacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t});\n\t\t\t_MAP.updateObject(o);\n\t\t});\n\n\t\tif(o instanceof L.Rectangle\n\t\t|| o instanceof L.Polygon\n\t\t|| o instanceof L.Circle) {\n\t\t\t$(\"#shapePopup input#fillColor\").change(function(ev) {\n\t\t\t\to.setStyle({ fillColor: $(this).val() });\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t\t$(\"#shapePopup input#fillColor\").val(o.options.fillColor || \"#563d7c\");\n\n\t\t\t$(\"#shapePopup input#fillTransparency\").change(function(ev) {\n\t\t\t\to.setStyle({\n\t\t\t\t\tfillOpacity: 1 - Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") )\n\t\t\t\t});\n\t\t\t\t_MAP.updateObject(o);\n\t\t\t});\n\t\t}\n\t}else{ console.error(\"object type invalid\"); }\n\n\t$(\".objectPopup input#animationSpeed\").change(function(ev) {\n\t\to.options.animationspeed = Math.min( Math.max( $(this).prop(\"min\"), $(this).val() ), $(this).prop(\"max\") ) * 1000;\n\t\t_MAP.updateObject(o);\n\t});\n\n\t$(\".objectPopup #makeGlobal\").click(function(ev) {\n\t\t_MAP.globalObjectOptions(o);\n\t});\n}\n"],"names":["$aykGt","parcelRequire","window","onload","ev","document","addEventListener","scale","preventDefault","resizeTimer","$","on","trigger","clearTimeout","setTimeout","_MAP","setAspectRatio","_SCENES","$gUPg4","Scenes","keydown","indexOf","code","keyup","keycode","prev","next","click","add","capture","delete","modal","_TEXTBOXES","$aDjZZ","Textboxes","L","map","center","zoom","innerWidth","zoomControl","maxZoom","doubleClickZoom","zoomAnimationThreshold","wheelPxPerZoomLevel","keyboard","tap","boxZoom","contextmenu","contextmenuItems","text","callback","navigator","clipboard","writeText","latlng","lat","lng","panTo","icon","zoomIn","zoomOut","setup","reset","change","_OPTIONS","animationspeed","this","val","panningspeed","eval","value","objectOptIn","checked","init_basemaps","file","target","files","data","FormData","append","ajax","type","url","contentType","processData","success","async","result","status","xhr","setBasemap","img","_BASEMAPS","push","name","tiles","preview","error","console","split","username","styleID","key","layers","format","version","setWMS","transparent","fr","FileReader","import_data","JSON","parse","readAsText","options","lineColor","lineThickness","lineTransparency","fillColor","fillTransparency","export_data","save_data","setInterval","id","_ID","password","dataType","unsaved_changes","r","_ICONS","unshift","ref","$4XDZb","$7aed1fc953746074$export$31b40729666a4ae0","a","Math","random","toString","replace","$7aed1fc953746074$export$3b2ba0326b56a54c","prop","scenes","length","store","dispatchEvent","Event","importData","textboxes","objects","current","$7aed1fc953746074$var$import_project","f","features","o","t","Array","isArray","v","reverse","pos","geometry","coordinates","properties","sceneId","active","label","ratio","rounded","angle","borderColor","borderThickness","blur","overlayBlur","grayscale","overlayGrayscale","brightness","overlayBrightness","transparency","overlayTransparency","dashed","color","thickness","radius","getMaxZoom","getZoom","object","createObject","addLayer","fire","layer","extractObject","$7aed1fc953746074$var$import_geojson","$7aed1fc953746074$var$export_project","stringify","exportData","$7aed1fc953746074$var$running","$7aed1fc953746074$export$b9e8c15d1f8b68a8","el","createElement","date","Date","y","getFullYear","m","getMonth","d","getDate","H","getHours","M","getMinutes","S","getSeconds","filename","_TITLE","encodeURIComponent","getLayers","__toGeoJSON","$7aed1fc953746074$var$export_geojson","setAttribute","style","display","body","appendChild","ready","removeChild","$7aed1fc953746074$export$8915d34f81494a91","getCenterBasemapTile","off","$7aed1fc953746074$export$d36ebd2686ed6eb9","returnValue","$7aed1fc953746074$export$6c9368fbe350f308","addClass","removeClass","$7aed1fc953746074$var$bind_basemaps","index","$7aed1fc953746074$export$4c0c65daf5a0e159","generate_basemaps","$7aed1fc953746074$export$cce986394ab9e86d","$7aed1fc953746074$export$827cb160439a2d7c","w","h","_w","$39cbb0745d491746$export$28821553ef8d960f","prevId","cont","after","$39cbb0745d491746$export$d3ba155dc3b68019","isUpload","html","i","b","_USER_PAID","$39cbb0745d491746$export$d4a4f44bb1d49f04","$39cbb0745d491746$export$3d6e93c41a574db9","$39cbb0745d491746$export$b06e432f08e15d50","$c509a32349fb613e$export$b4dfb75ee92ddb88","copiedBounds","sortable","cursor","handle","items","containment","tolerance","cancel","zIndex","axis","start","ui","stopPropagation","unbind","update","reorder","stop","bind","get","s","Object","assign","getEl","contains","getPrevScene","order","sort","set","$c509a32349fb613e$var$Scene","splice","addScene","flash_map","deleteScene","remove","setNumbering","hasClass","disable","enable","scrollIntoView","behavior","inline","setBookmark","n","copyBounds","bounds","pasteBounds","setBounds","wms","basemap","bookmark","setTitle","title","uuid","new_scene","setFlyTo","getWMS","getBasemap","nw","getBounds","getNorthWest","se","getSouthEast","$7bdd0f4539e9845d$export$1148a9c69cac2f12","trumbowyg","cmd","param","forceCss","skipTrumbowyg","log","setLock","setOrientation","resizable","handles","minWidth","size","width","outerWidth","dim","css","left","autogrow","semantic","resetCss","removeformatPasted","urlProtocol","defaultLinkTarget","tagsToRemove","btnsDef","dropdown","ico","align","uploadImg","fn","makeLink","btns","plugins","content","$7bdd0f4539e9845d$var$Textbox","locked","tt","l","right","disabled","textboxButton","jQuery","langs","en","viewHTML","undo","redo","formatting","p","blockquote","header","bold","italic","strikethrough","underline","strong","em","del","superscript","subscript","unorderedList","orderedList","insertImage","link","createLink","unlink","_self","_blank","justifyLeft","justifyCenter","justifyRight","justifyFull","horizontalRule","removeformat","fullscreen","close","submit","required","description","svgPath","svgAbsoluteUseHref","hideButtonTexts","defineProperty","lang","fixedBtnPane","fixedFullWidth","autogrowOnEnter","imageWidthModalEdit","prefix","tagClasses","semanticKeepAttributes","tabToIndent","tagsToKeep","changeActiveDropdownIcon","inlineElementsSelector","pasteHandlers","minimalLinks","linkTargets","writable","enumerable","configurable","navigator1","window1","document1","CONFIRM_EVENT","CANCEL_EVENT","params","trumbowygDataName","each","Trumbowyg","execCmd","openModal","closeModal","openModalInsert","fields","saveRange","range","getRangeText","restoreRange","setDisabled","toggle","destroy","empty","c","editorElem","trumbowygIconsId","$trumbowyg","doc","ownerDocument","$ta","$c","extend","svgPathOption","hasSvg","scriptElement","source","src","matches","match","substring","warn","div","insertBefore","childNodes","crossDomain","beforeSend","complete","innerHTML","XMLSerializer","serializeToString","documentElement","baseHref","querySelector","location","href","hash","isBlinkFunction","chrome","Intl","v8BreakIterator","class","isSupported","h1","h2","h3","h4","h5","h6","tag","defaultOptions","hasOwnProperty","imgDblClickHandler","getDefaultImgDblClickHandler","urlPrefix","setupUrlPrefix","nodeName","btnName","btnDef","addBtnDef","eventNamespace","keys","tagToButton","tagHandlers","concat","isIE","userAgent","appVersion","isMac","platform","toUpperCase","init","prototype","DEFAULT_SEMANTIC_MAP","strike","height","initPlugins","execCommand","e","buildEditor","buildBtnPane","fixedBtnPaneEvents","buildOverlay","protocol","$box","isTextarea","is","$ed","insertAfter","attr","syncCode","contenteditable","dir","_dir","tabindex","semanticCode","debounceButtonPaneStatus","ctrl","composition","keyCode","which","toggleSpan","ctrlKey","metaKey","altKey","shiftKey","c1","String","fromCharCode","compositionEndIE","updateButtonPaneStatus","clearButtonPaneStatus","autogrowOnEnterDontClose","autogrowOnEnterWasFocused","autogrowEditorOnEnter","block","getSelection","deleteFromDocument","clipboardData","getData","selection","createRange","pasteHTML","getRangeAt","insertNode","createTextNode","originalEvent","pasteHandler","oldHeight","clientHeight","totalHeight","scrollHeight","$btnPane","btnGrp","$btnGroup","btn","isSupportedBtn","buildBtn","trim","prepend","isDropdown","hasIcon","textDef","$btn","toLowerCase","mousedown","dropdownPrefix","dropdownOptions","dropdownClass","$dropdown","def","buildSubBtn","hide","$overlay","appendTo","showOverlay","fadeIn","hideOverlay","fadeOut","isFixed","scrollTop","offset","top","$buttonPane","buttonPaneOuterHeight","outerHeight","position","paddingTop","removeAttr","toggleClass","show","destroyPlugins","removeData","activeElement","addFlag","find","contents","unwrap","$body","btnOffsetLeft","syncTextarea","join","force","safe","full","keepRange","collapsed","semanticTag","blockElementsSelector","filter","nodeType","nodeValue","wrap","wrapInlinesInParagraphsFrom","$from","$finalParagraph","nextUntil","addBack","wrapAll","parent","$nextElement","nextAll","first","children","oldTag","copyAttributes","revert","newTag","tmpTag","resetRange","$oldTag","startContainer","parentNode","$newTag","selectNodeContents","collapse","documentSelection","selectedRange","node","focusNode","cloneContents","linkDefaultTarget","$a","selectNode","removeAllRanges","addRange","linkUrl","targetOptions","reduce","optionValue","prependUrlPrefix","deleteContents","test","isCollapsed","undefined","alt","$img","isFullscreen","fullscreenCssClass","fullscreenPlaceholderClass","editorHeight","before","focus","e2","listId","classes","buildForm","formOrContent","$modal","darkClass","parents","one","action","opacity","paddingBottom","animate","prependTo","buildModalBtn","$modalBox","lg","idPrefix","now","fieldName","field","attributes","fieldId","isPlainObject","$form","valid","values","$field","addErrorOnModalField","pattern","patternError","err","spanErrorClass","$row","closest","base64","parseInt","rangeCount","rangeStart","savedRange","setEnd","startOffset","metaRange","end","charIndex","nodeStack","foundStart","pop","nextCharIndex","setStart","cn","activeClasses","originalIconClass","tags","getTagsRecursive","$btnSvgUse","dropdownBtnName","$dropdownBtn","$dropdownBtnSvgUse","element","tagName","textAlign","tagHandler","loadedPlugins","plugin","shouldInit","Map","addInitHook","returnButton","Control","zoomHome","zoomHomeIcon","zoomHomeTitle","addControl","basemapButton","easyButton","leafletClasses","states","stateName","onClick","button","init_img_basemaps","pm","addControls","drawCircleMarker","drawText","oneBlock","setPathOptions","weight","fillOpacity","setGlobalOptions","markerStyle","iconUrl","iconSize","popupAnchor","tooltipAnchor","setLang","tooltips","placeMarker","buttonTitles","drawMarkerButton","disableDraw","fadeLayer","pmIgnore","shape","project","getLatLng","getIcon","removeLayer","imageOverlay","unproject","x","interactive","bindTooltip","direction","permanent","ImageOverlay","updateTooltip","updateObject","closeTooltip","openTooltip","deleteObject","unbindTooltip","closePopup","unbindPopup","slideCancel","setPopup","$5WMrM","bind_setup","highlightObject","unhighlightObject","bringToFront","bringToBack","cloneAvatar","setIcon","bindContextMenu","_renderer","_reset","include","enableDraw","clearLayers","Toolbar","setButtonDisabled","setPosition","setBlockPosition","setHomeBounds","aspectratio","get_aspect_ratio_dimentions","invalidateSize","flyToBounds","noMoveStart","duration","getGeomanLayers","getObject","setOpacity","setStyle","setObjects","os","o1","rad","oo","oo1","slideTo","insertObject","oo2","globalObjectOptions","Circle","getCenter","setUrl","_image","popup","avatar_popup","Rectangle","Polygon","polygon_popup","Polyline","polyline_popup","bindPopup","keepInView","closeOnEscapeKey","maxWidth","maxHeight","getTooltip","latLngToContainerPoint","distanceTo","getSouthWest","_url","TileLayer","WMS","tileLayer","minZoom","attribution","getTileSize","getTileUrl","floor","Image","decode","tlp","brp","containerPointToLatLng","p1","presetZoom","resetBasemap","min","max","setZoom","setMinZoom","setMaxZoom","polyline","dashArray","polygon","rectangle","circle","getLatLngs","getRadius","$4547f3162a1b3a07$export$27a752e5ac5fffb5","tooltip","setTooltipContent","slice","readAsDataURL","Path","FadeLayer","FeatureGroup","call","initialize","_map","toGeoJSON"],"version":3,"file":"main.js.map"}